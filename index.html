<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Evolution: Legacy of Agafonov</title>
    <style>
        /* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-primary: #ff8a00;
            --color-secondary: #e52e71;
            --color-success: #00b894;
            --color-danger: #ff4757;
            --color-warning: #ffa502;
            --color-info: #3742fa;
            --color-dark: #1a1a2e;
            --color-darker: #16213e;
            --color-darkest: #0f3460;
            --color-text: #ffffff;
            --color-text-secondary: #a9b7c6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: var(--color-text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--color-darkest), var(--color-darker), var(--color-dark));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s;
        }

        .loading-dragon {
            font-size: 120px;
            margin-bottom: 30px;
            animation: dragonFloat 3s infinite ease-in-out;
            filter: drop-shadow(0 0 20px rgba(255, 100, 0, 0.7));
        }

        .loading-bar {
            width: 400px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
            width: 0%;
            transition: width 0.3s;
            box-shadow: 0 0 10px rgba(255, 138, 0, 0.7);
        }

        .loading-text {
            font-size: 20px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            color: var(--color-text-secondary);
        }

        /* –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ */
        .main-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, var(--color-dark) 0%, var(--color-darker) 50%, var(--color-darkest) 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .game-title {
            font-size: 72px;
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(255, 138, 0, 0.5);
            font-family: 'Cinzel', serif;
            letter-spacing: 3px;
        }

        .game-subtitle {
            font-size: 20px;
            color: var(--color-text-secondary);
            margin-bottom: 50px;
            font-style: italic;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 300px;
        }

        .menu-btn {
            padding: 18px 30px;
            font-size: 22px;
            background: linear-gradient(45deg, rgba(255, 138, 0, 0.8), rgba(229, 46, 113, 0.8));
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: bold;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .menu-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 138, 0, 0.3);
            background: linear-gradient(45deg, rgba(255, 138, 0, 1), rgba(229, 46, 113, 1));
        }

        .menu-btn:active {
            transform: translateY(-2px);
        }

        .credits {
            position: absolute;
            bottom: 30px;
            color: #666;
            font-size: 16px;
            text-align: center;
        }

        .creator {
            color: var(--color-primary);
            font-weight: bold;
            font-size: 18px;
            margin-top: 5px;
        }

        /* –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        .game-container {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(25, 25, 35, 0.95);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 138, 0, 0.3);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .player-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .resource-icon {
            font-size: 20px;
        }

        .resource-value {
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
            min-width: 60px;
            text-align: right;
        }

        .dragon-name {
            font-size: 24px;
            color: var(--color-primary);
            font-weight: bold;
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 20px;
            min-height: 700px;
        }

        /* –°–¢–ò–õ–ò –î–õ–Ø –í–°–ï–• –ü–ê–ù–ï–õ–ï–ô */
        .panel {
            background: rgba(25, 25, 35, 0.95);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(255, 138, 0, 0.3);
        }

        .dragon-panel {
            grid-column: 1;
        }

        .action-panel {
            grid-column: 2;
        }

        .inventory-panel {
            grid-column: 3;
        }

        .section-title {
            font-size: 22px;
            color: var(--color-primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 138, 0, 0.3);
        }

        /* –ü–ê–ù–ï–õ–¨ –î–†–ê–ö–û–ù–ê */
        .dragon-display {
            width: 250px;
            height: 250px;
            margin: 0 auto 30px;
            position: relative;
            background: radial-gradient(circle at center, rgba(255, 138, 0, 0.1), transparent 70%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dragon-icon {
            font-size: 140px;
            animation: pulse 2s infinite;
        }

        .dragon-level {
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            border: 3px solid gold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-name {
            color: var(--color-text-secondary);
            font-size: 14px;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4dffea;
        }

        /* –≠–ö–ò–ü–ò–†–û–í–ö–ê */
        .equipment-slots {
            margin-top: 20px;
        }

        .equipment-slot {
            cursor: pointer;
            transition: all 0.3s;
        }

        .equipment-slot:hover {
            background: rgba(255, 138, 0, 0.1);
            border-color: var(--color-primary);
        }

        /* –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 20px;
            font-size: 16px;
            background: linear-gradient(45deg, rgba(40, 40, 60, 0.9), rgba(30, 30, 50, 0.9));
            border: 2px solid rgba(255, 138, 0, 0.5);
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            border-color: var(--color-primary);
            box-shadow: 0 5px 15px rgba(255, 138, 0, 0.3);
            background: linear-gradient(45deg, rgba(255, 138, 0, 0.2), rgba(229, 46, 113, 0.2));
        }

        .btn-icon {
            font-size: 28px;
        }

        /* –õ–û–ì */
        .battle-log {
            height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(255, 138, 0, 0.2);
        }

        .log-entry {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid;
            animation: slideIn 0.3s ease-out;
            font-size: 14px;
        }

        .log-loot { border-left-color: #ffd700; background: rgba(255, 215, 0, 0.1); }
        .log-damage { border-left-color: var(--color-danger); background: rgba(255, 71, 87, 0.1); }
        .log-heal { border-left-color: var(--color-success); background: rgba(46, 213, 115, 0.1); }
        .log-info { border-left-color: var(--color-info); background: rgba(55, 66, 250, 0.1); }
        .log-quest { border-left-color: var(--color-warning); background: rgba(255, 165, 2, 0.1); }
        .log-dialogue { border-left-color: #9b59b6; background: rgba(155, 89, 182, 0.1); }

        /* –ò–ù–í–ï–ù–¢–ê–†–¨ */
        .inventory-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .inventory-tab {
            flex: 1;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .inventory-tab.active {
            background: linear-gradient(45deg, rgba(0, 184, 148, 0.8), rgba(9, 132, 227, 0.8));
        }

        .inventory-content {
            height: 500px;
            overflow-y: auto;
        }

        .item-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .item-slot {
            aspect-ratio: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            padding: 10px;
            position: relative;
        }

        .item-slot:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px currentColor;
        }

        .item-rarity-common { border-color: #a9b7c6; color: #a9b7c6; }
        .item-rarity-uncommon { border-color: #2ed573; color: #2ed573; }
        .item-rarity-rare { border-color: #3742fa; color: #3742fa; }
        .item-rarity-epic { border-color: #9b59b6; color: #9b59b6; }
        .item-rarity-legendary { border-color: #f1c40f; color: #f1c40f; border-width: 3px; }
        .item-rarity-mythical { border-color: #e74c3c; color: #e74c3c; border-width: 3px; border-style: dashed; }
        .item-rarity-divine { border-color: #00cec9; color: #00cec9; border-width: 3px; border-style: double; }

        .item-icon {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .item-name {
            font-size: 12px;
            text-align: center;
            color: inherit;
        }

        .item-count {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
        }

        /* –ë–û–ï–í–ê–Ø –°–ò–°–¢–ï–ú–ê */
        .battle-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--color-darkest), var(--color-darker));
            z-index: 2000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .battle-hud {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 1200px;
            margin-bottom: 30px;
        }

        .combatant {
            background: rgba(0, 0, 0, 0.7);
            padding: 25px;
            border-radius: 20px;
            width: 350px;
            text-align: center;
            border: 3px solid;
        }

        .player-hud { border-color: var(--color-success); }
        .enemy-hud { border-color: var(--color-danger); }

        .health-bar-container {
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .health-bar {
            height: 100%;
            border-radius: 15px;
            transition: width 0.5s;
        }

        .player-health { background: linear-gradient(90deg, var(--color-success), #00cec9); }
        .enemy-health { background: linear-gradient(90deg, var(--color-danger), #ff6b81); }

        .battle-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            width: 90%;
            max-width: 1200px;
        }

        .battle-action {
            padding: 15px;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--color-info);
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .battle-action:hover:not(:disabled) {
            background: rgba(55, 66, 250, 0.3);
            transform: translateY(-5px);
        }

        .battle-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .battle-log-container {
            width: 90%;
            max-width: 1200px;
            height: 150px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            overflow-y: auto;
            border: 2px solid var(--color-warning);
        }

        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .modal {
            background: linear-gradient(45deg, var(--color-dark), var(--color-darker));
            border-radius: 25px;
            padding: 30px;
            min-width: 500px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid rgba(255, 138, 0, 0.5);
            box-shadow: 0 0 50px rgba(255, 138, 0, 0.3);
            animation: modalAppear 0.3s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 138, 0, 0.3);
        }

        .modal-title {
            font-size: 28px;
            color: var(--color-primary);
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--color-danger);
        }

        /* –°–£–ù–î–£–ö–ò */
        .chest-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .chest {
            background: linear-gradient(45deg, rgba(30, 30, 46, 0.9), rgba(20, 20, 36, 0.9));
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid;
            position: relative;
            overflow: hidden;
        }

        .chest:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .chest-common { border-color: #a9b7c6; }
        .chest-uncommon { border-color: #2ed573; }
        .chest-rare { border-color: #3742fa; }
        .chest-epic { border-color: #9b59b6; }
        .chest-legendary { border-color: #f1c40f; }
        .chest-mythical { border-color: #e74c3c; }
        .chest-divine { border-color: #00cec9; }

        .chest-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .chest-cost {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            font-weight: bold;
        }

        /* –°–ò–°–¢–ï–ú–ê –î–ò–ê–õ–û–ì–û–í */
        .dialogue-container {
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #9b59b6;
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
        }

        .dialogue-speaker {
            color: #9b59b6;
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .dialogue-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 25px;
            min-height: 100px;
        }

        .dialogue-choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .dialogue-choice {
            padding: 15px;
            background: rgba(155, 89, 182, 0.2);
            border: 2px solid #9b59b6;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 16px;
        }

        .dialogue-choice:hover {
            background: rgba(155, 89, 182, 0.4);
            transform: translateX(10px);
        }

        /* –¢–†–ï–ù–ò–†–û–í–ö–ê */
        .training-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .training-option {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--color-success);
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .training-option:hover {
            background: rgba(0, 184, 148, 0.2);
            transform: scale(1.05);
        }

        /* –ó–ê–ß–ê–†–û–í–ê–ù–ò–ï */
        .enchanting-interface {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            margin-top: 20px;
            align-items: center;
        }

        .enchant-slot {
            width: 120px;
            height: 120px;
            border: 3px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            background: rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }

        .enchant-result {
            width: 120px;
            height: 120px;
            border: 3px solid var(--color-primary);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            background: rgba(255, 138, 0, 0.1);
        }

        .enchant-button {
            grid-column: 2;
            padding: 15px 30px;
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }

        /* –≠–í–û–õ–Æ–¶–ò–Ø */
        .evolution-panel {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .evolution-option {
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border: 3px solid;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .evolution-option:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px currentColor;
        }

        .evolution-option.available {
            border-color: var(--color-success);
        }

        .evolution-option.locked {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #666;
        }

        /* –ü–û–î–ó–ï–ú–ï–õ–¨–ï */
        .dungeon-select {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .dungeon-level {
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border: 3px solid var(--color-warning);
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dungeon-level:hover {
            background: rgba(255, 165, 2, 0.2);
            transform: scale(1.05);
        }

        /* –ë–û–°–°–´ */
        .boss-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .boss-entry {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 3px solid var(--color-danger);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .boss-entry:hover {
            background: rgba(255, 71, 87, 0.2);
            transform: scale(1.05);
        }

        /* –ö–õ–ê–ù */
        .clan-interface {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .clan-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--color-info);
        }

        .clan-members {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .clan-member {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        /* –ö–í–ï–°–¢–´ */
        .quest-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .quest-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid var(--color-warning);
        }

        .quest-progress {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }

        .quest-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--color-success), #00cec9);
            border-radius: 5px;
            transition: width 0.3s;
        }

        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes dragonFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, var(--color-success), #1dd1a1);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 300px;
            display: none;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ffd700, var(--color-primary));
            padding: 30px;
            border-radius: 20px;
            z-index: 9999;
            text-align: center;
            animation: modalAppear 0.5s ease-out;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
            display: none;
        }

        /* –ü–†–û–ì–†–ï–°–° –ë–ê–† */
        .progress-container {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
            transition: width 0.3s;
        }

        /* –ö–ù–û–ü–ö–ò */
        .button {
            padding: 12px 24px;
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 138, 0, 0.3);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
            
            .dragon-panel {
                grid-column: 1;
                grid-row: 1;
            }
            
            .action-panel {
                grid-column: 1;
                grid-row: 2;
            }
            
            .inventory-panel {
                grid-column: 1;
                grid-row: 3;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .player-info {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .item-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .chest-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .battle-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal {
                min-width: 90%;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .item-grid {
                grid-template-columns: 1fr;
            }
            
            .chest-grid {
                grid-template-columns: 1fr;
            }
            
            .battle-hud {
                flex-direction: column;
                gap: 20px;
                align-items: center;
            }
            
            .combatant {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-dragon">üêâ</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
        <div class="loading-text" id="loadingText">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–¥—Ä–∞ –¥—Ä–∞–∫–æ–Ω–∞...</div>
    </div>

    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <div class="main-menu" id="mainMenu">
        <div class="game-title">DRAGON EVOLUTION</div>
        <div class="game-subtitle">Legacy of Agafonov</div>
        <div class="menu-buttons">
            <button class="menu-btn" onclick="startGame()">
                <i class="fas fa-play"></i> –ù–æ–≤–∞—è –∏–≥—Ä–∞
            </button>
            <button class="menu-btn" onclick="loadGame()">
                <i class="fas fa-folder-open"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
            </button>
            <button class="menu-btn" onclick="showSettings()">
                <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
            <button class="menu-btn" onclick="showAchievements()">
                <i class="fas fa-trophy"></i> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            </button>
            <button class="menu-btn" onclick="showHowToPlay()">
                <i class="fas fa-question-circle"></i> –û–±—É—á–µ–Ω–∏–µ
            </button>
            <button class="menu-btn" onclick="showCredits()">
                <i class="fas fa-users"></i> –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏
            </button>
        </div>
        <div class="credits">
            –í–æ–ø–ª–æ—â–µ–Ω–∏–µ –ª–µ–≥–µ–Ω–¥—ã –≤ –∫–æ–¥–µ<br>
            <div class="creator">–û—Å–Ω–æ–≤–∞—Ç–µ–ª—å –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: AGAFONOV</div>
            –í–µ—Ä—Å–∏—è 3.0 | Dragon Engine Pro
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° -->
    <div class="game-container" id="gameContainer">
        <div class="header">
            <div class="dragon-name" id="dragonName">–î—Ä–∞–∫–æ–Ω –ê–≥–∞—Ñ–æ–Ω–æ–≤–∞</div>
            <div class="player-info">
                <div class="resource">
                    <div class="resource-icon">üí∞</div>
                    <div class="resource-value" id="gold">1000</div>
                </div>
                <div class="resource">
                    <div class="resource-icon">‚ú®</div>
                    <div class="resource-value" id="essence">500</div>
                </div>
                <div class="resource">
                    <div class="resource-icon">üîÆ</div>
                    <div class="resource-value" id="crystals">50</div>
                </div>
                <div class="resource">
                    <div class="resource-icon">‚ö°</div>
                    <div class="resource-value" id="energy">100/100</div>
                </div>
                <div class="resource">
                    <div class="resource-icon">‚≠ê</div>
                    <div class="resource-value" id="xp">0/100</div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="panel dragon-panel">
                <div class="dragon-display">
                    <div class="dragon-icon" id="dragonIcon">üêâ</div>
                    <div class="dragon-level" id="dragonLevel">1</div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-name">–ê—Ç–∞–∫–∞</div>
                        <div class="stat-value" id="statAttack">150</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-name">–ó–∞—â–∏—Ç–∞</div>
                        <div class="stat-value" id="statDefense">75</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-name">–ó–¥–æ—Ä–æ–≤—å–µ</div>
                        <div class="stat-value" id="statHealth">1000/1000</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-name">–°–∫–æ—Ä–æ—Å—Ç—å</div>
                        <div class="stat-value" id="statSpeed">120</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-name">–ö—Ä–∏—Ç. —É–¥–∞—Ä</div>
                        <div class="stat-value" id="statCrit">15%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-name">–£–∫–ª–æ–Ω–µ–Ω–∏–µ</div>
                        <div class="stat-value" id="statDodge">10%</div>
                    </div>
                </div>

                <div class="section-title">–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</div>
                <div class="equipment-slots">
                    <div class="stats-grid">
                        <div class="stat-item equipment-slot" data-slot="head" onclick="openEquipmentMenu('head')">
                            <div class="stat-name">–®–ª–µ–º</div>
                            <div class="stat-value" id="equipHead">-</div>
                        </div>
                        <div class="stat-item equipment-slot" data-slot="chest" onclick="openEquipmentMenu('chest')">
                            <div class="stat-name">–ù–∞–≥—Ä—É–¥–Ω–∏–∫</div>
                            <div class="stat-value" id="equipChest">-</div>
                        </div>
                        <div class="stat-item equipment-slot" data-slot="legs" onclick="openEquipmentMenu('legs')">
                            <div class="stat-name">–ü–æ–Ω–æ–∂–∏</div>
                            <div class="stat-value" id="equipLegs">-</div>
                        </div>
                        <div class="stat-item equipment-slot" data-slot="weapon" onclick="openEquipmentMenu('weapon')">
                            <div class="stat-name">–û—Ä—É–∂–∏–µ</div>
                            <div class="stat-value" id="equipWeapon">-</div>
                        </div>
                        <div class="stat-item equipment-slot" data-slot="wings" onclick="openEquipmentMenu('wings')">
                            <div class="stat-name">–ö—Ä—ã–ª—å—è</div>
                            <div class="stat-value" id="equipWings">-</div>
                        </div>
                        <div class="stat-item equipment-slot" data-slot="amulet" onclick="openEquipmentMenu('amulet')">
                            <div class="stat-name">–ê–º—É–ª–µ—Ç</div>
                            <div class="stat-value" id="equipAmulet">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel action-panel">
                <div class="section-title">–î–µ–π—Å—Ç–≤–∏—è</div>
                <div class="action-buttons">
                    <button class="action-btn" onclick="startHunt()" id="huntBtn">
                        <div class="btn-icon">üèπ</div>
                        <div>–û—Ö–æ—Ç–∞</div>
                        <small>(10 —ç–Ω–µ—Ä–≥–∏–∏)</small>
                    </button>
                    <button class="action-btn" onclick="showChests()">
                        <div class="btn-icon">üéÅ</div>
                        <div>–°—É–Ω–¥—É–∫–∏</div>
                    </button>
                    <button class="action-btn" onclick="showDungeon()">
                        <div class="btn-icon">üè∞</div>
                        <div>–ü–æ–¥–∑–µ–º–µ–ª—å–µ</div>
                    </button>
                    <button class="action-btn" onclick="showTraining()">
                        <div class="btn-icon">üí™</div>
                        <div>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</div>
                    </button>
                    <button class="action-btn" onclick="showEnchant()">
                        <div class="btn-icon">üîÆ</div>
                        <div>–ó–∞—á–∞—Ä–æ–≤–∞—Ç—å</div>
                    </button>
                    <button class="action-btn" onclick="showEvolution()" id="evolutionBtn">
                        <div class="btn-icon">üî•</div>
                        <div>–≠–≤–æ–ª—é—Ü–∏—è</div>
                    </button>
                    <button class="action-btn" onclick="showQuests()">
                        <div class="btn-icon">üìú</div>
                        <div>–ó–∞–¥–∞–Ω–∏—è</div>
                    </button>
                    <button class="action-btn" onclick="showBosses()">
                        <div class="btn-icon">üëπ</div>
                        <div>–ë–æ—Å—Å—ã</div>
                    </button>
                    <button class="action-btn" onclick="showClan()">
                        <div class="btn-icon">üèõÔ∏è</div>
                        <div>–ö–ª–∞–Ω</div>
                    </button>
                    <button class="action-btn" onclick="showMarket()">
                        <div class="btn-icon">üè™</div>
                        <div>–†—ã–Ω–æ–∫</div>
                    </button>
                    <button class="action-btn" onclick="showPvP()">
                        <div class="btn-icon">‚öîÔ∏è</div>
                        <div>PvP –ê—Ä–µ–Ω–∞</div>
                    </button>
                    <button class="action-btn" onclick="showCrafting()">
                        <div class="btn-icon">üî®</div>
                        <div>–ö—Ä–∞—Ñ—Ç</div>
                    </button>
                </div>

                <div class="battle-log" id="battleLog">
                    <div class="log-entry log-info">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –¥—Ä–∞–∫–æ–Ω–æ–≤!</div>
                    <div class="log-entry log-info">–ù–∞—á–∏–Ω–∞–π—Ç–µ –æ—Ö–æ—Ç—É, —Å–æ–±–∏—Ä–∞–π—Ç–µ –¥–æ—Å–ø–µ—Ö–∏ –∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å —Å–∏–ª—å–Ω–µ–µ!</div>
                </div>
            </div>

            <div class="panel inventory-panel">
                <div class="section-title">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
                <div class="inventory-tabs">
                    <button class="inventory-tab active" onclick="switchInventoryTab('armor')">–î–æ—Å–ø–µ—Ö–∏</button>
                    <button class="inventory-tab" onclick="switchInventoryTab('weapons')">–û—Ä—É–∂–∏–µ</button>
                    <button class="inventory-tab" onclick="switchInventoryTab('potions')">–ó–µ–ª—å—è</button>
                    <button class="inventory-tab" onclick="switchInventoryTab('materials')">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
                    <button class="inventory-tab" onclick="switchInventoryTab('special')">–û—Å–æ–±—ã–µ</button>
                </div>
                <div class="inventory-content" id="inventoryContent">
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <!-- –ë–û–ï–í–ê–Ø –°–ò–°–¢–ï–ú–ê -->
    <div class="battle-container" id="battleContainer">
        <div class="battle-hud">
            <div class="combatant player-hud">
                <div class="combatant-name" id="battlePlayerName">–í–∞—à –î—Ä–∞–∫–æ–Ω</div>
                <div class="health-bar-container">
                    <div class="health-bar player-health" id="playerHealthBar" style="width: 100%"></div>
                </div>
                <div class="combatant-stats" id="playerBattleStats"></div>
            </div>
            <div class="combatant enemy-hud">
                <div class="combatant-name" id="battleEnemyName">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</div>
                <div class="health-bar-container">
                    <div class="health-bar enemy-health" id="enemyHealthBar" style="width: 100%"></div>
                </div>
                <div class="combatant-stats" id="enemyBattleStats"></div>
            </div>
        </div>
        
        <div class="battle-log-container" id="battleLogContainer"></div>
        
        <div class="battle-actions" id="battleActions">
            <!-- –ë–æ–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê -->
    <div class="modal-overlay" id="modalOverlay">
        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
    </div>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
    <div class="notification" id="notification"></div>
    <div class="achievement-popup" id="achievementPopup"></div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ö–û–ù–°–¢–ê–ù–¢–´ ====================
        const GAME_VERSION = "3.0";
        const GAME_TITLE = "Dragon Evolution: Legacy of Agafonov";
        
        let gameState = {
            version: GAME_VERSION,
            dragonName: "–î—Ä–∞–∫–æ–Ω –ê–≥–∞—Ñ–æ–Ω–æ–≤–∞",
            level: 1,
            xp: 0,
            xpToNextLevel: 100,
            gold: 1000,
            essence: 500,
            crystals: 50,
            energy: 100,
            maxEnergy: 100,
            energyRegenTime: Date.now(),
            skillPoints: 0,
            
            // –°—é–∂–µ—Ç–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
            storyProgress: {
                chapter: 1,
                stage: 0,
                completedDialogues: [],
                currentQuest: null
            },
            
            // –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            baseStats: {
                attack: 150,
                defense: 75,
                health: 1000,
                maxHealth: 1000,
                speed: 120,
                critical: 15,
                dodge: 10,
                armor: 0,
                fireDamage: 50,
                iceDamage: 0,
                poisonDamage: 0,
                lightningDamage: 0
            },
            
            // –ë–æ–Ω—É—Å—ã –æ—Ç —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
            equipmentBonus: {
                attack: 0,
                defense: 0,
                health: 0,
                speed: 0,
                critical: 0,
                dodge: 0,
                armor: 0,
                fireDamage: 0,
                iceDamage: 0,
                poisonDamage: 0,
                lightningDamage: 0
            },
            
            // –ê–∫—Ç–∏–≤–Ω—ã–µ –±–∞—Ñ—Ñ—ã
            activeBuffs: [],
            
            // –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞
            equipment: {
                head: null,
                chest: null,
                legs: null,
                weapon: null,
                wings: null,
                amulet: null,
                ring1: null,
                ring2: null
            },
            
            // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
            inventory: {
                armor: [],
                weapons: [],
                potions: [],
                materials: [],
                special: []
            },
            
            // –ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏—è
            enchants: [],
            
            // –ö–≤–µ—Å—Ç—ã
            activeQuests: [],
            completedQuests: [],
            failedQuests: [],
            
            // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            achievements: [],
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
            unlockedTechnologies: [],
            
            // –ö–ª–∞–Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            clan: {
                name: "",
                level: 0,
                members: [],
                resources: 0
            },
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–¥–∑–µ–º–µ–ª–∏–π
            dungeonProgress: {},
            
            // –£–±–∏—Ç—ã–µ –±–æ—Å—Å—ã
            bossKills: {},
            
            // PvP —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            pvpStats: {
                wins: 0,
                losses: 0,
                rating: 1000
            },
            
            // –ò–≥—Ä–æ–≤–æ–µ –≤—Ä–µ–º—è
            gameTime: 0,
            
            // –†–µ–º–µ—Å–ª–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
            discoveredRecipes: [],
            
            // –ù–∞–≤—ã–∫–∏
            skills: {
                fireBreath: { level: 1, maxLevel: 10, xp: 0 },
                iceBreath: { level: 0, maxLevel: 10, xp: 0 },
                poisonBreath: { level: 0, maxLevel: 10, xp: 0 },
                healingFlames: { level: 0, maxLevel: 10, xp: 0 },
                dragonRage: { level: 0, maxLevel: 10, xp: 0 },
                thunderStrike: { level: 0, maxLevel: 10, xp: 0 }
            },
            
            // –≠–≤–æ–ª—é—Ü–∏–∏
            evolutionStage: 1,
            availableEvolutions: [],
            
            // –°–æ–±—ã—Ç–∏—è –∏ –º–∏–Ω–∏-–∏–≥—Ä—ã
            dailyRewards: {},
            eventProgress: {},
            
            // –°–∏—Å—Ç–µ–º–Ω—ã–µ
            settings: {
                musicVolume: 50,
                soundVolume: 70,
                showAnimations: true,
                notifications: true,
                autoSave: true
            },
            
            lastSave: Date.now()
        };

        // ==================== –ë–ê–ó–ê –î–ê–ù–ù–´–• –ü–†–ï–î–ú–ï–¢–û–í ====================
        const ITEM_DATABASE = {
            // –®–õ–ï–ú–´ (20 –ø—Ä–µ–¥–º–µ—Ç–æ–≤)
            head: [
                { id: "helmet_beginner", name: "–®–ª–µ–º –Ω–æ–≤–∏—á–∫–∞", rarity: "common", icon: "üëë", level: 1,
                  stats: { defense: 10, health: 50 }, price: 100, description: "–ë–∞–∑–æ–≤—ã–π —à–ª–µ–º –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –¥—Ä–∞–∫–æ–Ω–æ–≤" },
                { id: "helmet_hunter", name: "–ö–∞–ø—é—à–æ–Ω –æ—Ö–æ—Ç–Ω–∏–∫–∞", rarity: "uncommon", icon: "üé©", level: 3,
                  stats: { defense: 20, health: 100, dodge: 5 }, price: 250, description: "–®–ª–µ–º –æ–ø—ã—Ç–Ω–æ–≥–æ –æ—Ö–æ—Ç–Ω–∏–∫–∞" },
                { id: "helmet_dragon", name: "–ö–æ—Ä–æ–Ω–∞ –¥—Ä–∞–∫–æ–Ω–∞", rarity: "rare", icon: "üëë", level: 5,
                  stats: { defense: 35, health: 200, critical: 10 }, price: 500, description: "–ö–æ—Ä–æ–Ω–∞ –∏–∑ —á–µ—à—É–∏ –¥—Ä–µ–≤–Ω–µ–≥–æ –¥—Ä–∞–∫–æ–Ω–∞" },
                { id: "helmet_titan", name: "–®–ª–µ–º —Ç–∏—Ç–∞–Ω–∞", rarity: "epic", icon: "‚õëÔ∏è", level: 10,
                  stats: { defense: 60, health: 400, armor: 15 }, price: 1000, description: "–®–ª–µ–º –≤—ã–∫–æ–≤–∞–Ω–Ω—ã–π —Ç–∏—Ç–∞–Ω–∞–º–∏" },
                { id: "helmet_phoenix", name: "–í–µ–Ω–µ—Ü —Ñ–µ–Ω–∏–∫—Å–∞", rarity: "legendary", icon: "üî•", level: 20,
                  stats: { defense: 100, health: 800, fireDamage: 50, critical: 20 }, price: 2500, description: "–í–µ–Ω–µ—Ü –∏–∑ –ø–µ—Ä—å–µ–≤ —Ñ–µ–Ω–∏–∫—Å–∞" },
                { id: "helmet_void", name: "–®–ª–µ–º –ø—É—Å—Ç–æ—Ç—ã", rarity: "mythical", icon: "‚ö´", level: 30,
                  stats: { defense: 150, health: 1200, allDamage: 30, dodge: 15 }, price: 5000, description: "–®–ª–µ–º –ø–æ–≥–ª–æ—â–∞—é—â–∏–π —Å–≤–µ—Ç" },
                { id: "helmet_god", name: "–®–ª–µ–º –±–æ–≥–æ–≤", rarity: "divine", icon: "‚ú®", level: 40,
                  stats: { defense: 250, health: 2000, allStats: 25 }, price: 10000, description: "–®–ª–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π –±–æ–≥–∞–º–∏" },
                { id: "helmet_dragonlord", name: "–®–ª–µ–º –¥—Ä–∞–∫–æ–Ω–æ–≤–ª–∞–¥—ã–∫–∏", rarity: "legendary", icon: "üê≤", level: 25,
                  stats: { defense: 120, health: 1000, fireDamage: 75, critical: 25 }, price: 3000, description: "–®–ª–µ–º –≤–µ–ª–∏—á–∞–π—à–µ–≥–æ –¥—Ä–∞–∫–æ–Ω–æ–≤–ª–∞–¥—ã–∫–∏" },
                { id: "helmet_shadow", name: "–¢–µ–Ω–µ–≤–æ–π –∫–∞–ø—é—à–æ–Ω", rarity: "epic", icon: "üåë", level: 15,
                  stats: { defense: 45, dodge: 20, speed: 30 }, price: 800, description: "–ö–∞–ø—é—à–æ–Ω –∏–∑ —Ç–µ–Ω–µ–≤–æ–π –º–∞—Ç–µ—Ä–∏–∏" },
                { id: "helmet_crystal", name: "–ö—Ä–∏—Å—Ç–∞–ª—å–Ω—ã–π —à–ª–µ–º", rarity: "rare", icon: "üíé", level: 8,
                  stats: { defense: 40, health: 150, armor: 10 }, price: 600, description: "–®–ª–µ–º –∏–∑ —á–∏—Å—Ç–æ–≥–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞" }
            ],
            
            // –ù–ê–ì–†–£–î–ù–ò–ö–ò (20 –ø—Ä–µ–¥–º–µ—Ç–æ–≤)
            chest: [
                { id: "chest_beginner", name: "–ö–∏—Ä–∞—Å–∞ —É—á–µ–Ω–∏–∫–∞", rarity: "common", icon: "üëï", level: 1,
                  stats: { defense: 20, health: 100 }, price: 150, description: "–ë–∞–∑–æ–≤–∞—è –∫–∏—Ä–∞—Å–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫" },
                { id: "chest_warrior", name: "–î–æ—Å–ø–µ—Ö –≤–æ–∏–Ω–∞", rarity: "uncommon", icon: "ü¶∫", level: 3,
                  stats: { defense: 40, health: 200, armor: 5 }, price: 350, description: "–ü—Ä–æ—á–Ω—ã–π –¥–æ—Å–ø–µ—Ö –æ–ø—ã—Ç–Ω–æ–≥–æ –≤–æ–∏–Ω–∞" },
                { id: "chest_dragon", name: "–ë—Ä–æ–Ω—è –¥—Ä–∞–∫–æ–Ω–∞", rarity: "rare", icon: "üêâ", level: 5,
                  stats: { defense: 70, health: 400, fireDamage: 30 }, price: 700, description: "–ë—Ä–æ–Ω—è –∏–∑ –¥—Ä–∞–∫–æ–Ω—å–µ–π —á–µ—à—É–∏" },
                { id: "chest_leviathan", name: "–ù–∞–≥—Ä—É–¥–Ω–∏–∫ –ª–µ–≤–∏–∞—Ñ–∞–Ω–∞", rarity: "epic", icon: "üåä", level: 10,
                  stats: { defense: 120, health: 800, iceDamage: 50 }, price: 1500, description: "–ù–∞–≥—Ä—É–¥–Ω–∏–∫ –∏–∑ —á–µ—à—É–∏ –º–æ—Ä—Å–∫–æ–≥–æ —á—É–¥–æ–≤–∏—â–∞" },
                { id: "chest_god", name: "–ü–ª–∞—â –±–æ–≥–æ–≤", rarity: "legendary", icon: "‚ú®", level: 20,
                  stats: { defense: 200, health: 1500, allResist: 25, dodge: 15 }, price: 5000, description: "–ü–ª–∞—â –±–æ–≥–æ–≤ —Å –∑–∞—â–∏—Ç–Ω—ã–º–∏ —á–∞—Ä–∞–º–∏" },
                { id: "chest_apocalypse", name: "–î–æ—Å–ø–µ—Ö –∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å–∞", rarity: "mythical", icon: "‚ò†Ô∏è", level: 30,
                  stats: { defense: 300, health: 2500, allDamage: 50 }, price: 8000, description: "–î–æ—Å–ø–µ—Ö –∫–æ–Ω—Ü–∞ –≤—Ä–µ–º–µ–Ω" },
                { id: "chest_eternity", name: "–î–æ—Å–ø–µ—Ö –≤–µ—á–Ω–æ—Å—Ç–∏", rarity: "divine", icon: "‚àû", level: 40,
                  stats: { defense: 500, health: 4000, allStats: 50 }, price: 15000, description: "–î–æ—Å–ø–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≤–Ω–µ –≤—Ä–µ–º–µ–Ω–∏" },
                { id: "chest_phoenix", name: "–ü–ª–∞—â —Ñ–µ–Ω–∏–∫—Å–∞", rarity: "legendary", icon: "üî•", level: 25,
                  stats: { defense: 180, health: 1200, fireDamage: 100, healthRegen: 50 }, price: 4000, description: "–ü–ª–∞—â –∏–∑ –≤–æ–∑—Ä–æ–∂–¥–∞—é—â–∏—Ö—Å—è –ø–µ—Ä—å–µ–≤" },
                { id: "chest_storm", name: "–î–æ—Å–ø–µ—Ö –±—É—Ä–∏", rarity: "epic", icon: "‚ö°", level: 15,
                  stats: { defense: 100, health: 600, lightningDamage: 40, speed: 40 }, price: 1200, description: "–î–æ—Å–ø–µ—Ö –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π —ç–Ω–µ—Ä–≥–∏–µ–π –º–æ–ª–Ω–∏–π" },
                { id: "chest_venom", name: "–ë—Ä–æ–Ω—è —è–¥–∞", rarity: "rare", icon: "‚ò£Ô∏è", level: 8,
                  stats: { defense: 60, health: 300, poisonDamage: 30 }, price: 900, description: "–ë—Ä–æ–Ω—è –ø—Ä–æ–ø–∏—Ç–∞–Ω–Ω–∞—è —Å–º–µ—Ä—Ç–µ–ª—å–Ω—ã–º —è–¥–æ–º" }
            ],
            
            // –û–†–£–ñ–ò–ï (30 –ø—Ä–µ–¥–º–µ—Ç–æ–≤)
            weapons: [
                { id: "weapon_beginner", name: "–ö–æ–≥—Ç–∏ –Ω–æ–≤–∏—á–∫–∞", rarity: "common", icon: "‚úã", level: 1,
                  stats: { attack: 20, speed: 10 }, price: 200, description: "–ë–∞–∑–æ–≤—ã–µ –∫–æ–≥—Ç–∏ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫" },
                { id: "weapon_hunter", name: "–ö–ª—ã–∫–∏ –æ—Ö–æ—Ç–Ω–∏–∫–∞", rarity: "uncommon", icon: "ü¶∑", level: 3,
                  stats: { attack: 40, critical: 10 }, price: 450, description: "–û—Å—Ç—Ä—ã–µ –∫–ª—ã–∫–∏ –æ–ø—ã—Ç–Ω–æ–≥–æ –æ—Ö–æ—Ç–Ω–∏–∫–∞" },
                { id: "weapon_fire", name: "–ü–ª–∞–º–µ–Ω–Ω—ã–µ –∫–æ–≥—Ç–∏", rarity: "rare", icon: "üî•", level: 5,
                  stats: { attack: 80, fireDamage: 30, speed: 15 }, price: 900, description: "–ö–æ–≥—Ç–∏ –ø—ã–ª–∞—é—â–∏–µ –≤–µ—á–Ω—ã–º –æ–≥–Ω–µ–º" },
                { id: "weapon_titan", name: "–ú–æ–ª–æ—Ç —Ç–∏—Ç–∞–Ω–∞", rarity: "epic", icon: "üî®", level: 10,
                  stats: { attack: 150, critical: 20, armorPen: 30 }, price: 2000, description: "–ú–æ–ª–æ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–∏—Ç–∞–Ω–∞–º–∏" },
                { id: "weapon_apocalypse", name: "–ö–ª–∏–Ω–æ–∫ –∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å–∞", rarity: "legendary", icon: "‚öîÔ∏è", level: 20,
                  stats: { attack: 300, critical: 30, allDamage: 50 }, price: 7500, description: "–ö–ª–∏–Ω–æ–∫ –Ω–µ—Å—É—â–∏–π –∫–æ–Ω–µ—Ü –º–∏—Ä–∞" },
                { id: "weapon_void", name: "–ö–ª–∏–Ω–æ–∫ –ø—É—Å—Ç–æ—Ç—ã", rarity: "mythical", icon: "‚ö´", level: 30,
                  stats: { attack: 500, critical: 40, allDamage: 100 }, price: 12000, description: "–ö–ª–∏–Ω–æ–∫ –≤—ã—Ä–µ–∑–∞–Ω–Ω—ã–π –∏–∑ –ø—É—Å—Ç–æ—Ç—ã" },
                { id: "weapon_god", name: "–ö–æ–ø—å–µ –±–æ–≥–æ–≤", rarity: "divine", icon: "‚ú®", level: 40,
                  stats: { attack: 800, critical: 50, allStats: 75 }, price: 20000, description: "–û—Ä—É–∂–∏–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –±–æ–≥–∞–º–∏" },
                { id: "weapon_ice", name: "–õ–µ–¥—è–Ω—ã–µ –∫–ª—ã–∫–∏", rarity: "rare", icon: "‚ùÑÔ∏è", level: 7,
                  stats: { attack: 70, iceDamage: 40, critical: 15 }, price: 800, description: "–ö–ª—ã–∫–∏ –∏–∑ –≤–µ—á–Ω–æ–≥–æ –ª—å–¥–∞" },
                { id: "weapon_lightning", name: "–ú–æ–ª–Ω–∏—è –ó–µ–≤—Å–∞", rarity: "epic", icon: "‚ö°", level: 12,
                  stats: { attack: 130, lightningDamage: 60, speed: 30 }, price: 1800, description: "–û—Ä—É–∂–∏–µ –Ω–∞—Å—ã—â–µ–Ω–Ω–æ–µ —ç–Ω–µ—Ä–≥–∏–µ–π –º–æ–ª–Ω–∏–π" },
                { id: "weapon_poison", name: "–Ø–¥–æ–≤–∏—Ç–æ–µ –∂–∞–ª–æ", rarity: "uncommon", icon: "‚ò†Ô∏è", level: 4,
                  stats: { attack: 50, poisonDamage: 25 }, price: 500, description: "–ñ–∞–ª–æ —Å–º–µ—Ä—Ç–æ–Ω–æ—Å–Ω–æ–≥–æ —Å–∫–æ—Ä–ø–∏–æ–Ω–∞" }
            ],
            
            // –ö–†–´–õ–¨–Ø (15 –ø—Ä–µ–¥–º–µ—Ç–æ–≤)
            wings: [
                { id: "wings_beginner", name: "–ö—Ä—ã–ª—å—è –Ω–æ–≤–∏—á–∫–∞", rarity: "common", icon: "ü™Ω", level: 1,
                  stats: { speed: 20, dodge: 5 }, price: 300, description: "–ë–∞–∑–æ–≤—ã–µ –∫—Ä—ã–ª—å—è –¥–ª—è –ø–æ–ª–µ—Ç–æ–≤" },
                { id: "wings_dragon", name: "–ö—Ä—ã–ª—å—è –¥—Ä–∞–∫–æ–Ω–∞", rarity: "rare", icon: "üêâ", level: 5,
                  stats: { speed: 50, fireDamage: 20 }, price: 1000, description: "–ú–æ—â–Ω—ã–µ –¥—Ä–∞–∫–æ–Ω—å–∏ –∫—Ä—ã–ª—å—è" },
                { id: "wings_phoenix", name: "–ö—Ä—ã–ª—å—è —Ñ–µ–Ω–∏–∫—Å–∞", rarity: "legendary", icon: "üî•", level: 20,
                  stats: { speed: 100, fireDamage: 50, healthRegen: 30 }, price: 5000, description: "–ö—Ä—ã–ª—å—è –≤–æ–∑—Ä–æ–∂–¥–∞—é—â–µ–≥–æ—Å—è —Ñ–µ–Ω–∏–∫—Å–∞" },
                { id: "wings_void", name: "–ö—Ä—ã–ª—å—è —Ç—å–º—ã", rarity: "mythical", icon: "üåë", level: 30,
                  stats: { speed: 150, dodge: 25, allDamage: 30 }, price: 8000, description: "–ö—Ä—ã–ª—å—è –ø–æ–≥–ª–æ—â–∞—é—â–∏–µ —Å–≤–µ—Ç" }
            ],
            
            // –ê–ú–£–õ–ï–¢–´ (10 –ø—Ä–µ–¥–º–µ—Ç–æ–≤)
            amulet: [
                { id: "amulet_health", name: "–ê–º—É–ª–µ—Ç –∑–¥–æ—Ä–æ–≤—å—è", rarity: "uncommon", icon: "‚ù§Ô∏è", level: 1,
                  stats: { health: 200, healthRegen: 10 }, price: 400, description: "–ê–º—É–ª–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–π –∂–∏–∑–Ω–µ–Ω–Ω—É—é —Å–∏–ª—É" },
                { id: "amulet_power", name: "–ê–º—É–ª–µ—Ç —Å–∏–ª—ã", rarity: "rare", icon: "üí™", level: 5,
                  stats: { attack: 50, critical: 15 }, price: 800, description: "–ê–º—É–ª–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–π —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Å–∏–ª—É" },
                { id: "amulet_protection", name: "–ê–º—É–ª–µ—Ç –∑–∞—â–∏—Ç—ã", rarity: "epic", icon: "üõ°Ô∏è", level: 10,
                  stats: { defense: 40, armor: 20, dodge: 10 }, price: 1500, description: "–ê–º—É–ª–µ—Ç —Å–æ–∑–¥–∞—é—â–∏–π –∑–∞—â–∏—Ç–Ω–æ–µ –ø–æ–ª–µ" },
                { id: "amulet_eternity", name: "–ê–º—É–ª–µ—Ç –≤–µ—á–Ω–æ—Å—Ç–∏", rarity: "legendary", icon: "‚åõ", level: 25,
                  stats: { allStats: 30, healthRegen: 50 }, price: 6000, description: "–ê–º—É–ª–µ—Ç –∑–∞–º–µ–¥–ª—è—é—â–∏–π –≤—Ä–µ–º—è" }
            ],
            
            // –ó–ï–õ–¨–Ø (25 –ø—Ä–µ–¥–º–µ—Ç–æ–≤)
            potions: [
                { id: "potion_health_small", name: "–ú–∞–ª–æ–µ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è", rarity: "common", icon: "‚ù§Ô∏è", 
                  effect: { health: 200 }, price: 50, stackable: true, description: "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 200 –∑–¥–æ—Ä–æ–≤—å—è" },
                { id: "potion_health_medium", name: "–°—Ä–µ–¥–Ω–µ–µ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è", rarity: "uncommon", icon: "‚ù§Ô∏è", 
                  effect: { health: 500 }, price: 120, stackable: true, description: "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 500 –∑–¥–æ—Ä–æ–≤—å—è" },
                { id: "potion_health_large", name: "–ë–æ–ª—å—à–æ–µ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è", rarity: "rare", icon: "‚ù§Ô∏è", 
                  effect: { health: 1000 }, price: 250, stackable: true, description: "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 1000 –∑–¥–æ—Ä–æ–≤—å—è" },
                { id: "potion_attack", name: "–ó–µ–ª—å–µ –∞—Ç–∞–∫–∏", rarity: "uncommon", icon: "‚öîÔ∏è", 
                  effect: { attack: 30, duration: 300 }, price: 100, stackable: true, description: "+30 –∫ –∞—Ç–∞–∫–µ –Ω–∞ 5 –º–∏–Ω—É—Ç" },
                { id: "potion_defense", name: "–ó–µ–ª—å–µ –∑–∞—â–∏—Ç—ã", rarity: "uncommon", icon: "üõ°Ô∏è", 
                  effect: { defense: 20, duration: 300 }, price: 100, stackable: true, description: "+20 –∫ –∑–∞—â–∏—Ç–µ –Ω–∞ 5 –º–∏–Ω—É—Ç" },
                { id: "potion_speed", name: "–ó–µ–ª—å–µ —Å–∫–æ—Ä–æ—Å—Ç–∏", rarity: "rare", icon: "‚ö°", 
                  effect: { speed: 50, duration: 180 }, price: 200, stackable: true, description: "+50 –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ 3 –º–∏–Ω—É—Ç—ã" },
                { id: "potion_dragon", name: "–≠–ª–∏–∫—Å–∏—Ä –¥—Ä–∞–∫–æ–Ω–∞", rarity: "epic", icon: "üêâ", 
                  effect: { allStats: 20, duration: 600 }, price: 500, stackable: true, description: "+20 –∫–æ –≤—Å–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º –Ω–∞ 10 –º–∏–Ω—É—Ç" },
                { id: "potion_energy", name: "–ó–µ–ª—å–µ —ç–Ω–µ—Ä–≥–∏–∏", rarity: "common", icon: "‚ö°", 
                  effect: { energy: 20 }, price: 30, stackable: true, description: "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 20 —ç–Ω–µ—Ä–≥–∏–∏" },
                { id: "potion_critical", name: "–ó–µ–ª—å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞—Ä–∞", rarity: "rare", icon: "üéØ", 
                  effect: { critical: 25, duration: 240 }, price: 300, stackable: true, description: "+25% –∫ —à–∞–Ω—Å—É –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞—Ä–∞ –Ω–∞ 4 –º–∏–Ω—É—Ç—ã" }
            ],
            
            // –ú–ê–¢–ï–†–ò–ê–õ–´ (20 –ø—Ä–µ–¥–º–µ—Ç–æ–≤)
            materials: [
                { id: "mat_dragon_scale", name: "–î—Ä–∞–∫–æ–Ω—å—è —á–µ—à—É—è", rarity: "common", icon: "üî∏", 
                  price: 10, description: "–ü—Ä–æ—á–Ω–∞—è —á–µ—à—É—è –¥—Ä–∞–∫–æ–Ω–∞" },
                { id: "mat_fire_crystal", name: "–û–≥–Ω–µ–Ω–Ω—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª", rarity: "uncommon", icon: "üî¥", 
                  price: 25, description: "–ö—Ä–∏—Å—Ç–∞–ª–ª –ø—ã–ª–∞—é—â–∏–π –≤–µ—á–Ω—ã–º –æ–≥–Ω–µ–º" },
                { id: "mat_ice_heart", name: "–õ–µ–¥—è–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ", rarity: "rare", icon: "‚ùÑÔ∏è", 
                  price: 50, description: "–°–µ—Ä–¥—Ü–µ –ª–µ–¥—è–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞–ª—è" },
                { id: "mat_dragon_core", name: "–Ø–¥—Ä–æ –¥—Ä–∞–∫–æ–Ω–∞", rarity: "epic", icon: "üíé", 
                  price: 100, description: "–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —è–¥—Ä–æ –¥—Ä–µ–≤–Ω–µ–≥–æ –¥—Ä–∞–∫–æ–Ω–∞" },
                { id: "mat_titan_soul", name: "–î—É—à–∞ —Ç–∏—Ç–∞–Ω–∞", rarity: "legendary", icon: "üëª", 
                  price: 500, description: "–ë–µ—Å—Å–º–µ—Ä—Ç–Ω–∞—è –¥—É—à–∞ —Ç–∏—Ç–∞–Ω–∞" },
                { id: "mat_void_shard", name: "–û—Å–∫–æ–ª–æ–∫ –ø—É—Å—Ç–æ—Ç—ã", rarity: "mythical", icon: "‚ö´", 
                  price: 1000, description: "–û—Å–∫–æ–ª–æ–∫ —Å–∞–º–æ–π –ø—É—Å—Ç–æ—Ç—ã" },
                { id: "mat_god_essence", name: "–°—É—â–Ω–æ—Å—Ç—å –±–æ–≥–∞", rarity: "divine", icon: "‚ú®", 
                  price: 5000, description: "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å –±–æ–∂–µ—Å—Ç–≤–∞" },
                { id: "mat_phoenix_feather", name: "–ü–µ—Ä–æ —Ñ–µ–Ω–∏–∫—Å–∞", rarity: "legendary", icon: "üî•", 
                  price: 800, description: "–ü–µ—Ä–æ –≤–æ–∑—Ä–æ–∂–¥–∞—é—â–µ–≥–æ—Å—è —Ñ–µ–Ω–∏–∫—Å–∞" }
            ],
            
            // –û–°–û–ë–´–ï –ü–†–ï–î–ú–ï–¢–´ (15 –ø—Ä–µ–¥–º–µ—Ç–æ–≤)
            special: [
                { id: "item_legendary_key", name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–ª—é—á", rarity: "legendary", icon: "üîë", 
                  price: 5000, description: "–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ª—é–±—ã–µ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ —Å—É–Ω–¥—É–∫–∏" },
                { id: "item_dragon_egg", name: "–Ø–π—Ü–æ –¥—Ä–∞–∫–æ–Ω–∞", rarity: "mythical", icon: "ü•ö", 
                  price: 10000, description: "–Ø–π—Ü–æ –¥—Ä–µ–≤–Ω–µ–≥–æ –¥—Ä–∞–∫–æ–Ω–∞" },
                { id: "item_god_ticket", name: "–ë–∏–ª–µ—Ç –≤ –æ–±–∏—Ç–µ–ª—å –±–æ–≥–æ–≤", rarity: "divine", icon: "üé´", 
                  price: 20000, description: "–î–∞–µ—Ç –¥–æ—Å—Ç—É–ø –≤ –æ–±–∏—Ç–µ–ª—å –±–æ–≥–æ–≤" },
                { id: "item_lucky_coin", name: "–ú–æ–Ω–µ—Ç–∞ —É–¥–∞—á–∏", rarity: "epic", icon: "ü™ô", 
                  price: 1000, description: "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∞–Ω—Å –≤—ã–ø–∞–¥–µ–Ω–∏—è —Ä–µ–¥–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤" }
            ]
        };

        // ==================== –¢–ò–ü–´ –°–£–ù–î–£–ö–û–í ====================
        const CHEST_TYPES = [
            {
                id: "chest_common",
                name: "–û–±—ã—á–Ω—ã–π —Å—É–Ω–¥—É–∫",
                icon: "üéÅ",
                rarity: "common",
                cost: 100,
                openChance: 100,
                rewards: {
                    gold: { min: 50, max: 150, chance: 100 },
                    essence: { min: 5, max: 15, chance: 50 },
                    items: [
                        { type: "armor", rarity: "common", chance: 70 },
                        { type: "weapons", rarity: "common", chance: 60 },
                        { type: "potions", rarity: "common", chance: 80 }
                    ]
                }
            },
            {
                id: "chest_uncommon",
                name: "–ù–µ–æ–±—ã—á–Ω—ã–π —Å—É–Ω–¥—É–∫",
                icon: "üéÅ",
                rarity: "uncommon",
                cost: 250,
                openChance: 100,
                rewards: {
                    gold: { min: 150, max: 300, chance: 100 },
                    essence: { min: 15, max: 30, chance: 80 },
                    crystals: { min: 1, max: 3, chance: 40 },
                    items: [
                        { type: "armor", rarity: "uncommon", chance: 60 },
                        { type: "weapons", rarity: "uncommon", chance: 50 },
                        { type: "potions", rarity: "uncommon", chance: 70 },
                        { type: "materials", rarity: "common", chance: 90 }
                    ]
                }
            },
            {
                id: "chest_rare",
                name: "–†–µ–¥–∫–∏–π —Å—É–Ω–¥—É–∫",
                icon: "üíé",
                rarity: "rare",
                cost: 500,
                openChance: 100,
                rewards: {
                    gold: { min: 300, max: 600, chance: 100 },
                    essence: { min: 30, max: 60, chance: 100 },
                    crystals: { min: 3, max: 6, chance: 70 },
                    items: [
                        { type: "armor", rarity: "rare", chance: 50 },
                        { type: "weapons", rarity: "rare", chance: 40 },
                        { type: "wings", rarity: "rare", chance: 20 },
                        { type: "amulet", rarity: "rare", chance: 15 },
                        { type: "materials", rarity: "uncommon", chance: 80 }
                    ]
                }
            },
            {
                id: "chest_epic",
                name: "–≠–ø–∏—á–µ—Å–∫–∏–π —Å—É–Ω–¥—É–∫",
                icon: "üèÜ",
                rarity: "epic",
                cost: 1000,
                openChance: 100,
                rewards: {
                    gold: { min: 600, max: 1200, chance: 100 },
                    essence: { min: 60, max: 120, chance: 100 },
                    crystals: { min: 6, max: 12, chance: 90 },
                    items: [
                        { type: "armor", rarity: "epic", chance: 40 },
                        { type: "weapons", rarity: "epic", chance: 30 },
                        { type: "wings", rarity: "epic", chance: 15 },
                        { type: "amulet", rarity: "epic", chance: 10 },
                        { type: "special", rarity: "rare", chance: 5 }
                    ]
                }
            },
            {
                id: "chest_legendary",
                name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —Å—É–Ω–¥—É–∫",
                icon: "üëë",
                rarity: "legendary",
                cost: 2500,
                openChance: 100,
                rewards: {
                    gold: { min: 1200, max: 2500, chance: 100 },
                    essence: { min: 120, max: 240, chance: 100 },
                    crystals: { min: 12, max: 24, chance: 100 },
                    items: [
                        { type: "armor", rarity: "legendary", chance: 30 },
                        { type: "weapons", rarity: "legendary", chance: 25 },
                        { type: "wings", rarity: "legendary", chance: 10 },
                        { type: "amulet", rarity: "legendary", chance: 8 },
                        { type: "special", rarity: "epic", chance: 15 }
                    ]
                }
            },
            {
                id: "chest_mythical",
                name: "–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π —Å—É–Ω–¥—É–∫",
                icon: "üåü",
                rarity: "mythical",
                cost: 5000,
                openChance: 85, // 15% —à–∞–Ω—Å –Ω–µ—É–¥–∞—á–∏
                rewards: {
                    gold: { min: 2500, max: 5000, chance: 100 },
                    essence: { min: 250, max: 500, chance: 100 },
                    crystals: { min: 25, max: 50, chance: 100 },
                    items: [
                        { type: "armor", rarity: "mythical", chance: 20 },
                        { type: "weapons", rarity: "mythical", chance: 15 },
                        { type: "wings", rarity: "mythical", chance: 8 },
                        { type: "special", rarity: "legendary", chance: 30 }
                    ]
                }
            },
            {
                id: "chest_divine",
                name: "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—É–Ω–¥—É–∫",
                icon: "‚ú®",
                rarity: "divine",
                cost: 10000,
                openChance: 70, // 30% —à–∞–Ω—Å –Ω–µ—É–¥–∞—á–∏
                rewards: {
                    gold: { min: 5000, max: 10000, chance: 100 },
                    essence: { min: 500, max: 1000, chance: 100 },
                    crystals: { min: 50, max: 100, chance: 100 },
                    items: [
                        { type: "armor", rarity: "divine", chance: 10 },
                        { type: "weapons", rarity: "divine", chance: 8 },
                        { type: "special", rarity: "mythical", chance: 50 }
                    ]
                }
            },
            {
                id: "chest_seasonal",
                name: "–°–µ–∑–æ–Ω–Ω—ã–π —Å—É–Ω–¥—É–∫",
                icon: "üéÑ",
                rarity: "legendary",
                cost: 1500,
                openChance: 100,
                seasonal: true,
                rewards: {
                    gold: { min: 800, max: 1600, chance: 100 },
                    essence: { min: 80, max: 160, chance: 100 },
                    crystals: { min: 8, max: 16, chance: 100 },
                    items: [
                        { type: "special", rarity: "legendary", chance: 40 },
                        { type: "armor", rarity: "epic", chance: 60 },
                        { type: "weapons", rarity: "epic", chance: 50 }
                    ]
                }
            }
        ];

        // ==================== –í–†–ê–ì–ò ====================
        const ENEMIES = [
            {
                id: "enemy_young_dragon",
                name: "–ú–æ–ª–æ–¥–æ–π –¥—Ä–∞–∫–æ–Ω",
                level: 1,
                health: 300,
                attack: 40,
                defense: 20,
                speed: 80,
                critical: 10,
                dodge: 5,
                rewards: { xp: 50, gold: 100, essence: 5 }
            },
            {
                id: "enemy_fire_lizard",
                name: "–û–≥–Ω–µ–Ω–Ω—ã–π —è—â–µ—Ä",
                level: 3,
                health: 600,
                attack: 80,
                defense: 40,
                speed: 100,
                critical: 15,
                dodge: 10,
                rewards: { xp: 100, gold: 200, essence: 10, crystals: 1 }
            },
            {
                id: "enemy_ice_dragon",
                name: "–õ–µ–¥—è–Ω–æ–π –¥—Ä–∞–∫–æ–Ω",
                level: 5,
                health: 1000,
                attack: 120,
                defense: 60,
                speed: 120,
                critical: 20,
                dodge: 15,
                rewards: { xp: 200, gold: 400, essence: 20, crystals: 2 }
            },
            {
                id: "enemy_thunder_dragon",
                name: "–ì—Ä–æ–∑–æ–≤–æ–π –¥—Ä–∞–∫–æ–Ω",
                level: 10,
                health: 2000,
                attack: 200,
                defense: 100,
                speed: 150,
                critical: 25,
                dodge: 20,
                rewards: { xp: 500, gold: 1000, essence: 50, crystals: 5 }
            },
            {
                id: "enemy_ancient_dragon",
                name: "–î—Ä–µ–≤–Ω–∏–π –¥—Ä–∞–∫–æ–Ω",
                level: 15,
                health: 4000,
                attack: 350,
                defense: 180,
                speed: 180,
                critical: 30,
                dodge: 25,
                rewards: { xp: 1000, gold: 2000, essence: 100, crystals: 10 }
            },
            {
                id: "enemy_dragon_lord",
                name: "–î—Ä–∞–∫–æ–Ω–æ–≤–ª–∞–¥—ã–∫–∞",
                level: 20,
                health: 8000,
                attack: 600,
                defense: 300,
                speed: 200,
                critical: 35,
                dodge: 30,
                rewards: { xp: 2000, gold: 5000, essence: 200, crystals: 20 }
            },
            {
                id: "enemy_titan",
                name: "–¢–∏—Ç–∞–Ω",
                level: 25,
                health: 15000,
                attack: 900,
                defense: 500,
                speed: 180,
                critical: 40,
                dodge: 20,
                rewards: { xp: 5000, gold: 10000, essence: 500, crystals: 50 }
            }
        ];

        // ==================== –ë–û–°–°–´ ====================
        const BOSSES = [
            {
                id: "boss_phoenix",
                name: "–§–µ–Ω–∏–∫—Å –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è",
                level: 30,
                health: 30000,
                attack: 1200,
                defense: 800,
                speed: 250,
                critical: 50,
                dodge: 40,
                specialAbility: "–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ (–≤–æ—Å–∫—Ä–µ—Å–∞–µ—Ç 1 —Ä–∞–∑ —Å 50% –∑–¥–æ—Ä–æ–≤—å—è)",
                rewards: { xp: 10000, gold: 20000, essence: 1000, crystals: 100, items: ["helmet_phoenix", "chest_phoenix"] }
            },
            {
                id: "boss_leviathan",
                name: "–õ–µ–≤–∏–∞—Ñ–∞–Ω –ë–µ–∑–¥–Ω—ã",
                level: 35,
                health: 50000,
                attack: 1500,
                defense: 1200,
                speed: 200,
                critical: 45,
                dodge: 30,
                specialAbility: "–¶—É–Ω–∞–º–∏ (–Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω –≤—Å–µ–º –≤ –æ–±–ª–∞—Å—Ç–∏)",
                rewards: { xp: 20000, gold: 30000, essence: 2000, crystals: 200, items: ["chest_leviathan"] }
            },
            {
                id: "boss_void",
                name: "–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å –ü—É—Å—Ç–æ—Ç—ã",
                level: 40,
                health: 80000,
                attack: 2000,
                defense: 1500,
                speed: 300,
                critical: 60,
                dodge: 50,
                specialAbility: "–ü–æ–≥–ª–æ—â–µ–Ω–∏–µ (–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –æ—Ç –Ω–∞–Ω–µ—Å–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–Ω–∞)",
                rewards: { xp: 50000, gold: 50000, essence: 5000, crystals: 500, items: ["helmet_void", "weapon_void"] }
            },
            {
                id: "boss_god",
                name: "–ë–æ–≥ –î—Ä–∞–∫–æ–Ω–æ–≤",
                level: 50,
                health: 150000,
                attack: 3000,
                defense: 2500,
                speed: 400,
                critical: 75,
                dodge: 60,
                specialAbility: "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∫–∞—Ä–∞ (–º–∞—Å—Å–æ–≤—ã–π —É—Ä–æ–Ω + –æ–≥–ª—É—à–µ–Ω–∏–µ)",
                rewards: { xp: 100000, gold: 100000, essence: 10000, crystals: 1000, items: ["helmet_god", "weapon_god", "chest_eternity"] }
            }
        ];

        // ==================== –ö–í–ï–°–¢–´ ====================
        const QUESTS = [
            {
                id: "quest_tutorial",
                name: "–û–±—É—á–µ–Ω–∏–µ",
                description: "–ü—Ä–æ–π–¥–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ —É –º—É–¥—Ä–æ–≥–æ –¥—Ä–∞–∫–æ–Ω–∞",
                type: "story",
                chapter: 1,
                required: 3,
                rewards: { xp: 100, gold: 500, item: "helmet_beginner" },
                repeatable: false
            },
            {
                id: "quest_first_hunt",
                name: "–ü–µ—Ä–≤–∞—è –æ—Ö–æ—Ç–∞",
                description: "–í—ã–ø–æ–ª–Ω–∏—Ç–µ 5 –æ—Ö–æ—Ç",
                type: "hunt",
                chapter: 1,
                required: 5,
                rewards: { xp: 200, gold: 1000, essence: 50 },
                repeatable: false
            },
            {
                id: "quest_chest_collector",
                name: "–°–æ–±–∏—Ä–∞—Ç–µ–ª—å —Å–æ–∫—Ä–æ–≤–∏—â",
                description: "–û—Ç–∫—Ä–æ–π—Ç–µ 3 —Å—É–Ω–¥—É–∫–∞",
                type: "chest",
                chapter: 1,
                required: 3,
                rewards: { xp: 150, gold: 750, item: "chest_beginner" },
                repeatable: false
            },
            {
                id: "quest_dragon_slayer",
                name: "–£–±–∏–π—Ü–∞ –¥—Ä–∞–∫–æ–Ω–æ–≤",
                description: "–ü–æ–±–µ–¥–∏—Ç–µ 10 –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤ –≤ –±–∏—Ç–≤–∞—Ö",
                type: "battle",
                chapter: 2,
                required: 10,
                rewards: { xp: 500, gold: 2000, crystals: 10 },
                repeatable: true
            },
            {
                id: "quest_boss_hunter",
                name: "–û—Ö–æ—Ç–Ω–∏–∫ –Ω–∞ –±–æ—Å—Å–æ–≤",
                description: "–ü–æ–±–µ–¥–∏—Ç–µ 3 –±–æ—Å—Å–æ–≤",
                type: "boss",
                chapter: 3,
                required: 3,
                rewards: { xp: 5000, gold: 10000, essence: 1000 },
                repeatable: true
            }
        ];

        // ==================== –î–û–°–¢–ò–ñ–ï–ù–ò–Ø ====================
        const ACHIEVEMENTS = [
            {
                id: "ach_first_steps",
                name: "–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏",
                description: "–ù–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É",
                icon: "üë£",
                reward: { gold: 100 },
                condition: () => true
            },
            {
                id: "ach_first_hunt",
                name: "–ü–µ—Ä–≤—ã–π –æ—Ö–æ—Ç–Ω–∏–∫",
                description: "–í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–≤—É—é –æ—Ö–æ—Ç—É",
                icon: "üèπ",
                reward: { gold: 250, essence: 50 },
                condition: (state) => state.xp > 0
            },
            {
                id: "ach_level_10",
                name: "–û–ø—ã—Ç–Ω—ã–π –¥—Ä–∞–∫–æ–Ω",
                description: "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 10 —É—Ä–æ–≤–Ω—è",
                icon: "‚≠ê",
                reward: { gold: 1000, crystals: 10 },
                condition: (state) => state.level >= 10
            },
            {
                id: "ach_gold_master",
                name: "–ú–∞—Å—Ç–µ—Ä –∑–æ–ª–æ—Ç–∞",
                description: "–°–æ–±–µ—Ä–∏—Ç–µ 10,000 –∑–æ–ª–æ—Ç–∞",
                icon: "üí∞",
                reward: { gold: 5000, crystals: 25 },
                condition: (state) => state.gold >= 10000
            },
            {
                id: "ach_boss_slayer",
                name: "–£–±–∏–π—Ü–∞ –±–æ—Å—Å–æ–≤",
                description: "–ü–æ–±–µ–¥–∏—Ç–µ 10 –±–æ—Å—Å–æ–≤",
                icon: "üëπ",
                reward: { gold: 10000, crystals: 100 },
                condition: (state) => Object.values(state.bossKills).reduce((a, b) => a + b, 0) >= 10
            }
        ];

        // ==================== –î–ò–ê–õ–û–ì–ò –°–Æ–ñ–ï–¢–ê ====================
        const DIALOGUES = {
            tutorial: [
                {
                    speaker: "–ú—É–¥—Ä—ã–π –î—Ä–∞–∫–æ–Ω",
                    text: "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, –º–æ–ª–æ–¥–æ–π –¥—Ä–∞–∫–æ–Ω! –Ø –±—É–¥—É —Ç–≤–æ–∏–º –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–º –≤ —ç—Ç–æ–º –º–∏—Ä–µ.",
                    choices: [
                        { text: "–ö—Ç–æ –≤—ã?", next: "tutorial_1" },
                        { text: "–ì–¥–µ —è?", next: "tutorial_2" }
                    ]
                },
                {
                    id: "tutorial_1",
                    speaker: "–ú—É–¥—Ä—ã–π –î—Ä–∞–∫–æ–Ω",
                    text: "–Ø - –¥—Ä–µ–≤–Ω–∏–π –¥—Ä–∞–∫–æ–Ω, —Å—Ç—Ä–∞–∂ —ç—Ç–∏—Ö –∑–µ–º–µ–ª—å. –ú–æ–µ –∏–º—è –∑–∞–±—ã—Ç–æ –≤–µ–∫–∞–º–∏, –Ω–æ —Ç—ã –º–æ–∂–µ—à—å –Ω–∞–∑—ã–≤–∞—Ç—å –º–µ–Ω—è –ù–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–º.",
                    choices: [
                        { text: "–ß—Ç–æ –º–Ω–µ –¥–µ–ª–∞—Ç—å?", next: "tutorial_3" },
                        { text: "–ü–æ—á–µ–º—É —è –∑–¥–µ—Å—å?", next: "tutorial_4" }
                    ]
                },
                {
                    id: "tutorial_2",
                    speaker: "–ú—É–¥—Ä—ã–π –î—Ä–∞–∫–æ–Ω",
                    text: "–¢—ã –≤ –º–∏—Ä–µ –¥—Ä–∞–∫–æ–Ω–æ–≤ - –º–µ—Å—Ç–µ —Å–∏–ª—ã, –º–∞–≥–∏–∏ –∏ –¥—Ä–µ–≤–Ω–∏—Ö –ª–µ–≥–µ–Ω–¥. –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å —Å—Ç–∞—Ç—å –≤–µ–ª–∏—á–∞–π—à–∏–º –¥—Ä–∞–∫–æ–Ω–æ–º –≤—Å–µ—Ö –≤—Ä–µ–º–µ–Ω.",
                    choices: [
                        { text: "–ö–∞–∫ —Å—Ç–∞—Ç—å —Å–∏–ª—å–Ω–µ–µ?", next: "tutorial_3" },
                        { text: "–ö–∞–∫–∏–µ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å?", next: "tutorial_5" }
                    ]
                },
                {
                    id: "tutorial_3",
                    speaker: "–ú—É–¥—Ä—ã–π –î—Ä–∞–∫–æ–Ω",
                    text: "–ù–∞—á–Ω–∏ —Å –æ—Ö–æ—Ç—ã - —ç—Ç–æ –¥–∞—Å—Ç —Ç–µ–±–µ –æ–ø—ã—Ç –∏ —Ä–µ—Å—É—Ä—Å—ã. –ó–∞—Ç–µ–º –æ—Ç–∫—Ä—ã–≤–∞–π —Å—É–Ω–¥—É–∫–∏, —ç–∫–∏–ø–∏—Ä—É–π—Å—è –∏ —Å—Ä–∞–∂–∞–π—Å—è —Å –≤—Ä–∞–≥–∞–º–∏.",
                    choices: [
                        { text: "–°–ø–∞—Å–∏–±–æ –∑–∞ —Å–æ–≤–µ—Ç!", action: "completeTutorial", next: "end" },
                        { text: "–ï—Å—Ç—å –ª–∏ –∑–∞–¥–∞–Ω–∏—è?", next: "tutorial_6" }
                    ]
                }
            ],
            chapter1: [
                {
                    speaker: "–°—Ç—Ä–∞–∂ –í—Ä–∞—Ç",
                    text: "–¢—ã –Ω–æ–≤–∏—á–æ–∫? –ü—Ä–æ–π–¥–∏ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ —É —Ä–µ–∫–∏ –æ–≥–Ω—è, —á—Ç–æ–±—ã –¥–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ—é —Å–∏–ª—É.",
                    choices: [
                        { text: "–ü—Ä–∏–Ω—è—Ç—å –∏—Å–ø—ã—Ç–∞–Ω–∏–µ", action: "startRiverTrial", next: "end" },
                        { text: "–í–µ—Ä–Ω—É—Ç—å—Å—è –ø–æ–∑–∂–µ", next: "end" }
                    ]
                }
            ]
        };

        // ==================== –≠–í–û–õ–Æ–¶–ò–ò ====================
        const EVOLUTIONS = [
            {
                id: "evo_fire_dragon",
                name: "–û–≥–Ω–µ–Ω–Ω—ã–π –î—Ä–∞–∫–æ–Ω",
                description: "–ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –≤ —á–∏—Å—Ç–æ –æ–≥–Ω–µ–Ω–Ω–æ–≥–æ –¥—Ä–∞–∫–æ–Ω–∞",
                levelRequired: 10,
                cost: { gold: 5000, essence: 1000, crystals: 50 },
                stats: { fireDamage: 100, attack: 50, health: 500 },
                icon: "üî•"
            },
            {
                id: "evo_ice_dragon",
                name: "–õ–µ–¥—è–Ω–æ–π –î—Ä–∞–∫–æ–Ω",
                description: "–ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –ª–µ–¥—è–Ω–æ–≥–æ –¥—Ä–∞–∫–æ–Ω–∞",
                levelRequired: 15,
                cost: { gold: 8000, essence: 1500, crystals: 75 },
                stats: { iceDamage: 100, defense: 60, health: 400 },
                icon: "‚ùÑÔ∏è"
            },
            {
                id: "evo_ancient_dragon",
                name: "–î—Ä–µ–≤–Ω–∏–π –î—Ä–∞–∫–æ–Ω",
                description: "–ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –¥—Ä–µ–≤–Ω–µ–π –∫—Ä–æ–≤–∏",
                levelRequired: 25,
                cost: { gold: 20000, essence: 5000, crystals: 200 },
                stats: { allStats: 50, health: 1000 },
                icon: "üêâ"
            },
            {
                id: "evo_dragon_lord",
                name: "–î—Ä–∞–∫–æ–Ω–æ–≤–ª–∞–¥—ã–∫–∞",
                description: "–°—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≤–µ–ª–∏—Ç–µ–ª–µ–º –¥—Ä–∞–∫–æ–Ω–æ–≤",
                levelRequired: 40,
                cost: { gold: 50000, essence: 10000, crystals: 500 },
                stats: { allStats: 100, critical: 30 },
                icon: "üëë"
            }
        ];

        // ==================== –ü–û–î–ó–ï–ú–ï–õ–¨–Ø ====================
        const DUNGEONS = [
            {
                id: "dungeon_fire_cave",
                name: "–û–≥–Ω–µ–Ω–Ω–∞—è –ü–µ—â–µ—Ä–∞",
                level: 5,
                floors: 10,
                rewards: { gold: 5000, essence: 1000, crystals: 50 },
                boss: "enemy_fire_lizard"
            },
            {
                id: "dungeon_ice_cavern",
                name: "–õ–µ–¥—è–Ω–∞—è –ü–µ—â–µ—Ä–∞",
                level: 10,
                floors: 15,
                rewards: { gold: 10000, essence: 2000, crystals: 100 },
                boss: "enemy_ice_dragon"
            },
            {
                id: "dungeon_thunder_mountain",
                name: "–ì—Ä–æ–º–æ–≤–∞—è –ì–æ—Ä–∞",
                level: 15,
                floors: 20,
                rewards: { gold: 20000, essence: 5000, crystals: 200 },
                boss: "enemy_thunder_dragon"
            }
        ];

        // ==================== –¢–†–ï–ù–ò–†–û–í–ö–ò ====================
        const TRAINING_TYPES = [
            {
                id: "train_attack",
                name: "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∞—Ç–∞–∫–∏",
                cost: { energy: 20 },
                duration: 300, // 5 –º–∏–Ω—É—Ç
                reward: { attack: 5, xp: 50 }
            },
            {
                id: "train_defense",
                name: "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞—â–∏—Ç—ã",
                cost: { energy: 20 },
                duration: 300,
                reward: { defense: 3, xp: 50 }
            },
            {
                id: "train_speed",
                name: "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏",
                cost: { energy: 25 },
                duration: 240, // 4 –º–∏–Ω—É—Ç—ã
                reward: { speed: 10, xp: 75 }
            },
            {
                id: "train_master",
                name: "–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞",
                cost: { energy: 40, gold: 500 },
                duration: 600, // 10 –º–∏–Ω—É—Ç
                reward: { allStats: 3, xp: 200 }
            }
        ];

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let currentBattle = null;
        let currentEnemy = null;
        let currentDialogue = null;
        let gameInterval = null;
        let energyInterval = null;
        let saveInterval = null;
        let activeTraining = null;

        // ==================== –°–ò–°–¢–ï–ú–ê –ó–ê–ì–†–£–ó–ö–ò ====================
        const loadingPhases = [
            { text: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–¥—Ä–∞ –¥—Ä–∞–∫–æ–Ω–∞...", progress: 10 },
            { text: "–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—Å—Ç—É—Ä –∏ –∞–Ω–∏–º–∞—Ü–∏–π...", progress: 25 },
            { text: "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏—Ä–∞ –¥—Ä–∞–∫–æ–Ω–æ–≤...", progress: 40 },
            { text: "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º –±–æ—è...", progress: 55 },
            { text: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è...", progress: 70 },
            { text: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–≤–µ—Å—Ç–æ–≤...", progress: 85 },
            { text: "–ê–∫—Ç–∏–≤–∞—Ü–∏—è –º–∞–≥–∏–∏...", progress: 95 },
            { text: "–ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ –¥–≤–∏–∂–∫–∞...", progress: 100 }
        ];

        function simulateLoading() {
            let currentPhase = 0;
            const progressBar = document.getElementById('loadingProgress');
            const loadingText = document.getElementById('loadingText');
            
            function updateLoading() {
                if (currentPhase >= loadingPhases.length) {
                    // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
                    document.getElementById('loadingScreen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        document.getElementById('mainMenu').style.display = 'flex';
                    }, 500);
                    return;
                }
                
                const phase = loadingPhases[currentPhase];
                progressBar.style.width = phase.progress + '%';
                loadingText.textContent = phase.text;
                
                currentPhase++;
                setTimeout(updateLoading, 300 + Math.random() * 200);
            }
            
            updateLoading();
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´ ====================
        function startGame() {
            // –°–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
            document.getElementById('mainMenu').style.display = 'none';
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É
            initializeNewGame();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('gameContainer').style.display = 'block';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤—ã–µ —Ü–∏–∫–ª—ã
            startGameLoops();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            showNotification("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –¥—Ä–∞–∫–æ–Ω–æ–≤!");
            addLog("üöÄ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –£–¥–∞—á–∏ –≤ —Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ–ª–∏—á–∞–π—à–∏–º –¥—Ä–∞–∫–æ–Ω–æ–º!", "info");
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—É—á–∞—é—â–∏–π –¥–∏–∞–ª–æ–≥
            setTimeout(() => startDialogue("tutorial"), 1000);
        }

        function initializeNewGame() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            gameState = {
                version: GAME_VERSION,
                dragonName: "–î—Ä–∞–∫–æ–Ω –ê–≥–∞—Ñ–æ–Ω–æ–≤–∞",
                level: 1,
                xp: 0,
                xpToNextLevel: 100,
                gold: 1000,
                essence: 500,
                crystals: 50,
                energy: 100,
                maxEnergy: 100,
                energyRegenTime: Date.now(),
                skillPoints: 0,
                
                storyProgress: {
                    chapter: 1,
                    stage: 0,
                    completedDialogues: [],
                    currentQuest: "quest_tutorial"
                },
                
                baseStats: {
                    attack: 150,
                    defense: 75,
                    health: 1000,
                    maxHealth: 1000,
                    speed: 120,
                    critical: 15,
                    dodge: 10,
                    armor: 0,
                    fireDamage: 50,
                    iceDamage: 0,
                    poisonDamage: 0,
                    lightningDamage: 0
                },
                
                equipmentBonus: {
                    attack: 0,
                    defense: 0,
                    health: 0,
                    speed: 0,
                    critical: 0,
                    dodge: 0,
                    armor: 0,
                    fireDamage: 0,
                    iceDamage: 0,
                    poisonDamage: 0,
                    lightningDamage: 0
                },
                
                activeBuffs: [],
                equipment: {
                    head: null,
                    chest: null,
                    legs: null,
                    weapon: null,
                    wings: null,
                    amulet: null,
                    ring1: null,
                    ring2: null
                },
                
                inventory: {
                    armor: [],
                    weapons: [],
                    potions: [
                        { id: "potion_health_small", count: 3 },
                        { id: "potion_energy", count: 2 }
                    ],
                    materials: [
                        { id: "mat_dragon_scale", count: 5 }
                    ],
                    special: []
                },
                
                enchants: [],
                activeQuests: [
                    { id: "quest_tutorial", progress: 0, completed: false },
                    { id: "quest_first_hunt", progress: 0, completed: false }
                ],
                completedQuests: [],
                failedQuests: [],
                achievements: [],
                unlockedTechnologies: [],
                
                clan: {
                    name: "",
                    level: 0,
                    members: [],
                    resources: 0
                },
                
                dungeonProgress: {},
                bossKills: {},
                
                pvpStats: {
                    wins: 0,
                    losses: 0,
                    rating: 1000
                },
                
                gameTime: 0,
                discoveredRecipes: [],
                
                skills: {
                    fireBreath: { level: 1, maxLevel: 10, xp: 0 },
                    iceBreath: { level: 0, maxLevel: 10, xp: 0 },
                    poisonBreath: { level: 0, maxLevel: 10, xp: 0 },
                    healingFlames: { level: 0, maxLevel: 10, xp: 0 },
                    dragonRage: { level: 0, maxLevel: 10, xp: 0 },
                    thunderStrike: { level: 0, maxLevel: 10, xp: 0 }
                },
                
                evolutionStage: 1,
                availableEvolutions: [],
                
                dailyRewards: {},
                eventProgress: {},
                
                settings: {
                    musicVolume: 50,
                    soundVolume: 70,
                    showAnimations: true,
                    notifications: true,
                    autoSave: true
                },
                
                lastSave: Date.now()
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
            updateInventory('armor');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            checkAchievements();
        }

        function loadGame() {
            try {
                const savedData = localStorage.getItem('dragonEvolutionSave');
                if (!savedData) {
                    showNotification("–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –∏–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!");
                    return;
                }
                
                const loadedState = JSON.parse(savedData);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                if (loadedState.version !== GAME_VERSION) {
                    showNotification("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏. –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É.");
                    startGame();
                    return;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                Object.assign(gameState, loadedState);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
                document.getElementById('mainMenu').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤—ã–µ —Ü–∏–∫–ª—ã
                startGameLoops();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateUI();
                updateInventory('armor');
                
                showNotification("–ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!");
                addLog("‚ö° –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è", "info");
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
                showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!");
            }
        }

        // ==================== –ò–ì–†–û–í–´–ï –¶–ò–ö–õ–´ ====================
        function startGameLoops() {
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
            if (gameInterval) clearInterval(gameInterval);
            if (energyInterval) clearInterval(energyInterval);
            if (saveInterval) clearInterval(saveInterval);
            
            // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
            gameInterval = setInterval(() => {
                updateGameState();
            }, 1000);
            
            // –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–∏–∏ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)
            energyInterval = setInterval(() => {
                regenEnergy();
            }, 30000);
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)
            saveInterval = setInterval(() => {
                if (gameState.settings.autoSave) {
                    autoSave();
                }
            }, 120000);
        }

        function updateGameState() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∏–≥—Ä—ã
            gameState.gameTime++;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –±–∞—Ñ—Ñ—ã
            updateBuffs();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            updateTraining();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–≤–µ—Å—Ç—ã
            updateQuests();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
        }

        function regenEnergy() {
            if (gameState.energy < gameState.maxEnergy) {
                const regenAmount = Math.floor(gameState.maxEnergy * 0.1);
                gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + regenAmount);
                gameState.energyRegenTime = Date.now();
                
                if (regenAmount > 0) {
                    addLog(`‚ö° –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${regenAmount} —ç–Ω–µ—Ä–≥–∏–∏`, "info");
                }
            }
        }

        function autoSave() {
            try {
                gameState.lastSave = Date.now();
                localStorage.setItem('dragonEvolutionSave', JSON.stringify(gameState));
                console.log("–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", error);
            }
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –û–•–û–¢–´ ====================
        function startHunt() {
            if (gameState.energy < 10) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –æ—Ö–æ—Ç—ã!");
                return;
            }
            
            if (gameState.stats.health <= 0) {
                showNotification("–í–∞—à –¥—Ä–∞–∫–æ–Ω —Å–ª–∏—à–∫–æ–º —Å–ª–∞–± –¥–ª—è –æ—Ö–æ—Ç—ã!");
                return;
            }
            
            gameState.energy -= 10;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ –æ—Ö–æ—Ç—ã
            const eventRoll = Math.random();
            let result = null;
            
            if (eventRoll < 0.6) { // 60% - —É—Å–ø–µ—à–Ω–∞—è –æ—Ö–æ—Ç–∞
                result = generateHuntSuccess();
            } else if (eventRoll < 0.8) { // 20% - –≤—Å—Ç—Ä–µ—á–∞ —Å –≤—Ä–∞–≥–æ–º
                result = generateEnemyEncounter();
            } else if (eventRoll < 0.9) { // 10% - –æ—Å–æ–±–æ–µ —Å–æ–±—ã—Ç–∏–µ
                result = generateSpecialEvent();
            } else { // 10% - –Ω–µ—É–¥–∞—á–∞
                result = generateHuntFailure();
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            applyHuntResult(result);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–≤–µ—Å—Ç–æ–≤
            if (result.type === "success" || result.type === "enemy") {
                updateQuestProgress("hunt", 1);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
        }

        function generateHuntSuccess() {
            const baseGold = Math.floor(Math.random() * 100) + 50 + gameState.level * 10;
            const baseXp = Math.floor(Math.random() * 30) + 20 + gameState.level * 5;
            const essenceFound = Math.random() < 0.3 ? Math.floor(Math.random() * 10) + 5 : 0;
            
            const result = {
                type: "success",
                gold: baseGold,
                xp: baseXp,
                essence: essenceFound,
                items: []
            };
            
            // –®–∞–Ω—Å –Ω–∞–π—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç
            if (Math.random() < 0.25) {
                const itemType = Math.random() < 0.5 ? "armor" : "weapons";
                const rarityRoll = Math.random();
                let rarity = "common";
                
                if (rarityRoll < 0.6) rarity = "common";
                else if (rarityRoll < 0.85) rarity = "uncommon";
                else if (rarityRoll < 0.95) rarity = "rare";
                else if (rarityRoll < 0.99) rarity = "epic";
                else rarity = "legendary";
                
                const availableItems = ITEM_DATABASE[itemType].filter(item => item.rarity === rarity && item.level <= gameState.level);
                if (availableItems.length > 0) {
                    const item = availableItems[Math.floor(Math.random() * availableItems.length)];
                    result.items.push({ ...item, category: itemType });
                }
            }
            
            // –®–∞–Ω—Å –Ω–∞–π—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª
            if (Math.random() < 0.4) {
                const materials = ITEM_DATABASE.materials.filter(mat => 
                    (mat.rarity === "common" || mat.rarity === "uncommon") && Math.random() < 0.7
                );
                if (materials.length > 0) {
                    const material = materials[Math.floor(Math.random() * materials.length)];
                    result.items.push({ ...material, category: "materials" });
                }
            }
            
            return result;
        }

        function generateEnemyEncounter() {
            // –í—ã–±–∏—Ä–∞–µ–º –≤—Ä–∞–≥–∞ –ø–æ —É—Ä–æ–≤–Ω—é –∏–≥—Ä–æ–∫–∞
            const availableEnemies = ENEMIES.filter(enemy => enemy.level <= gameState.level + 2);
            const enemy = availableEnemies[Math.floor(Math.random() * availableEnemies.length)];
            
            return {
                type: "enemy",
                enemy: enemy
            };
        }

        function generateSpecialEvent() {
            const events = [
                {
                    type: "treasure",
                    text: "–í—ã –Ω–∞—à–ª–∏ –¥—Ä–µ–≤–Ω–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç!",
                    rewards: { crystals: 5, gold: 500 }
                },
                {
                    type: "cave",
                    text: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å–∫—Ä—ã—Ç–∞—è –ø–µ—â–µ—Ä–∞ —Å —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏!",
                    rewards: { gold: 500, essence: 50, items: ["mat_dragon_scale"] }
                },
                {
                    type: "wisdom",
                    text: "–í—Å—Ç—Ä–µ—Ç–∏–ª–∏ –º—É–¥—Ä–æ–≥–æ –¥—Ä–∞–∫–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–µ–ª–∏–ª—Å—è –∑–Ω–∞–Ω–∏—è–º–∏",
                    rewards: { xp: 100, skillPoints: 1 }
                },
                {
                    type: "mystery",
                    text: "–ù–∞—à–ª–∏ —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–≤–∏—Ç–æ–∫ —Å –¥—Ä–µ–≤–Ω–∏–º–∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è–º–∏",
                    rewards: { essence: 100, enchants: ["fire_boost"] }
                }
            ];
            
            return events[Math.floor(Math.random() * events.length)];
        }

        function generateHuntFailure() {
            const failures = [
                {
                    type: "failure",
                    text: "–û—Ö–æ—Ç–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å. –í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∏ —Å —á–µ–º.",
                    penalty: { energy: 5 }
                },
                {
                    type: "failure",
                    text: "–í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ —á–∞—Å—Ç—å —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è –≤ –±–æ–ª–æ—Ç–µ.",
                    penalty: { gold: 50 }
                },
                {
                    type: "failure",
                    text: "–í–∞—Å –∞—Ç–∞–∫–æ–≤–∞–ª–∏ —Ä–∞–∑–±–æ–π–Ω–∏–∫–∏ –∏ –∑–∞–±—Ä–∞–ª–∏ —á–∞—Å—Ç—å –¥–æ–±—ã—á–∏.",
                    penalty: { gold: 100, health: 50 }
                }
            ];
            
            return failures[Math.floor(Math.random() * failures.length)];
        }

        function applyHuntResult(result) {
            let logMessage = "";
            let logType = "info";
            
            switch(result.type) {
                case "success":
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
                    gameState.gold += result.gold;
                    gameState.xp += result.xp;
                    gameState.essence += result.essence;
                    
                    logMessage = `üèπ –û—Ö–æ—Ç–∞ —É—Å–ø–µ—à–Ω–∞! –ü–æ–ª—É—á–µ–Ω–æ: ${result.gold} –∑–æ–ª–æ—Ç–∞, ${result.xp} –æ–ø—ã—Ç–∞`;
                    if (result.essence > 0) logMessage += `, ${result.essence} —ç—Å—Å–µ–Ω—Ü–∏–∏`;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã
                    result.items.forEach(item => {
                        addItemToInventory(item);
                        logMessage += `, ${item.name}`;
                    });
                    
                    logType = "loot";
                    break;
                    
                case "enemy":
                    // –ù–∞—á–∏–Ω–∞–µ–º –±–æ–π —Å –≤—Ä–∞–≥–æ–º
                    startBattle(result.enemy);
                    logMessage = `‚öîÔ∏è –í–æ –≤—Ä–µ–º—è –æ—Ö–æ—Ç—ã –≤—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ ${result.enemy.name}!`;
                    logType = "damage";
                    break;
                    
                case "treasure":
                case "cave":
                case "wisdom":
                case "mystery":
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞–≥—Ä–∞–¥—ã
                    if (result.rewards.gold) gameState.gold += result.rewards.gold;
                    if (result.rewards.xp) gameState.xp += result.rewards.xp;
                    if (result.rewards.essence) gameState.essence += result.rewards.essence;
                    if (result.rewards.crystals) gameState.crystals += result.rewards.crystals;
                    if (result.rewards.skillPoints) gameState.skillPoints += result.rewards.skillPoints;
                    if (result.rewards.items) {
                        result.rewards.items.forEach(itemId => {
                            const item = findItemById(itemId);
                            if (item) addItemToInventory(item);
                        });
                    }
                    
                    logMessage = `üåü ${result.text}`;
                    if (result.rewards) {
                        logMessage += " –ü–æ–ª—É—á–µ–Ω—ã –Ω–∞–≥—Ä–∞–¥—ã!";
                    }
                    logType = "loot";
                    break;
                    
                case "failure":
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —à—Ç—Ä–∞—Ñ—ã
                    if (result.penalty.energy) gameState.energy = Math.max(0, gameState.energy - result.penalty.energy);
                    if (result.penalty.gold) gameState.gold = Math.max(0, gameState.gold - result.penalty.gold);
                    if (result.penalty.health) gameState.baseStats.health = Math.max(1, gameState.baseStats.health - result.penalty.health);
                    
                    logMessage = `üí• ${result.text}`;
                    logType = "damage";
                    break;
            }
            
            addLog(logMessage, logType);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            checkLevelUp();
        }

        // ==================== –ë–û–ï–í–ê–Ø –°–ò–°–¢–ï–ú–ê ====================
        function startBattle(enemy, isBoss = false) {
            currentBattle = {
                enemy: enemy,
                isBoss: isBoss,
                playerHealth: gameState.stats.health,
                enemyHealth: enemy.health,
                playerMaxHealth: gameState.stats.health,
                enemyMaxHealth: enemy.health,
                turn: "player",
                round: 1,
                battleLog: []
            };
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–æ–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('battleContainer').style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI –±–∏—Ç–≤—ã
            updateBattleUI();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥
            addLog(`‚öîÔ∏è –ù–∞—á–∞–ª–∞—Å—å –±–∏—Ç–≤–∞ —Å ${enemy.name}${isBoss ? " (–ë–û–°–°)" : ""}!`, "damage");
        }

        function updateBattleUI() {
            if (!currentBattle) return;
            
            const { enemy, playerHealth, enemyHealth, playerMaxHealth, enemyMaxHealth } = currentBattle;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–µ–Ω–∞
            document.getElementById('battlePlayerName').textContent = gameState.dragonName;
            document.getElementById('battleEnemyName').textContent = enemy.name + (currentBattle.isBoss ? " ‚≠ê" : "");
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
            const playerHealthPercent = Math.max(0, (playerHealth / playerMaxHealth) * 100);
            const enemyHealthPercent = Math.max(0, (enemyHealth / enemyMaxHealth) * 100);
            
            document.getElementById('playerHealthBar').style.width = `${playerHealthPercent}%`;
            document.getElementById('enemyHealthBar').style.width = `${enemyHealthPercent}%`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('playerBattleStats').innerHTML = `
                <div>–£—Ä–æ–≤–µ–Ω—å: ${gameState.level}</div>
                <div>–ê—Ç–∞–∫–∞: ${gameState.stats.attack}</div>
                <div>–ó–∞—â–∏—Ç–∞: ${gameState.stats.defense}</div>
                <div>–ó–¥–æ—Ä–æ–≤—å–µ: ${playerHealth}/${playerMaxHealth}</div>
            `;
            
            document.getElementById('enemyBattleStats').innerHTML = `
                <div>–£—Ä–æ–≤–µ–Ω—å: ${enemy.level}</div>
                <div>–ê—Ç–∞–∫–∞: ${enemy.attack}</div>
                <div>–ó–∞—â–∏—Ç–∞: ${enemy.defense}</div>
                <div>–ó–¥–æ—Ä–æ–≤—å–µ: ${enemyHealth}/${enemyMaxHealth}</div>
            `;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–π—Å—Ç–≤–∏—è
            updateBattleActions();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–≥ –±–∏—Ç–≤—ã
            updateBattleLog();
        }

        function updateBattleActions() {
            const battleActions = document.getElementById('battleActions');
            battleActions.innerHTML = '';
            
            const actions = [
                { 
                    name: "–ê—Ç–∞–∫–∞", 
                    icon: "‚öîÔ∏è", 
                    action: () => performAttack(),
                    description: "–ë–∞–∑–æ–≤–∞—è –∞—Ç–∞–∫–∞"
                },
                { 
                    name: "–û–≥–Ω–µ–Ω–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ", 
                    icon: "üî•", 
                    action: () => useSkill("fireBreath"),
                    description: "–û–≥–Ω–µ–Ω–Ω–∞—è –∞—Ç–∞–∫–∞",
                    disabled: gameState.skills.fireBreath.level === 0
                },
                { 
                    name: "–ó–∞—â–∏—Ç–∞", 
                    icon: "üõ°Ô∏è", 
                    action: () => useDefense(),
                    description: "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É"
                },
                { 
                    name: "–ò—Å—Ü–µ–ª–µ–Ω–∏–µ", 
                    icon: "‚ù§Ô∏è", 
                    action: () => useHealing(),
                    description: "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ"
                },
                { 
                    name: "–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è", 
                    icon: "üß™", 
                    action: () => usePotionInBattle("health"),
                    description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–µ–ª—å–µ"
                },
                { 
                    name: "–ë–µ–≥—Å—Ç–≤–æ", 
                    icon: "üèÉ", 
                    action: () => attemptEscape(),
                    description: "–ü–æ–ø—ã—Ç–∫–∞ —É–±–µ–∂–∞—Ç—å",
                    disabled: currentBattle.isBoss
                }
            ];
            
            actions.forEach(action => {
                const button = document.createElement('button');
                button.className = 'battle-action';
                button.innerHTML = `${action.icon} ${action.name}`;
                button.onclick = action.action;
                button.disabled = action.disabled || currentBattle.turn !== "player";
                button.title = action.description;
                battleActions.appendChild(button);
            });
        }

        function performAttack() {
            if (!currentBattle || currentBattle.turn !== "player") return;
            
            const { enemy } = currentBattle;
            
            // –†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞
            let damage = gameState.stats.attack;
            
            // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä
            const critChance = gameState.stats.critical;
            const isCritical = Math.random() * 100 < critChance;
            if (isCritical) damage *= 2;
            
            // –£—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—â–∏—Ç—É –≤—Ä–∞–≥–∞
            damage = Math.max(1, damage - (enemy.defense / 2));
            
            // –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω
            currentBattle.enemyHealth -= damage;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ª–æ–≥
            const logMessage = isCritical 
                ? `üéØ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä! –í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${damage} —É—Ä–æ–Ω–∞!`
                : `‚öîÔ∏è –í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${damage} —É—Ä–æ–Ω–∞.`;
            
            addBattleLog(logMessage);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
            if (currentBattle.enemyHealth <= 0) {
                endBattle(true);
                return;
            }
            
            // –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –≤—Ä–∞–≥—É
            currentBattle.turn = "enemy";
            setTimeout(enemyTurn, 1500);
            
            updateBattleUI();
        }

        function enemyTurn() {
            if (!currentBattle || currentBattle.turn !== "enemy") return;
            
            const { enemy } = currentBattle;
            
            // –í—Ä–∞–≥ –∞—Ç–∞–∫—É–µ—Ç
            let damage = enemy.attack;
            
            // –£—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—â–∏—Ç—É –∏–≥—Ä–æ–∫–∞
            damage = Math.max(1, damage - (gameState.stats.defense / 2));
            
            // –£–∫–ª–æ–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            const dodgeChance = gameState.stats.dodge;
            const isDodged = Math.random() * 100 < dodgeChance;
            
            if (isDodged) {
                addBattleLog(`üåÄ –í—ã —É–∫–ª–æ–Ω–∏–ª–∏—Å—å –æ—Ç –∞—Ç–∞–∫–∏ ${enemy.name}!`);
            } else {
                // –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω
                currentBattle.playerHealth -= damage;
                addBattleLog(`‚öîÔ∏è ${enemy.name} –Ω–∞–Ω–æ—Å–∏—Ç ${damage} —É—Ä–æ–Ω–∞.`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä–∞–∂–µ–Ω–∏–µ
                if (currentBattle.playerHealth <= 0) {
                    endBattle(false);
                    return;
                }
            }
            
            // –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∏–≥—Ä–æ–∫—É
            currentBattle.turn = "player";
            currentBattle.round++;
            
            updateBattleUI();
        }

        function useSkill(skillName) {
            if (!currentBattle || currentBattle.turn !== "player") return;
            
            const skill = gameState.skills[skillName];
            if (!skill || skill.level === 0) {
                addBattleLog("–ù–∞–≤—ã–∫ –µ—â–µ –Ω–µ –∏–∑—É—á–µ–Ω!", "info");
                return;
            }
            
            const { enemy } = currentBattle;
            let damage = 0;
            let message = "";
            
            switch(skillName) {
                case "fireBreath":
                    damage = gameState.stats.attack * 1.5 + gameState.stats.fireDamage * skill.level;
                    message = `üî• –û–≥–Ω–µ–Ω–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ –Ω–∞–Ω–æ—Å–∏—Ç ${damage} —É—Ä–æ–Ω–∞!`;
                    break;
                default:
                    damage = gameState.stats.attack * 1.2;
                    message = `‚ú® –ù–∞–≤—ã–∫ –Ω–∞–Ω–æ—Å–∏—Ç ${damage} —É—Ä–æ–Ω–∞!`;
            }
            
            currentBattle.enemyHealth -= damage;
            addBattleLog(message, "damage");
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
            if (currentBattle.enemyHealth <= 0) {
                endBattle(true);
                return;
            }
            
            // –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –≤—Ä–∞–≥—É
            currentBattle.turn = "enemy";
            setTimeout(enemyTurn, 1500);
            
            updateBattleUI();
        }

        function useDefense() {
            if (!currentBattle || currentBattle.turn !== "player") return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞—Ñ—Ñ –∑–∞—â–∏—Ç—ã
            const defenseBoost = Math.floor(gameState.stats.defense * 0.3);
            addBuff("defense_boost", 2, { defense: defenseBoost }); // 2 —Ö–æ–¥–∞
            
            addBattleLog(`üõ°Ô∏è –í—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –∑–∞—â–∏—Ç–Ω—É—é —Å—Ç–æ–π–∫—É. –ó–∞—â–∏—Ç–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ ${defenseBoost} –Ω–∞ 2 —Ö–æ–¥–∞.`, "info");
            
            // –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –≤—Ä–∞–≥—É
            currentBattle.turn = "enemy";
            setTimeout(enemyTurn, 1500);
            
            updateBattleUI();
        }

        function useHealing() {
            if (!currentBattle || currentBattle.turn !== "player") return;
            
            // –õ–µ—á–µ–Ω–∏–µ
            const healAmount = Math.floor(gameState.stats.maxHealth * 0.15);
            currentBattle.playerHealth = Math.min(currentBattle.playerMaxHealth, currentBattle.playerHealth + healAmount);
            
            addBattleLog(`‚ù§Ô∏è –í—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ ${healAmount} –∑–¥–æ—Ä–æ–≤—å—è.`, "heal");
            
            // –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –≤—Ä–∞–≥—É
            currentBattle.turn = "enemy";
            setTimeout(enemyTurn, 1500);
            
            updateBattleUI();
        }

        function usePotionInBattle(type) {
            if (!currentBattle || currentBattle.turn !== "player") return;
            
            // –ò—â–µ–º –∑–µ–ª—å–µ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ
            let potion = null;
            let potionIndex = -1;
            
            switch(type) {
                case "health":
                    potionIndex = gameState.inventory.potions.findIndex(p => p.id.includes("health"));
                    if (potionIndex !== -1) {
                        potion = ITEM_DATABASE.potions.find(p => p.id === gameState.inventory.potions[potionIndex].id);
                    }
                    break;
            }
            
            if (!potion) {
                addBattleLog("–£ –≤–∞—Å –Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∑–µ–ª—å—è!", "info");
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–µ–ª—å–µ
            if (potion.effect.health) {
                currentBattle.playerHealth = Math.min(
                    currentBattle.playerMaxHealth,
                    currentBattle.playerHealth + potion.effect.health
                );
                addBattleLog(`üß™ –í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ ${potion.name} –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ ${potion.effect.health} –∑–¥–æ—Ä–æ–≤—å—è.`, "heal");
            }
            
            // –£–¥–∞–ª—è–µ–º –∑–µ–ª—å–µ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            if (gameState.inventory.potions[potionIndex].count > 1) {
                gameState.inventory.potions[potionIndex].count--;
            } else {
                gameState.inventory.potions.splice(potionIndex, 1);
            }
            
            // –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –≤—Ä–∞–≥—É
            currentBattle.turn = "enemy";
            setTimeout(enemyTurn, 1500);
            
            updateBattleUI();
            updateInventory('potions');
        }

        function attemptEscape() {
            if (!currentBattle || currentBattle.turn !== "player") return;
            
            // –®–∞–Ω—Å –ø–æ–±–µ–≥–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
            const escapeChance = Math.min(80, gameState.stats.speed / 2);
            const isEscaped = Math.random() * 100 < escapeChance;
            
            if (isEscaped) {
                addBattleLog("üèÉ –í—ã —É—Å–ø–µ—à–Ω–æ —Å–±–µ–∂–∞–ª–∏ —Å –ø–æ–ª—è –±–æ—è!", "info");
                setTimeout(() => {
                    document.getElementById('battleContainer').style.display = 'none';
                    currentBattle = null;
                }, 1000);
            } else {
                addBattleLog("üí• –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–±–µ–≥–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å!", "damage");
                currentBattle.turn = "enemy";
                setTimeout(enemyTurn, 1500);
            }
            
            updateBattleUI();
        }

        function endBattle(playerWon) {
            const { enemy, isBoss } = currentBattle;
            
            if (playerWon) {
                // –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—ã
                const rewards = enemy.rewards;
                gameState.gold += rewards.gold;
                gameState.xp += rewards.xp;
                gameState.essence += rewards.essence || 0;
                gameState.crystals += rewards.crystals || 0;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —É–±–∏–π—Å—Ç–≤
                if (isBoss) {
                    gameState.bossKills[enemy.id] = (gameState.bossKills[enemy.id] || 0) + 1;
                    updateQuestProgress("boss", 1);
                } else {
                    updateQuestProgress("battle", 1);
                }
                
                // –®–∞–Ω—Å –Ω–∞ –¥—Ä–æ–ø –ø—Ä–µ–¥–º–µ—Ç–∞
                if (rewards.items && Math.random() < 0.4) {
                    const itemId = rewards.items[Math.floor(Math.random() * rewards.items.length)];
                    const item = findItemById(itemId);
                    if (item) {
                        addItemToInventory(item);
                        addBattleLog(`üéÅ –ü–æ–ª—É—á–µ–Ω –ø—Ä–µ–¥–º–µ—Ç: ${item.name}!`, "loot");
                    }
                }
                
                addBattleLog(`üéâ –ü–æ–±–µ–¥–∞! –ü–æ–ª—É—á–µ–Ω–æ: ${rewards.gold} –∑–æ–ª–æ—Ç–∞, ${rewards.xp} –æ–ø—ã—Ç–∞${rewards.essence ? `, ${rewards.essence} —ç—Å—Å–µ–Ω—Ü–∏–∏` : ''}`, "loot");
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                checkLevelUp();
                
            } else {
                addBattleLog("‚ò†Ô∏è –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ –±–∏—Ç–≤—É...", "damage");
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–¥–æ—Ä–æ–≤—å–µ –ø–æ—Å–ª–µ –±–∏—Ç–≤—ã
            gameState.baseStats.health = Math.max(1, currentBattle.playerHealth);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –±–æ–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            setTimeout(() => {
                document.getElementById('battleContainer').style.display = 'none';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥
                if (playerWon) {
                    addLog(`‚öîÔ∏è –ü–æ–±–µ–¥–∞ –Ω–∞–¥ ${enemy.name}${isBoss ? " (–ë–û–°–°)" : ""}! –ü–æ–ª—É—á–µ–Ω–æ ${rewards.xp} –æ–ø—ã—Ç–∞.`, "loot");
                } else {
                    addLog(`‚öîÔ∏è –ü–æ—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç ${enemy.name}. –ù—É–∂–Ω–æ —Å—Ç–∞—Ç—å —Å–∏–ª—å–Ω–µ–µ!`, "damage");
                }
                
                currentBattle = null;
                updateUI();
            }, 2000);
        }

        function addBattleLog(message, type = "info") {
            if (!currentBattle) return;
            
            currentBattle.battleLog.push({ message, type, round: currentBattle.round });
            
            const logContainer = document.getElementById('battleLogContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[–•–æ–¥ ${currentBattle.round}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateBattleLog() {
            const logContainer = document.getElementById('battleLogContainer');
            logContainer.innerHTML = '';
            
            if (!currentBattle || !currentBattle.battleLog) return;
            
            currentBattle.battleLog.forEach(log => {
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${log.type}`;
                logEntry.textContent = `[–•–æ–¥ ${log.round}] ${log.message}`;
                logContainer.appendChild(logEntry);
            });
            
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –°–£–ù–î–£–ö–û–í ====================
        function showChests() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üèÜ –ú–∞–≥–∞–∑–∏–Ω —Å—É–Ω–¥—É–∫–æ–≤</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    <div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–Ω–¥—É–∫</div>
                    <div class="chest-grid">
                        ${CHEST_TYPES.filter(chest => !chest.seasonal || Math.random() < 0.3).map(chest => `
                            <div class="chest chest-${chest.rarity}" onclick="openChest('${chest.id}')">
                                <div class="chest-icon">${chest.icon}</div>
                                <div class="chest-name">${chest.name}</div>
                                <div class="chest-cost">${chest.cost} –∑–æ–ª–æ—Ç–∞</div>
                                <div style="font-size: 12px; margin-top: 10px; color: var(--color-text-secondary);">
                                    –®–∞–Ω—Å —É—Å–ø–µ—Ö–∞: ${chest.openChance}%
                                </div>
                                <div style="font-size: 11px; color: #666; margin-top: 5px;">
                                    ${getChestRewardsDescription(chest)}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                        <div style="color: var(--color-primary); margin-bottom: 10px;">–®–∞–Ω—Å—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è:</div>
                        <div style="font-size: 12px; line-height: 1.5;">
                            ‚Ä¢ –û–±—ã—á–Ω—ã–π: 70% –æ–±—ã—á–Ω—ã—Ö, 30% –Ω–µ–æ–±—ã—á–Ω—ã—Ö<br>
                            ‚Ä¢ –†–µ–¥–∫–∏–π: 50% —Ä–µ–¥–∫–∏—Ö, 40% —ç–ø–∏—á–µ—Å–∫–∏—Ö, 10% –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö<br>
                            ‚Ä¢ –≠–ø–∏—á–µ—Å–∫–∏–π: 30% —ç–ø–∏—á–µ—Å–∫–∏—Ö, 60% –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö, 10% –º–∏—Ñ–∏—á–µ—Å–∫–∏—Ö<br>
                            ‚Ä¢ –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π: 20% –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö, 70% –º–∏—Ñ–∏—á–µ—Å–∫–∏—Ö, 10% –±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function getChestRewardsDescription(chest) {
            const rewards = chest.rewards;
            let desc = "";
            
            if (rewards.gold) desc += `üí∞${rewards.gold.min}-${rewards.gold.max} `;
            if (rewards.essence) desc += `‚ú®${rewards.essence.min}-${rewards.essence.max} `;
            if (rewards.crystals) desc += `üîÆ${rewards.crystals.min}-${rewards.crystals.max} `;
            
            return desc + "–∏ –ø—Ä–µ–¥–º–µ—Ç—ã";
        }

        function openChest(chestId) {
            const chest = CHEST_TYPES.find(c => c.id === chestId);
            if (!chest) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–Ω—å–≥–∏
            if (gameState.gold < chest.cost) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!");
                closeModal();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —à–∞–Ω—Å –æ—Ç–∫—Ä—ã—Ç–∏—è
            const openRoll = Math.random() * 100;
            if (openRoll > chest.openChance) {
                gameState.gold -= chest.cost;
                showNotification("–°—É–Ω–¥—É–∫ –æ–∫–∞–∑–∞–ª—Å—è –ø—É—Å—Ç—ã–º! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.", 3000);
                addLog(`üí• –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å ${chest.name}. –°—É–Ω–¥—É–∫ –æ–∫–∞–∑–∞–ª—Å—è –ø—É—Å—Ç—ã–º.`, "damage");
                closeModal();
                updateUI();
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º –¥–µ–Ω—å–≥–∏
            gameState.gold -= chest.cost;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–∞–≥—Ä–∞–¥—ã
            const rewards = generateChestRewards(chest);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–≥—Ä–∞–¥—ã
            showChestRewardsModal(chest, rewards);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–≤–µ—Å—Ç–∞
            updateQuestProgress("chest", 1);
            
            updateUI();
        }

        function generateChestRewards(chest) {
            const rewards = {
                gold: 0,
                essence: 0,
                crystals: 0,
                items: []
            };
            
            const rewardTypes = chest.rewards;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–æ–ª–æ—Ç–æ
            if (rewardTypes.gold && Math.random() * 100 < rewardTypes.gold.chance) {
                const { min, max } = rewardTypes.gold;
                rewards.gold = Math.floor(Math.random() * (max - min + 1)) + min;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —ç—Å—Å–µ–Ω—Ü–∏—é
            if (rewardTypes.essence && Math.random() * 100 < rewardTypes.essence.chance) {
                const { min, max } = rewardTypes.essence;
                rewards.essence = Math.floor(Math.random() * (max - min + 1)) + min;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫—Ä–∏—Å—Ç–∞–ª–ª—ã
            if (rewardTypes.crystals && Math.random() * 100 < rewardTypes.crystals.chance) {
                const { min, max } = rewardTypes.crystals;
                rewards.crystals = Math.floor(Math.random() * (max - min + 1)) + min;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã
            if (rewardTypes.items) {
                rewardTypes.items.forEach(itemType => {
                    if (Math.random() * 100 < itemType.chance) {
                        // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç –Ω—É–∂–Ω–æ–π —Ä–µ–¥–∫–æ—Å—Ç–∏ –∏–∑ –Ω—É–∂–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        const items = ITEM_DATABASE[itemType.type];
                        if (!items) return;
                        
                        const itemsOfRarity = items.filter(item => item.rarity === itemType.rarity);
                        if (itemsOfRarity.length > 0) {
                            const item = itemsOfRarity[Math.floor(Math.random() * itemsOfRarity.length)];
                            rewards.items.push({
                                ...item,
                                category: itemType.type
                            });
                        }
                    }
                });
            }
            
            return rewards;
        }

        function showChestRewardsModal(chest, rewards) {
            let itemsHTML = "";
            
            rewards.items.forEach(item => {
                itemsHTML += `
                    <div style="display: flex; align-items: center; gap: 10px; margin: 5px 0; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                        <div style="font-size: 24px;">${item.icon}</div>
                        <div>
                            <div style="color: ${getRarityColor(item.rarity)}; font-weight: bold;">${item.name}</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">${item.rarity}</div>
                        </div>
                    </div>
                `;
            });
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üéÅ –û—Ç–∫—Ä—ã—Ç ${chest.name}!</div>
                        <button class="close-modal" onclick="applyChestRewards('${chest.id}', ${JSON.stringify(rewards).replace(/'/g, "\\'")})">√ó</button>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 60px;">${chest.icon}</div>
                        <div style="color: ${getRarityColor(chest.rarity)}; font-size: 24px; margin: 10px 0;">${chest.name}</div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <div style="color: var(--color-primary); margin-bottom: 15px; font-size: 18px;">–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:</div>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                            ${rewards.gold > 0 ? `
                                <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border: 1px solid rgba(255, 215, 0, 0.3);">
                                    <div style="font-size: 24px;">üí∞</div>
                                    <div style="font-weight: bold; color: #ffd700;">${rewards.gold}</div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary);">–∑–æ–ª–æ—Ç–∞</div>
                                </div>
                            ` : ''}
                            
                            ${rewards.essence > 0 ? `
                                <div style="text-align: center; padding: 15px; background: rgba(155, 89, 182, 0.1); border-radius: 10px; border: 1px solid rgba(155, 89, 182, 0.3);">
                                    <div style="font-size: 24px;">‚ú®</div>
                                    <div style="font-weight: bold; color: #9b59b6;">${rewards.essence}</div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary);">—ç—Å—Å–µ–Ω—Ü–∏–∏</div>
                                </div>
                            ` : ''}
                            
                            ${rewards.crystals > 0 ? `
                                <div style="text-align: center; padding: 15px; background: rgba(52, 152, 219, 0.1); border-radius: 10px; border: 1px solid rgba(52, 152, 219, 0.3);">
                                    <div style="font-size: 24px;">üîÆ</div>
                                    <div style="font-weight: bold; color: #3498db;">${rewards.crystals}</div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary);">–∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤</div>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${rewards.items.length > 0 ? `
                            <div style="color: var(--color-primary); margin: 20px 0 10px 0;">–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã:</div>
                            ${itemsHTML}
                        ` : ''}
                    </div>
                    
                    <button onclick="applyChestRewards('${chest.id}', ${JSON.stringify(rewards).replace(/'/g, "\\'")})" 
                            style="width: 100%; padding: 15px; background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); border: none; border-radius: 10px; color: white; font-size: 18px; font-weight: bold; cursor: pointer;">
                        –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—ã
                    </button>
                </div>
            `;
            
            showModal(modalContent);
        }

        function applyChestRewards(chestId, rewards) {
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
            gameState.gold += rewards.gold;
            gameState.essence += rewards.essence;
            gameState.crystals += rewards.crystals;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            rewards.items.forEach(item => {
                addItemToInventory(item);
            });
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            closeModal();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            let rewardText = `–ü–æ–ª—É—á–µ–Ω—ã –Ω–∞–≥—Ä–∞–¥—ã –∏–∑ —Å—É–Ω–¥—É–∫–∞:`;
            if (rewards.gold > 0) rewardText += ` ${rewards.gold} –∑–æ–ª–æ—Ç–∞`;
            if (rewards.essence > 0) rewardText += `, ${rewards.essence} —ç—Å—Å–µ–Ω—Ü–∏–∏`;
            if (rewards.crystals > 0) rewardText += `, ${rewards.crystals} –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤`;
            if (rewards.items.length > 0) rewardText += ` –∏ ${rewards.items.length} –ø—Ä–µ–¥–º–µ—Ç(–æ–≤)`;
            
            showNotification(rewardText, 4000);
            addLog(`üéÅ –û—Ç–∫—Ä—ã—Ç —Å—É–Ω–¥—É–∫! ${rewardText}`, "loot");
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –ò–ù–í–ï–ù–¢–ê–†–Ø ====================
        function switchInventoryTab(tabName) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.inventory-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            updateInventory(tabName);
        }

        function updateInventory(category = 'armor') {
            const inventoryContent = document.getElementById('inventoryContent');
            
            let items = [];
            switch(category) {
                case 'armor':
                    items = gameState.inventory.armor;
                    break;
                case 'weapons':
                    items = gameState.inventory.weapons;
                    break;
                case 'potions':
                    items = gameState.inventory.potions;
                    break;
                case 'materials':
                    items = gameState.inventory.materials;
                    break;
                case 'special':
                    items = gameState.inventory.special;
                    break;
            }
            
            if (items.length === 0) {
                inventoryContent.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: var(--color-text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 20px;">üì¶</div>
                        <div style="font-size: 18px;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>
                        <div style="font-size: 14px; margin-top: 10px;">–°–æ–±–∏—Ä–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –æ—Ö–æ—Ç–µ –∏ —Å—É–Ω–¥—É–∫–∞—Ö</div>
                    </div>
                `;
                return;
            }
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –ø–æ ID
            const groupedItems = {};
            items.forEach(item => {
                if (!groupedItems[item.id]) {
                    const itemData = findItemById(item.id);
                    if (itemData) {
                        groupedItems[item.id] = {
                            ...itemData,
                            count: 0,
                            category: category
                        };
                    }
                }
                groupedItems[item.id].count += item.count || 1;
            });
            
            const itemList = Object.values(groupedItems);
            
            inventoryContent.innerHTML = `
                <div class="item-grid">
                    ${itemList.map(item => `
                        <div class="item-slot item-rarity-${item.rarity}" 
                             onclick="showItemDetails('${item.id}', '${category}')"
                             title="${item.name}">
                            <div class="item-icon">${item.icon}</div>
                            <div class="item-name">${item.name}</div>
                            ${item.count > 1 ? `<div class="item-count">${item.count}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function showItemDetails(itemId, category) {
            const item = findItemById(itemId);
            if (!item) return;
            
            let itemStatsHTML = "";
            if (item.stats) {
                itemStatsHTML = `
                    <div style="margin: 20px 0;">
                        <div style="color: var(--color-primary); margin-bottom: 10px;">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</div>
                        ${Object.entries(item.stats).map(([stat, value]) => `
                            <div style="display: flex; justify-content: space-between; margin: 5px 0; padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 5px;">
                                <span>${getStatDisplayName(stat)}:</span>
                                <span style="color: #4dffea; font-weight: bold;">+${value}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            let itemEffectHTML = "";
            if (item.effect) {
                itemEffectHTML = `
                    <div style="margin: 20px 0;">
                        <div style="color: var(--color-primary); margin-bottom: 10px;">–≠—Ñ—Ñ–µ–∫—Ç:</div>
                        <div style="padding: 10px; background: rgba(0,184,148,0.1); border-radius: 8px; border-left: 4px solid var(--color-success);">
                            ${getEffectDescription(item.effect)}
                        </div>
                    </div>
                `;
            }
            
            let actionsHTML = "";
            if (category === 'armor' || category === 'weapons' || category === 'wings' || category === 'amulet') {
                actionsHTML = `
                    <button onclick="equipItem('${itemId}', '${category}')" 
                            style="flex: 1; padding: 12px; background: linear-gradient(45deg, var(--color-success), #1dd1a1); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                        –≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                `;
            } else if (category === 'potions') {
                actionsHTML = `
                    <button onclick="usePotion('${itemId}')" 
                            style="flex: 1; padding: 12px; background: linear-gradient(45deg, var(--color-info), #5352ed); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                    </button>
                `;
            }
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">${item.icon} ${item.name}</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 60px; color: ${getRarityColor(item.rarity)};">${item.icon}</div>
                        <div style="color: ${getRarityColor(item.rarity)}; font-size: 18px; margin: 10px 0; font-weight: bold;">
                            ${getRarityName(item.rarity)}
                        </div>
                        ${item.level ? `<div style="color: var(--color-text-secondary);">–¢—Ä–µ–±—É–µ–º—ã–π —É—Ä–æ–≤–µ–Ω—å: ${item.level}</div>` : ''}
                    </div>
                    
                    <div style="margin: 20px 0; color: var(--color-text-secondary); line-height: 1.5;">
                        ${item.description || "–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –¥—Ä–µ–≤–Ω–∏—Ö –¥—Ä–∞–∫–æ–Ω–æ–≤."}
                    </div>
                    
                    ${itemStatsHTML}
                    ${itemEffectHTML}
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        ${actionsHTML}
                        <button onclick="sellItem('${itemId}', '${category}')" 
                                style="flex: 1; padding: 12px; background: linear-gradient(45deg, var(--color-danger), #ff6b81); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                            –ü—Ä–æ–¥–∞—Ç—å –∑–∞ ${Math.floor((item.price || 50) * 0.7)} –∑–æ–ª–æ—Ç–∞
                        </button>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function equipItem(itemId, category) {
            const item = findItemById(itemId);
            if (!item) return;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–æ—Ç –¥–ª—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
            let slot = null;
            
            if (category === 'armor') {
                if (itemId.includes('helmet')) slot = 'head';
                else if (itemId.includes('chest')) slot = 'chest';
                else if (itemId.includes('legs')) slot = 'legs';
                else slot = 'chest'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
            } else if (category === 'weapons') {
                slot = 'weapon';
            } else if (category === 'wings') {
                slot = 'wings';
            } else if (category === 'amulet') {
                slot = 'amulet';
            }
            
            if (!slot) {
                showNotification("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –ø—Ä–µ–¥–º–µ—Ç–∞!");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–µ–Ω—å
            if (item.level > gameState.level) {
                showNotification(`–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å ${item.level} –¥–ª—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏!`);
                return;
            }
            
            // –°–Ω–∏–º–∞–µ–º —Å—Ç–∞—Ä—É—é —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É
            const oldItem = gameState.equipment[slot];
            if (oldItem) {
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –ø—Ä–µ–¥–º–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
                addItemToInventory(oldItem);
            }
            
            // –≠–∫–∏–ø–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç
            gameState.equipment[slot] = item;
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            removeItemFromInventory(itemId, category);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–æ–Ω—É—Å—ã –æ—Ç —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
            updateEquipmentBonuses();
            
            showNotification(`–ü—Ä–µ–¥–º–µ—Ç "${item.name}" —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω!`);
            closeModal();
            updateUI();
            updateInventory(category);
        }

        function updateEquipmentBonuses() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –±–æ–Ω—É—Å—ã
            gameState.equipmentBonus = {
                attack: 0,
                defense: 0,
                health: 0,
                speed: 0,
                critical: 0,
                dodge: 0,
                armor: 0,
                fireDamage: 0,
                iceDamage: 0,
                poisonDamage: 0,
                lightningDamage: 0
            };
            
            // –°—É–º–º–∏—Ä—É–µ–º –±–æ–Ω—É—Å—ã –æ—Ç –≤—Å–µ–π —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
            Object.values(gameState.equipment).forEach(item => {
                if (item && item.stats) {
                    Object.entries(item.stats).forEach(([stat, value]) => {
                        if (stat in gameState.equipmentBonus) {
                            gameState.equipmentBonus[stat] += value;
                        }
                    });
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            updateStats();
        }

        function updateStats() {
            // –ë–∞–∑–æ–≤–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ + –±–æ–Ω—É—Å—ã –æ—Ç —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ + –±–æ–Ω—É—Å—ã –æ—Ç –±–∞—Ñ—Ñ–æ–≤
            const totalStats = { ...gameState.baseStats };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å—ã –æ—Ç —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
            Object.entries(gameState.equipmentBonus).forEach(([stat, value]) => {
                if (stat in totalStats) {
                    totalStats[stat] += value;
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å—ã –æ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–∞—Ñ—Ñ–æ–≤
            gameState.activeBuffs.forEach(buff => {
                if (buff.stats) {
                    Object.entries(buff.stats).forEach(([stat, value]) => {
                        if (stat in totalStats) {
                            totalStats[stat] += value;
                        }
                    });
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ —Å—Ç–∞—Ç—ã
            document.getElementById('statAttack').textContent = totalStats.attack;
            document.getElementById('statDefense').textContent = totalStats.defense;
            document.getElementById('statHealth').textContent = `${totalStats.health}/${totalStats.maxHealth}`;
            document.getElementById('statSpeed').textContent = totalStats.speed;
            document.getElementById('statCrit').textContent = `${totalStats.critical}%`;
            document.getElementById('statDodge').textContent = `${totalStats.dodge}%`;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —Å—Ç–∞—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∏–≥—Ä–µ
            gameState.stats = totalStats;
        }

        function sellItem(itemId, category) {
            const item = findItemById(itemId);
            if (!item) return;
            
            // –ü—Ä–æ–¥–∞–∂–Ω–∞—è —Ü–µ–Ω–∞ (70% –æ—Ç –±–∞–∑–æ–≤–æ–π)
            const sellPrice = Math.floor((item.price || 50) * 0.7);
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            const removed = removeItemFromInventory(itemId, category);
            if (!removed) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–æ–ª–æ—Ç–æ
            gameState.gold += sellPrice;
            
            showNotification(`–ü—Ä–µ–¥–º–µ—Ç "${item.name}" –ø—Ä–æ–¥–∞–Ω –∑–∞ ${sellPrice} –∑–æ–ª–æ—Ç–∞!`);
            closeModal();
            updateUI();
            updateInventory(category);
        }

        function usePotion(potionId) {
            const potion = findItemById(potionId);
            if (!potion || !potion.effect) return;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –∑–µ–ª—å—è
            if (potion.effect.health) {
                gameState.baseStats.health = Math.min(
                    gameState.baseStats.maxHealth,
                    gameState.baseStats.health + potion.effect.health
                );
                showNotification(`–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${potion.effect.health} HP.`);
                addLog(`‚ù§Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${potion.effect.health} HP.`, "heal");
            }
            
            if (potion.effect.energy) {
                gameState.energy = Math.min(
                    gameState.maxEnergy,
                    gameState.energy + potion.effect.energy
                );
                showNotification(`–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–µ–ª—å–µ —ç–Ω–µ—Ä–≥–∏–∏. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${potion.effect.energy} —ç–Ω–µ—Ä–≥–∏–∏.`);
                addLog(`‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–µ–ª—å–µ —ç–Ω–µ—Ä–≥–∏–∏. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${potion.effect.energy} —ç–Ω–µ—Ä–≥–∏–∏.`, "info");
            }
            
            if (potion.effect.duration) {
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞—Ñ—Ñ
                const buff = { ...potion.effect };
                delete buff.duration;
                
                addBuff(potionId, potion.effect.duration, buff);
                showNotification(`–≠—Ñ—Ñ–µ–∫—Ç "${potion.name}" –∞–∫—Ç–∏–≤–µ–Ω ${potion.effect.duration / 60} –º–∏–Ω—É—Ç.`);
                addLog(`‚ú® –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω —ç—Ñ—Ñ–µ–∫—Ç "${potion.name}".`, "info");
            }
            
            // –£–¥–∞–ª—è–µ–º –∑–µ–ª—å–µ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            removeItemFromInventory(potionId, 'potions');
            
            closeModal();
            updateUI();
            updateInventory('potions');
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –ë–ê–§–§–û–í ====================
        function addBuff(id, duration, stats) {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –±–∞—Ñ—Ñ —Å —Ç–∞–∫–∏–º –∂–µ ID, –µ—Å–ª–∏ –µ—Å—Ç—å
            gameState.activeBuffs = gameState.activeBuffs.filter(buff => buff.id !== id);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –±–∞—Ñ—Ñ
            gameState.activeBuffs.push({
                id: id,
                duration: duration, // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
                stats: stats,
                startTime: Date.now()
            });
        }

        function updateBuffs() {
            const now = Date.now();
            const initialCount = gameState.activeBuffs.length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –±–∞—Ñ—Ñ–æ–≤
            gameState.activeBuffs = gameState.activeBuffs.filter(buff => {
                const elapsed = (now - buff.startTime) / 1000;
                return elapsed < buff.duration;
            });
            
            // –ï—Å–ª–∏ –±–∞—Ñ—Ñ—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—ã
            if (gameState.activeBuffs.length !== initialCount) {
                updateStats();
            }
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –î–ò–ê–õ–û–ì–û–í ====================
        function startDialogue(dialogueId) {
            const dialogue = DIALOGUES[dialogueId];
            if (!dialogue || dialogue.length === 0) return;
            
            currentDialogue = dialogue[0];
            showDialogueModal();
        }

        function showDialogueModal() {
            if (!currentDialogue) return;
            
            const choicesHTML = currentDialogue.choices ? currentDialogue.choices.map(choice => `
                <button class="dialogue-choice" onclick="selectDialogueChoice('${choice.next}', '${choice.action || ''}')">
                    ${choice.text}
                </button>
            `).join('') : `
                <button class="dialogue-choice" onclick="closeModal()">
                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                </button>
            `;
            
            const modalContent = `
                <div class="dialogue-container">
                    <div class="dialogue-speaker">${currentDialogue.speaker}</div>
                    <div class="dialogue-text">${currentDialogue.text}</div>
                    <div class="dialogue-choices">
                        ${choicesHTML}
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function selectDialogueChoice(nextId, action) {
            if (action) {
                executeDialogueAction(action);
            }
            
            if (nextId === 'end') {
                closeModal();
                currentDialogue = null;
                return;
            }
            
            // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π –¥–∏–∞–ª–æ–≥
            let nextDialogue = null;
            for (const key in DIALOGUES) {
                const dialogueArray = DIALOGUES[key];
                const found = dialogueArray.find(d => d.id === nextId);
                if (found) {
                    nextDialogue = found;
                    break;
                }
            }
            
            if (!nextDialogue) {
                // –ò—â–µ–º –≤ —Ç–µ–∫—É—â–µ–º –º–∞—Å—Å–∏–≤–µ –¥–∏–∞–ª–æ–≥–æ–≤
                const currentArray = Object.values(DIALOGUES).find(arr => 
                    arr.some(d => d === currentDialogue)
                );
                if (currentArray) {
                    const index = currentArray.indexOf(currentDialogue);
                    if (index < currentArray.length - 1) {
                        nextDialogue = currentArray[index + 1];
                    }
                }
            }
            
            if (nextDialogue) {
                currentDialogue = nextDialogue;
                showDialogueModal();
            } else {
                closeModal();
                currentDialogue = null;
            }
        }

        function executeDialogueAction(action) {
            switch(action) {
                case "completeTutorial":
                    gameState.storyProgress.completedDialogues.push("tutorial");
                    updateQuestProgress("quest_tutorial", 1);
                    showNotification("–û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º.");
                    break;
                case "startRiverTrial":
                    // –ù–∞—á–∏–Ω–∞–µ–º –∏—Å–ø—ã—Ç–∞–Ω–∏–µ —É —Ä–µ–∫–∏ –æ–≥–Ω—è
                    addLog("üî• –í—ã –Ω–∞—á–∏–Ω–∞–µ—Ç–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ —É —Ä–µ–∫–∏ –æ–≥–Ω—è.", "quest");
                    break;
            }
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –ö–í–ï–°–¢–û–í ====================
        function showQuests() {
            let questsHTML = "";
            
            gameState.activeQuests.forEach(questData => {
                const quest = QUESTS.find(q => q.id === questData.id);
                if (!quest) return;
                
                const progressPercent = (questData.progress / quest.required) * 100;
                
                questsHTML += `
                    <div class="quest-item">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div style="font-weight: bold; font-size: 18px;">${quest.name}</div>
                            <div style="background: linear-gradient(45deg, var(--color-warning), #ffa502); padding: 5px 15px; border-radius: 20px; font-weight: bold;">
                                ${quest.rewards.xp}‚≠ê ${quest.rewards.gold}üí∞
                            </div>
                        </div>
                        <div style="color: var(--color-text-secondary); margin-bottom: 15px;">${quest.description}</div>
                        <div class="quest-progress">
                            <div class="quest-progress-bar" style="width: ${progressPercent}%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                            <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: ${questData.progress}/${quest.required}</span>
                            ${questData.progress >= quest.required ? `
                                <button onclick="completeQuest('${quest.id}')" 
                                        style="padding: 5px 15px; background: var(--color-success); border: none; border-radius: 5px; color: white; cursor: pointer; font-weight: bold;">
                                    –ó–∞–≤–µ—Ä—à–∏—Ç—å
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üìú –ó–∞–¥–∞–Ω–∏—è</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    ${questsHTML ? `
                        <div class="quest-list">
                            ${questsHTML}
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 50px; color: var(--color-text-secondary);">
                            <div style="font-size: 48px; margin-bottom: 20px;">üìú</div>
                            <div style="font-size: 18px;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π</div>
                            <div style="font-size: 14px; margin-top: 10px;">–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –∏–≥—Ä–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π</div>
                        </div>
                    `}
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(255, 165, 2, 0.1); border-radius: 10px; border-left: 4px solid var(--color-warning);">
                        <div style="color: var(--color-warning); font-weight: bold; margin-bottom: 5px;">–°–æ–≤–µ—Ç:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø—ã—Ç–∞, –∑–æ–ª–æ—Ç–∞ –∏ —Ä–µ–¥–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤.
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function updateQuestProgress(questType, amount = 1) {
            gameState.activeQuests.forEach(questData => {
                const quest = QUESTS.find(q => q.id === questData.id);
                if (quest && quest.type === questType && !questData.completed) {
                    questData.progress = Math.min(quest.required, questData.progress + amount);
                    
                    if (questData.progress >= quest.required) {
                        showNotification(`–ó–∞–¥–∞–Ω–∏–µ "${quest.name}" –≥–æ—Ç–æ–≤–æ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é!`);
                    }
                }
            });
        }

        function completeQuest(questId) {
            const questIndex = gameState.activeQuests.findIndex(q => q.id === questId);
            if (questIndex === -1) return;
            
            const questData = gameState.activeQuests[questIndex];
            const quest = QUESTS.find(q => q.id === questId);
            
            if (!quest || questData.progress < quest.required) {
                showNotification("–ó–∞–¥–∞–Ω–∏–µ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!");
                return;
            }
            
            // –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—ã
            const rewards = quest.rewards;
            gameState.gold += rewards.gold;
            gameState.xp += rewards.xp;
            if (rewards.essence) gameState.essence += rewards.essence;
            if (rewards.crystals) gameState.crystals += rewards.crystals;
            if (rewards.item) {
                const item = findItemById(rewards.item);
                if (item) {
                    addItemToInventory(item);
                }
            }
            
            // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ
            questData.completed = true;
            gameState.completedQuests.push(questId);
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–ª–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            if (quest.repeatable) {
                questData.progress = 0;
                questData.completed = false;
            } else {
                gameState.activeQuests.splice(questIndex, 1);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification(`–ó–∞–¥–∞–Ω–∏–µ "${quest.name}" –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ü–æ–ª—É—á–µ–Ω–∞ –Ω–∞–≥—Ä–∞–¥–∞: ${rewards.xp} –æ–ø—ã—Ç–∞, ${rewards.gold} –∑–æ–ª–æ—Ç–∞`);
            addLog(`‚úÖ –ó–∞–¥–∞–Ω–∏–µ "${quest.name}" –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ü–æ–ª—É—á–µ–Ω–æ: ${rewards.xp} –æ–ø—ã—Ç–∞, ${rewards.gold} –∑–æ–ª–æ—Ç–∞`, "quest");
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            checkLevelUp();
            
            closeModal();
            updateUI();
        }

        // ==================== –¢–†–ï–ù–ò–†–û–í–ö–ò ====================
        function showTraining() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üí™ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –∑–∞–ª</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; color: var(--color-text-secondary);">
                        –£–ª—É—á—à–∞–π—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å–≤–æ–µ–≥–æ –¥—Ä–∞–∫–æ–Ω–∞ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.
                        –ö–∞–∂–¥–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏ —ç–Ω–µ—Ä–≥–∏–∏.
                    </div>
                    
                    <div class="training-options">
                        ${TRAINING_TYPES.map(training => `
                            <div class="training-option" onclick="startTraining('${training.id}')">
                                <div style="font-size: 32px; margin-bottom: 10px;">üí™</div>
                                <div style="font-weight: bold; font-size: 18px; margin-bottom: 5px;">${training.name}</div>
                                <div style="font-size: 14px; color: var(--color-text-secondary); margin-bottom: 10px;">
                                    ${getTrainingDescription(training)}
                                </div>
                                <div style="font-size: 12px; color: #666;">
                                    –°—Ç–æ–∏–º–æ—Å—Ç—å: ${training.cost.energy} —ç–Ω–µ—Ä–≥–∏–∏, 
                                    –≤—Ä–µ–º—è: ${training.duration / 60} –º–∏–Ω.
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${activeTraining ? `
                        <div style="margin-top: 30px; padding: 15px; background: rgba(0, 184, 148, 0.1); border-radius: 10px; border-left: 4px solid var(--color-success);">
                            <div style="color: var(--color-success); font-weight: bold; margin-bottom: 5px;">–ê–∫—Ç–∏–≤–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞:</div>
                            <div>${getActiveTrainingInfo()}</div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            showModal(modalContent);
        }

        function getTrainingDescription(training) {
            const rewards = [];
            if (training.reward.attack) rewards.push(`+${training.reward.attack} –∫ –∞—Ç–∞–∫–µ`);
            if (training.reward.defense) rewards.push(`+${training.reward.defense} –∫ –∑–∞—â–∏—Ç–µ`);
            if (training.reward.speed) rewards.push(`+${training.reward.speed} –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏`);
            if (training.reward.allStats) rewards.push(`+${training.reward.allStats} –∫–æ –≤—Å–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º`);
            
            return rewards.join(", ") + `, ${training.reward.xp} –æ–ø—ã—Ç–∞`;
        }

        function startTraining(trainingId) {
            const training = TRAINING_TYPES.find(t => t.id === trainingId);
            if (!training) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–Ω–µ—Ä–≥–∏—é
            if (gameState.energy < training.cost.energy) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–æ–ª–æ—Ç–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (training.cost.gold && gameState.gold < training.cost.gold) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!");
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
            gameState.energy -= training.cost.energy;
            if (training.cost.gold) gameState.gold -= training.cost.gold;
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
            activeTraining = {
                id: trainingId,
                startTime: Date.now(),
                duration: training.duration * 1000, // –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
                rewards: training.reward
            };
            
            showNotification(`–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ "${training.name}" –Ω–∞—á–∞–ª–∞—Å—å! –ó–∞–≤–µ—Ä—à–∏—Ç—Å—è —á–µ—Ä–µ–∑ ${training.duration / 60} –º–∏–Ω—É—Ç.`);
            addLog(`üí™ –ù–∞—á–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞: ${training.name}`, "info");
            
            closeModal();
            updateUI();
        }

        function updateTraining() {
            if (!activeTraining) return;
            
            const now = Date.now();
            const elapsed = now - activeTraining.startTime;
            
            if (elapsed >= activeTraining.duration) {
                // –ó–∞–≤–µ—Ä—à–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                completeTraining();
            }
        }

        function completeTraining() {
            if (!activeTraining) return;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞–≥—Ä–∞–¥—ã
            const rewards = activeTraining.rewards;
            
            if (rewards.attack) gameState.baseStats.attack += rewards.attack;
            if (rewards.defense) gameState.baseStats.defense += rewards.defense;
            if (rewards.speed) gameState.baseStats.speed += rewards.speed;
            if (rewards.allStats) {
                gameState.baseStats.attack += rewards.allStats;
                gameState.baseStats.defense += rewards.allStats;
                gameState.baseStats.maxHealth += rewards.allStats * 10;
                gameState.baseStats.health += rewards.allStats * 10;
                gameState.baseStats.speed += rewards.allStats;
                gameState.baseStats.critical += rewards.allStats;
                gameState.baseStats.dodge += rewards.allStats;
            }
            
            gameState.xp += rewards.xp;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            let rewardText = "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–ª—É—á–µ–Ω–æ:";
            if (rewards.attack) rewardText += ` +${rewards.attack} –∞—Ç–∞–∫–∏`;
            if (rewards.defense) rewardText += `, +${rewards.defense} –∑–∞—â–∏—Ç—ã`;
            if (rewards.speed) rewardText += `, +${rewards.speed} —Å–∫–æ—Ä–æ—Å—Ç–∏`;
            if (rewards.allStats) rewardText += `, +${rewards.allStats} –∫–æ –≤—Å–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º`;
            rewardText += `, ${rewards.xp} –æ–ø—ã—Ç–∞`;
            
            showNotification(rewardText);
            addLog(`üí™ ${rewardText}`, "loot");
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
            activeTraining = null;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            checkLevelUp();
            updateUI();
        }

        function getActiveTrainingInfo() {
            if (!activeTraining) return "";
            
            const training = TRAINING_TYPES.find(t => t.id === activeTraining.id);
            if (!training) return "";
            
            const now = Date.now();
            const elapsed = now - activeTraining.startTime;
            const remaining = Math.max(0, activeTraining.duration - elapsed);
            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            
            return `${training.name} - –æ—Å—Ç–∞–ª–æ—Å—å ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // ==================== –ó–ê–ß–ê–†–û–í–ê–ù–ò–Ø ====================
        function showEnchant() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üîÆ –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏–π</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; color: var(--color-text-secondary);">
                        –£–ª—É—á—à–∞–π—Ç–µ —Å–≤–æ–∏ –ø—Ä–µ–¥–º–µ—Ç—ã —Å –ø–æ–º–æ—â—å—é –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏–π. –î–ª—è –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω–∞ —ç—Å—Å–µ–Ω—Ü–∏—è –∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã.
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="font-size: 60px; margin-bottom: 20px;">‚ú®</div>
                        <div style="font-size: 18px; margin-bottom: 10px;">–°–∏—Å—Ç–µ–º–∞ –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏–π</div>
                        <div style="color: var(--color-text-secondary);">
                            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Å—Å–µ–Ω—Ü–∏—é –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤.
                            –®–∞–Ω—Å —É—Å–ø–µ—Ö–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è –ø—Ä–µ–¥–º–µ—Ç–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç—Å—Å–µ–Ω—Ü–∏–∏.
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;">
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üîÆ</div>
                            <div style="font-weight: bold; margin-bottom: 5px;">–≠—Å—Å–µ–Ω—Ü–∏—è</div>
                            <div style="color: var(--color-text-secondary);">${gameState.essence} –µ–¥–∏–Ω–∏—Ü</div>
                        </div>
                        
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üíé</div>
                            <div style="font-weight: bold; margin-bottom: 5px;">–ö—Ä–∏—Å—Ç–∞–ª–ª—ã</div>
                            <div style="color: var(--color-text-secondary);">${gameState.crystals} –µ–¥–∏–Ω–∏—Ü</div>
                        </div>
                    </div>
                    
                    <button onclick="startRandomEnchant()" 
                            style="width: 100%; padding: 15px; margin-top: 30px; background: linear-gradient(45deg, #9b59b6, #8e44ad); border: none; border-radius: 10px; color: white; font-size: 16px; font-weight: bold; cursor: pointer;">
                        –°–ª—É—á–∞–π–Ω–æ–µ –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ (50 —ç—Å—Å–µ–Ω—Ü–∏–∏)
                    </button>
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(155, 89, 182, 0.1); border-radius: 10px; border-left: 4px solid #9b59b6;">
                        <div style="color: #9b59b6; font-weight: bold; margin-bottom: 5px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –°–ª—É—á–∞–π–Ω–æ–µ –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç +1-5 –∫ —Å–ª—É—á–∞–π–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–µ<br>
                            ‚Ä¢ –®–∞–Ω—Å —É—Å–ø–µ—Ö–∞: 70% –¥–ª—è –æ–±—ã—á–Ω—ã—Ö, 50% –¥–ª—è —Ä–µ–¥–∫–∏—Ö, 30% –¥–ª—è —ç–ø–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤<br>
                            ‚Ä¢ –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –ø—Ä–µ–¥–º–µ—Ç –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è, –Ω–æ —ç—Å—Å–µ–Ω—Ü–∏—è —Ç—Ä–∞—Ç–∏—Ç—Å—è
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function startRandomEnchant() {
            if (gameState.essence < 50) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç—Å—Å–µ–Ω—Ü–∏–∏ –¥–ª—è –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏—è!");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏—è
            const enchantableItems = [
                ...gameState.inventory.armor,
                ...gameState.inventory.weapons,
                ...gameState.inventory.wings,
                ...gameState.inventory.amulet
            ];
            
            if (enchantableItems.length === 0) {
                showNotification("–ù–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏—è!");
                return;
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç
            const randomItem = enchantableItems[Math.floor(Math.random() * enchantableItems.length)];
            const itemData = findItemById(randomItem.id);
            
            if (!itemData) {
                showNotification("–û—à–∏–±–∫–∞ –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏—è!");
                return;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞ –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏
            let successChance = 70;
            if (itemData.rarity === "rare") successChance = 50;
            else if (itemData.rarity === "epic") successChance = 30;
            else if (itemData.rarity === "legendary") successChance = 20;
            else if (itemData.rarity === "mythical") successChance = 10;
            else if (itemData.rarity === "divine") successChance = 5;
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —ç—Å—Å–µ–Ω—Ü–∏—é
            gameState.essence -= 50;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const isSuccess = Math.random() * 100 < successChance;
            
            if (isSuccess) {
                // –£—Å–ø–µ—à–Ω–æ–µ –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ
                const stats = ["attack", "defense", "health", "speed", "critical", "dodge"];
                const randomStat = stats[Math.floor(Math.random() * stats.length)];
                const bonus = Math.floor(Math.random() * 5) + 1;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ
                gameState.enchants.push({
                    itemId: randomItem.id,
                    stat: randomStat,
                    bonus: bonus
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–æ–Ω—É—Å—ã –ø—Ä–µ–¥–º–µ—Ç–∞
                if (!itemData.stats) itemData.stats = {};
                itemData.stats[randomStat] = (itemData.stats[randomStat] || 0) + bonus;
                
                showNotification(`–ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! ${itemData.name} –ø–æ–ª—É—á–∞–µ—Ç +${bonus} –∫ ${getStatDisplayName(randomStat)}`);
                addLog(`‚ú® –ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! ${itemData.name} –ø–æ–ª—É—á–∞–µ—Ç +${bonus} –∫ ${getStatDisplayName(randomStat)}`, "loot");
                
            } else {
                // –ù–µ—É–¥–∞—á–Ω–æ–µ –∑–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ
                showNotification("–ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å! –≠—Å—Å–µ–Ω—Ü–∏—è –ø–æ—Ç—Ä–∞—á–µ–Ω–∞ –≤–ø—É—Å—Ç—É—é.");
                addLog(`üí• –ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å! –≠—Å—Å–µ–Ω—Ü–∏—è –ø–æ—Ç—Ä–∞—á–µ–Ω–∞ –≤–ø—É—Å—Ç—É—é.`, "damage");
            }
            
            closeModal();
            updateUI();
        }

        // ==================== –≠–í–û–õ–Æ–¶–ò–Ø ====================
        function showEvolution() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —ç–≤–æ–ª—é—Ü–∏–∏
            const availableEvolutions = EVOLUTIONS.filter(evo => 
                gameState.level >= evo.levelRequired && 
                gameState.gold >= evo.cost.gold &&
                gameState.essence >= evo.cost.essence &&
                gameState.crystals >= evo.cost.crystals
            );
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üî• –≠–≤–æ–ª—é—Ü–∏—è –¥—Ä–∞–∫–æ–Ω–∞</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 60px;">üêâ</div>
                        <div style="font-size: 24px; margin: 10px 0;">–¢–µ–∫—É—â–∞—è —Å—Ç–∞–¥–∏—è: ${getEvolutionStageName()}</div>
                        <div style="color: var(--color-text-secondary);">
                            –≠–≤–æ–ª—é—Ü–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç –¥—Ä–∞–∫–æ–Ω–∞.
                        </div>
                    </div>
                    
                    <div class="evolution-panel">
                        ${EVOLUTIONS.map(evo => {
                            const isAvailable = availableEvolutions.some(ae => ae.id === evo.id);
                            const canAfford = gameState.gold >= evo.cost.gold && 
                                            gameState.essence >= evo.cost.essence && 
                                            gameState.crystals >= evo.cost.crystals;
                            const meetsLevel = gameState.level >= evo.levelRequired;
                            
                            return `
                                <div class="evolution-option ${isAvailable ? 'available' : 'locked'}" 
                                     onclick="${isAvailable ? `startEvolution('${evo.id}')` : ''}">
                                    <div style="font-size: 40px; margin-bottom: 10px;">${evo.icon}</div>
                                    <div style="font-weight: bold; font-size: 18px; margin-bottom: 5px;">${evo.name}</div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 10px;">
                                        ${evo.description}
                                    </div>
                                    <div style="font-size: 11px; color: #666; margin-bottom: 5px;">
                                        –¢—Ä–µ–±—É–µ—Ç—Å—è: ${evo.levelRequired} —É—Ä–æ–≤–µ–Ω—å
                                    </div>
                                    <div style="font-size: 11px; color: #666;">
                                        –°—Ç–æ–∏–º–æ—Å—Ç—å: ${evo.cost.gold}üí∞ ${evo.cost.essence}‚ú® ${evo.cost.crystals}üîÆ
                                    </div>
                                    ${!meetsLevel ? `<div style="color: var(--color-danger); font-size: 10px; margin-top: 5px;">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å</div>` : ''}
                                    ${!canAfford ? `<div style="color: var(--color-danger); font-size: 10px; margin-top: 5px;">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤</div>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(255, 138, 0, 0.1); border-radius: 10px; border-left: 4px solid var(--color-primary);">
                        <div style="color: var(--color-primary); font-weight: bold; margin-bottom: 5px;">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —ç–≤–æ–ª—é—Ü–∏–∏:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫<br>
                            ‚Ä¢ –ù–æ–≤—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–≤—ã–∫–∏<br>
                            ‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥<br>
                            ‚Ä¢ –î–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º –ª–æ–∫–∞—Ü–∏—è–º –∏ –∑–∞–¥–∞–Ω–∏—è–º
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function getEvolutionStageName() {
            const stages = ["–ù–æ–≤–∏—á–æ–∫", "–û–ø—ã—Ç–Ω—ã–π", "–ú–∞—Å—Ç–µ—Ä", "–≠–ª–∏—Ç–Ω—ã–π", "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π", "–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π", "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π"];
            return stages[Math.min(gameState.evolutionStage - 1, stages.length - 1)];
        }

        function startEvolution(evolutionId) {
            const evolution = EVOLUTIONS.find(e => e.id === evolutionId);
            if (!evolution) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
            if (gameState.gold < evolution.cost.gold || 
                gameState.essence < evolution.cost.essence || 
                gameState.crystals < evolution.cost.crystals) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è —ç–≤–æ–ª—é—Ü–∏–∏!");
                return;
            }
            
            if (gameState.level < evolution.levelRequired) {
                showNotification(`–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å ${evolution.levelRequired} –¥–ª—è —ç—Ç–æ–π —ç–≤–æ–ª—é—Ü–∏–∏!`);
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
            gameState.gold -= evolution.cost.gold;
            gameState.essence -= evolution.cost.essence;
            gameState.crystals -= evolution.cost.crystals;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã —ç–≤–æ–ª—é—Ü–∏–∏
            Object.entries(evolution.stats).forEach(([stat, value]) => {
                if (stat in gameState.baseStats) {
                    gameState.baseStats[stat] += value;
                }
            });
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—Ç–∞–¥–∏—é —ç–≤–æ–ª—é—Ü–∏–∏
            gameState.evolutionStage++;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —ç–≤–æ–ª—é—Ü–∏–∏
            gameState.availableEvolutions.push(evolutionId);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification(`üéâ –≠–≤–æ–ª—é—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –í—ã —Å—Ç–∞–ª–∏ ${evolution.name}!`, 5000);
            addLog(`üî• –≠–≤–æ–ª—é—Ü–∏—è –≤ ${evolution.name} –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–ª—É—á–µ–Ω—ã –±–æ–Ω—É—Å—ã –∫ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º.`, "loot");
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –¥—Ä–∞–∫–æ–Ω–∞
            updateDragonIcon();
            
            closeModal();
            updateUI();
        }

        // ==================== –ü–û–î–ó–ï–ú–ï–õ–¨–Ø ====================
        function showDungeon() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üè∞ –ü–æ–¥–∑–µ–º–µ–ª—å—è</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; color: var(--color-text-secondary);">
                        –ò—Å—Å–ª–µ–¥—É–π—Ç–µ –æ–ø–∞—Å–Ω—ã–µ –ø–æ–¥–∑–µ–º–µ–ª—å—è, —Å—Ä–∞–∂–∞–π—Ç–µ—Å—å —Å –º–æ–Ω—Å—Ç—Ä–∞–º–∏ –∏ –Ω–∞—Ö–æ–¥–∏—Ç–µ —Ä–µ–¥–∫–∏–µ —Å–æ–∫—Ä–æ–≤–∏—â–∞.
                        –ö–∞–∂–¥–æ–µ –ø–æ–¥–∑–µ–º–µ–ª—å–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç—Ç–∞–∂–µ–π —Å –±–æ—Å—Å–æ–º –≤ –∫–æ–Ω—Ü–µ.
                    </div>
                    
                    <div class="dungeon-select">
                        ${DUNGEONS.map(dungeon => {
                            const playerLevel = gameState.level;
                            const isAvailable = playerLevel >= dungeon.level;
                            const progress = gameState.dungeonProgress[dungeon.id] || 0;
                            
                            return `
                                <div class="dungeon-level" onclick="${isAvailable ? `enterDungeon('${dungeon.id}')` : ''}">
                                    <div style="font-size: 32px; margin-bottom: 10px;">üè∞</div>
                                    <div style="font-weight: bold; font-size: 18px; margin-bottom: 5px;">${dungeon.name}</div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 10px;">
                                        ${dungeon.floors} —ç—Ç–∞–∂–µ–π, —É—Ä–æ–≤–µ–Ω—å ${dungeon.level}+
                                    </div>
                                    <div style="font-size: 11px; color: #666;">
                                        –ü—Ä–æ–≥—Ä–µ—Å—Å: ${progress}/${dungeon.floors}
                                    </div>
                                    ${!isAvailable ? `<div style="color: var(--color-danger); font-size: 10px; margin-top: 5px;">–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å ${dungeon.level}</div>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(255, 165, 2, 0.1); border-radius: 10px; border-left: 4px solid var(--color-warning);">
                        <div style="color: var(--color-warning); font-weight: bold; margin-bottom: 5px;">–ù–∞–≥—Ä–∞–¥—ã –∑–∞ –ø–æ–¥–∑–µ–º–µ–ª—å—è:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—ã—Ç–∞ –∏ –∑–æ–ª–æ—Ç–∞<br>
                            ‚Ä¢ –†–µ–¥–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞<br>
                            ‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏<br>
                            ‚Ä¢ –ö—Ä–∏—Å—Ç–∞–ª–ª—ã –∏ —ç—Å—Å–µ–Ω—Ü–∏—è
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function enterDungeon(dungeonId) {
            const dungeon = DUNGEONS.find(d => d.id === dungeonId);
            if (!dungeon) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–Ω–µ—Ä–≥–∏—é
            if (gameState.energy < 30) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–¥–∑–µ–º–µ–ª—å—è!");
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —ç–Ω–µ—Ä–≥–∏—é
            gameState.energy -= 30;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–¥–∑–µ–º–µ–ª—å–µ
            generateDungeon(dungeon);
            
            closeModal();
            updateUI();
        }

        function generateDungeon(dungeon) {
            addLog(`üè∞ –í—ã –≤–æ—à–ª–∏ –≤ ${dungeon.name}. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ...`, "quest");
            
            // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø–æ–¥–∑–µ–º–µ–ª—å—è
            setTimeout(() => {
                let totalRewards = {
                    xp: 0,
                    gold: 0,
                    essence: 0,
                    crystals: 0,
                    items: []
                };
                
                let success = true;
                let floorsCleared = 0;
                
                // –ü—Ä–æ—Ö–æ–¥–∏–º —ç—Ç–∞–∂–∏
                for (let floor = 1; floor <= dungeon.floors; floor++) {
                    const floorDifficulty = floor / dungeon.floors;
                    
                    // –®–∞–Ω—Å –ø—Ä–æ–π—Ç–∏ —ç—Ç–∞–∂ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —ç—Ç–∞–∂–∞
                    const successChance = 80 - (floorDifficulty * 40) + (gameState.level - dungeon.level) * 5;
                    const isFloorSuccess = Math.random() * 100 < Math.max(20, Math.min(95, successChance));
                    
                    if (!isFloorSuccess) {
                        addLog(`üí• –í—ã –Ω–µ —Å–º–æ–≥–ª–∏ –ø—Ä–æ–π—Ç–∏ ${floor} —ç—Ç–∞–∂ ${dungeon.name}`, "damage");
                        success = false;
                        break;
                    }
                    
                    floorsCleared++;
                    
                    // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ —ç—Ç–∞–∂
                    const floorReward = {
                        xp: Math.floor(dungeon.rewards.xp * (floorDifficulty * 0.5 + 0.5) / dungeon.floors),
                        gold: Math.floor(dungeon.rewards.gold * (floorDifficulty * 0.5 + 0.5) / dungeon.floors),
                        essence: Math.floor((dungeon.rewards.essence || 0) * (floorDifficulty * 0.5 + 0.5) / dungeon.floors),
                        crystals: Math.floor((dungeon.rewards.crystals || 0) * (floorDifficulty * 0.3 + 0.2) / dungeon.floors)
                    };
                    
                    totalRewards.xp += floorReward.xp;
                    totalRewards.gold += floorReward.gold;
                    totalRewards.essence += floorReward.essence;
                    totalRewards.crystals += floorReward.crystals;
                    
                    addLog(`‚úÖ –ü—Ä–æ–π–¥–µ–Ω ${floor} —ç—Ç–∞–∂. –ü–æ–ª—É—á–µ–Ω–æ: ${floorReward.xp} –æ–ø—ã—Ç–∞, ${floorReward.gold} –∑–æ–ª–æ—Ç–∞`, "loot");
                    
                    // –®–∞–Ω—Å –Ω–∞–π—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç –Ω–∞ —ç—Ç–∞–∂–µ
                    if (Math.random() < 0.2) {
                        const itemRarity = floor > dungeon.floors * 0.8 ? "rare" : 
                                          floor > dungeon.floors * 0.5 ? "uncommon" : "common";
                        const itemCategory = Math.random() < 0.5 ? "armor" : "weapons";
                        const availableItems = ITEM_DATABASE[itemCategory].filter(item => 
                            item.rarity === itemRarity && item.level <= gameState.level
                        );
                        
                        if (availableItems.length > 0) {
                            const item = availableItems[Math.floor(Math.random() * availableItems.length)];
                            totalRewards.items.push(item);
                            addLog(`üéÅ –ù–∞–π–¥–µ–Ω –ø—Ä–µ–¥–º–µ—Ç: ${item.name}`, "loot");
                        }
                    }
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç—Ç–∞–∂ - –±–æ—Å—Å
                    if (floor === dungeon.floors) {
                        const bossEnemy = ENEMIES.find(e => e.id === dungeon.boss) || BOSSES.find(b => b.id === dungeon.boss);
                        if (bossEnemy) {
                            addLog(`üëπ –í—Å—Ç—Ä–µ—á–µ–Ω –±–æ—Å—Å: ${bossEnemy.name}!`, "damage");
                            
                            // –®–∞–Ω—Å –ø–æ–±–µ–¥–∏—Ç—å –±–æ—Å—Å–∞
                            const bossSuccessChance = 60 + (gameState.level - bossEnemy.level) * 10;
                            const isBossDefeated = Math.random() * 100 < Math.max(20, Math.min(90, bossSuccessChance));
                            
                            if (isBossDefeated) {
                                addLog(`üéâ –ë–æ—Å—Å ${bossEnemy.name} –ø–æ–±–µ–∂–¥–µ–Ω!`, "loot");
                                
                                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –±–æ—Å—Å–∞
                                totalRewards.xp += bossEnemy.rewards.xp || 0;
                                totalRewards.gold += bossEnemy.rewards.gold || 0;
                                totalRewards.essence += bossEnemy.rewards.essence || 0;
                                totalRewards.crystals += bossEnemy.rewards.crystals || 0;
                                
                                if (bossEnemy.rewards.items && Math.random() < 0.5) {
                                    const itemId = bossEnemy.rewards.items[Math.floor(Math.random() * bossEnemy.rewards.items.length)];
                                    const item = findItemById(itemId);
                                    if (item) {
                                        totalRewards.items.push(item);
                                        addLog(`üèÜ –ü–æ–ª—É—á–µ–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç: ${item.name}`, "loot");
                                    }
                                }
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–¥–∑–µ–º–µ–ª—å—è
                                gameState.dungeonProgress[dungeon.id] = dungeon.floors;
                                
                            } else {
                                addLog(`üí• –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–±–µ–¥–∏—Ç—å –±–æ—Å—Å–∞ ${bossEnemy.name}`, "damage");
                                success = false;
                                break;
                            }
                        }
                    }
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞–≥—Ä–∞–¥—ã
                if (success || floorsCleared > 0) {
                    gameState.xp += totalRewards.xp;
                    gameState.gold += totalRewards.gold;
                    gameState.essence += totalRewards.essence;
                    gameState.crystals += totalRewards.crystals;
                    
                    totalRewards.items.forEach(item => {
                        addItemToInventory(item);
                    });
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–π–¥–µ–Ω–æ
                    if (!success && floorsCleared > (gameState.dungeonProgress[dungeon.id] || 0)) {
                        gameState.dungeonProgress[dungeon.id] = floorsCleared;
                    }
                    
                    let resultMessage = success 
                        ? `üèÜ –ü–æ–¥–∑–µ–º–µ–ª—å–µ "${dungeon.name}" –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–π–¥–µ–Ω–æ!`
                        : `üìä –í—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–ª–∏ ${floorsCleared} –∏–∑ ${dungeon.floors} —ç—Ç–∞–∂–µ–π`;
                    
                    resultMessage += `\n–ü–æ–ª—É—á–µ–Ω–æ: ${totalRewards.xp} –æ–ø—ã—Ç–∞, ${totalRewards.gold} –∑–æ–ª–æ—Ç–∞`;
                    if (totalRewards.essence > 0) resultMessage += `, ${totalRewards.essence} —ç—Å—Å–µ–Ω—Ü–∏–∏`;
                    if (totalRewards.crystals > 0) resultMessage += `, ${totalRewards.crystals} –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤`;
                    if (totalRewards.items.length > 0) resultMessage += `, ${totalRewards.items.length} –ø—Ä–µ–¥–º–µ—Ç(–æ–≤)`;
                    
                    showNotification(resultMessage, 5000);
                    addLog(resultMessage.replace(/\n/g, " "), success ? "loot" : "info");
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                    checkLevelUp();
                    
                } else {
                    addLog(`üí• –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∑–µ–º–µ–ª—å—è "${dungeon.name}" –ø—Ä–æ–≤–∞–ª–∏–ª–æ—Å—å`, "damage");
                    showNotification("–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–π—Ç–∏ –ø–æ–¥–∑–µ–º–µ–ª—å–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ —Å—Ç–∞–Ω–µ—Ç–µ —Å–∏–ª—å–Ω–µ–µ.");
                }
                
                updateUI();
                
            }, 1000);
        }

        // ==================== –ë–û–°–°–´ ====================
        function showBosses() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üëπ –ë–æ—Å—Å—ã</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; color: var(--color-text-secondary);">
                        –°—Ä–∞–∑–∏—Ç–µ—Å—å —Å –º–æ–≥—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –±–æ—Å—Å–∞–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥.
                        –ö–∞–∂–¥—ã–π –±–æ—Å—Å –∏–º–µ–µ—Ç –æ—Å–æ–±—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–±—É–µ—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏.
                    </div>
                    
                    <div class="boss-list">
                        ${BOSSES.map(boss => {
                            const kills = gameState.bossKills[boss.id] || 0;
                            const isAvailable = gameState.level >= boss.level - 5;
                            const canChallenge = gameState.energy >= 50 && isAvailable;
                            
                            return `
                                <div class="boss-entry" onclick="${canChallenge ? `challengeBoss('${boss.id}')` : ''}">
                                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                        <div style="font-size: 40px;">üëπ</div>
                                        <div>
                                            <div style="font-weight: bold; font-size: 18px;">${boss.name}</div>
                                            <div style="font-size: 12px; color: var(--color-text-secondary);">
                                                –£—Ä–æ–≤–µ–Ω—å ${boss.level} | –£–±–∏–π—Å—Ç–≤: ${kills}
                                            </div>
                                        </div>
                                    </div>
                                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                                        ${boss.specialAbility}
                                    </div>
                                    <div style="font-size: 11px; color: #666;">
                                        –ù–∞–≥—Ä–∞–¥–∞: ${boss.rewards.xp} –æ–ø—ã—Ç–∞, ${boss.rewards.gold} –∑–æ–ª–æ—Ç–∞
                                        ${boss.rewards.crystals ? `, ${boss.rewards.crystals} –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤` : ''}
                                    </div>
                                    ${!isAvailable ? `<div style="color: var(--color-danger); font-size: 10px; margin-top: 5px;">–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å ${boss.level - 5}+</div>` : ''}
                                    ${gameState.energy < 50 ? `<div style="color: var(--color-danger); font-size: 10px; margin-top: 5px;">–¢—Ä–µ–±—É–µ—Ç—Å—è 50 —ç–Ω–µ—Ä–≥–∏–∏</div>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(255, 71, 87, 0.1); border-radius: 10px; border-left: 4px solid var(--color-danger);">
                        <div style="color: var(--color-danger); font-weight: bold; margin-bottom: 5px;">–°–æ–≤–µ—Ç—ã –ø–æ –±–æ—é —Å –±–æ—Å—Å–∞–º–∏:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∑–µ–ª—å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è<br>
                            ‚Ä¢ –≠–∫–∏–ø–∏—Ä—É–π—Ç–µ –ª—É—á—à–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã<br>
                            ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–∞–≤—ã–∫–∏<br>
                            ‚Ä¢ –ò–∑—É—á–∏—Ç–µ –æ—Å–æ–±—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –±–æ—Å—Å–∞
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function challengeBoss(bossId) {
            const boss = BOSSES.find(b => b.id === bossId);
            if (!boss) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–Ω–µ—Ä–≥–∏—é
            if (gameState.energy < 50) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –±–æ—è —Å –±–æ—Å—Å–æ–º!");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–µ–Ω—å
            if (gameState.level < boss.level - 5) {
                showNotification(`–î–ª—è –±–æ—è —Å —ç—Ç–∏–º –±–æ—Å—Å–æ–º —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å ${boss.level - 5}+!`);
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —ç–Ω–µ—Ä–≥–∏—é
            gameState.energy -= 50;
            
            // –ù–∞—á–∏–Ω–∞–µ–º –±–æ–π —Å –±–æ—Å—Å–æ–º
            startBattle(boss, true);
            
            closeModal();
            updateUI();
        }

        // ==================== –ö–õ–ê–ù ====================
        function showClan() {
            const hasClan = gameState.clan.name !== "";
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üèõÔ∏è –ö–ª–∞–Ω –¥—Ä–∞–∫–æ–Ω–æ–≤</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    ${hasClan ? `
                        <div style="margin: 20px 0;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--color-primary); margin-bottom: 10px;">
                                ${gameState.clan.name}
                            </div>
                            <div style="color: var(--color-text-secondary); margin-bottom: 20px;">
                                –£—Ä–æ–≤–µ–Ω—å –∫–ª–∞–Ω–∞: ${gameState.clan.level} | –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${gameState.clan.members.length}/10
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px;">
                                <div style="padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 10px;">üí∞</div>
                                    <div style="font-weight: bold; margin-bottom: 5px;">–†–µ—Å—É—Ä—Å—ã –∫–ª–∞–Ω–∞</div>
                                    <div style="color: var(--color-text-secondary);">${gameState.clan.resources}</div>
                                </div>
                                
                                <div style="padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 10px;">üìä</div>
                                    <div style="font-weight: bold; margin-bottom: 5px;">–û–±—â–∞—è —Å–∏–ª–∞</div>
                                    <div style="color: var(--color-text-secondary);">
                                        ${gameState.clan.members.reduce((sum, member) => sum + member.power, 0)}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="section-title">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–ª–∞–Ω–∞</div>
                            <div class="clan-members">
                                ${gameState.clan.members.map(member => `
                                    <div class="clan-member">
                                        <div style="font-weight: bold; margin-bottom: 5px;">${member.name}</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary);">
                                            –£—Ä–æ–≤–µ–Ω—å: ${member.level}<br>
                                            –°–∏–ª–∞: ${member.power}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <button onclick="clanDonate()" 
                                    style="width: 100%; padding: 15px; margin-top: 30px; background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); border: none; border-radius: 10px; color: white; font-size: 16px; font-weight: bold; cursor: pointer;">
                                –ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã (1000 –∑–æ–ª–æ—Ç–∞)
                            </button>
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 30px 0;">
                            <div style="font-size: 60px; margin-bottom: 20px;">üèõÔ∏è</div>
                            <div style="font-size: 24px; margin-bottom: 10px;">–í—ã –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –∫–ª–∞–Ω–µ</div>
                            <div style="color: var(--color-text-secondary); margin-bottom: 30px;">
                                –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –∫–ª–∞–Ω—É –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –±–æ–Ω—É—Å—ã –∏ –∏–≥—Ä–∞—Ç—å –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ –¥—Ä–∞–∫–æ–Ω–∞–º–∏.
                            </div>
                            
                            <div style="display: flex; gap: 15px; justify-content: center;">
                                <button onclick="createClan()" 
                                        style="padding: 12px 24px; background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer;">
                                    –°–æ–∑–¥–∞—Ç—å –∫–ª–∞–Ω (5000 –∑–æ–ª–æ—Ç–∞)
                                </button>
                                
                                <button onclick="joinRandomClan()" 
                                        style="padding: 12px 24px; background: linear-gradient(45deg, var(--color-info), #5352ed); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer;">
                                    –ù–∞–π—Ç–∏ –∫–ª–∞–Ω
                                </button>
                            </div>
                        </div>
                    `}
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(55, 66, 250, 0.1); border-radius: 10px; border-left: 4px solid var(--color-info);">
                        <div style="color: var(--color-info); font-weight: bold; margin-bottom: 5px;">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–ª–∞–Ω–∞:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –ë–æ–Ω—É—Å—ã –∫ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º (–¥–æ +10% –∑–∞ —É—Ä–æ–≤–µ–Ω—å –∫–ª–∞–Ω–∞)<br>
                            ‚Ä¢ –°–æ–≤–º–µ—Å—Ç–Ω—ã–µ —Ä–µ–π–¥—ã –Ω–∞ –±–æ—Å—Å–æ–≤<br>
                            ‚Ä¢ –û–±–º–µ–Ω –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏<br>
                            ‚Ä¢ –ö–ª–∞–Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –Ω–∞–≥—Ä–∞–¥–∞–º–∏
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function createClan() {
            if (gameState.gold < 5000) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–Ω–∞!");
                return;
            }
            
            const clanName = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞ (3-20 —Å–∏–º–≤–æ–ª–æ–≤):");
            if (!clanName || clanName.length < 3 || clanName.length > 20) {
                showNotification("–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 3 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤!");
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º –∑–æ–ª–æ—Ç–æ
            gameState.gold -= 5000;
            
            // –°–æ–∑–¥–∞–µ–º –∫–ª–∞–Ω
            gameState.clan = {
                name: clanName,
                level: 1,
                members: [
                    {
                        name: gameState.dragonName,
                        level: gameState.level,
                        power: gameState.stats.attack + gameState.stats.defense,
                        role: "–õ–∏–¥–µ—Ä"
                    }
                ],
                resources: 1000
            };
            
            showNotification(`–ö–ª–∞–Ω "${clanName}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!`, 4000);
            addLog(`üèõÔ∏è –°–æ–∑–¥–∞–Ω –∫–ª–∞–Ω "${clanName}"`, "info");
            
            closeModal();
            updateUI();
        }

        function joinRandomClan() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –∫–ª–∞–Ω–æ–≤
            // –î–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª–∞–Ω
            
            const randomClans = [
                { name: "–î—Ä–∞–∫–æ–Ω—ã –û–≥–Ω—è", level: 3, members: 5 },
                { name: "–ö—Ä—ã–ª—å—è –¢—å–º—ã", level: 2, members: 3 },
                { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ", level: 5, members: 8 }
            ];
            
            const clan = randomClans[Math.floor(Math.random() * randomClans.length)];
            
            if (confirm(`–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–ª–∞–Ω—É "${clan.name}" (—É—Ä–æ–≤–µ–Ω—å ${clan.level}, ${clan.members}/10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤)?`)) {
                gameState.clan = {
                    name: clan.name,
                    level: clan.level,
                    members: [
                        {
                            name: gameState.dragonName,
                            level: gameState.level,
                            power: gameState.stats.attack + gameState.stats.defense,
                            role: "–£—á–∞—Å—Ç–Ω–∏–∫"
                        }
                    ],
                    resources: clan.level * 1000
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º NPC-—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–ª—è –¥–µ–º–æ
                for (let i = 0; i < clan.members - 1; i++) {
                    gameState.clan.members.push({
                        name: `–î—Ä–∞–∫–æ–Ω ${i + 1}`,
                        level: Math.floor(Math.random() * 10) + 1,
                        power: Math.floor(Math.random() * 500) + 100,
                        role: "–£—á–∞—Å—Ç–Ω–∏–∫"
                    });
                }
                
                showNotification(`–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∫–ª–∞–Ω—É "${clan.name}"!`, 4000);
                addLog(`üèõÔ∏è –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∫–ª–∞–Ω—É "${clan.name}"`, "info");
                
                closeModal();
                updateUI();
            }
        }

        function clanDonate() {
            if (gameState.gold < 1000) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞ –¥–ª—è –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è!");
                return;
            }
            
            gameState.gold -= 1000;
            gameState.clan.resources += 1000;
            
            // –®–∞–Ω—Å –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è –∫–ª–∞–Ω–∞
            if (gameState.clan.resources >= gameState.clan.level * 5000 && Math.random() < 0.3) {
                gameState.clan.level++;
                showNotification(`–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ! –£—Ä–æ–≤–µ–Ω—å –∫–ª–∞–Ω–∞ –ø–æ–≤—ã—à–µ–Ω –¥–æ ${gameState.clan.level}!`, 4000);
                addLog(`üèõÔ∏è –ö–ª–∞–Ω "${gameState.clan.name}" –ø–æ–≤—ã—Å–∏–ª —É—Ä–æ–≤–µ–Ω—å –¥–æ ${gameState.clan.level}`, "loot");
            } else {
                showNotification("–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ! –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ –∫–ª–∞–Ω–∞.", 3000);
            }
            
            updateUI();
        }

        // ==================== –†–´–ù–û–ö ====================
        function showMarket() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üè™ –†—ã–Ω–æ–∫ –¥—Ä–∞–∫–æ–Ω–æ–≤</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; color: var(--color-text-secondary);">
                        –ü–æ–∫—É–ø–∞–π—Ç–µ –∏ –ø—Ä–æ–¥–∞–≤–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–∞ —Ä—ã–Ω–∫–µ. –¶–µ–Ω—ã –º–µ–Ω—è—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ø—Ä–æ—Å–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px;">
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; cursor: pointer;" onclick="showMarketBuy()">
                            <div style="font-size: 48px; margin-bottom: 15px;">üõí</div>
                            <div style="font-weight: bold; font-size: 20px; margin-bottom: 10px;">–ö—É–ø–∏—Ç—å</div>
                            <div style="color: var(--color-text-secondary);">
                                –ü—Ä–∏–æ–±—Ä–µ—Ç–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã —É –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
                            </div>
                        </div>
                        
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; cursor: pointer;" onclick="showMarketSell()">
                            <div style="font-size: 48px; margin-bottom: 15px;">üí∞</div>
                            <div style="font-weight: bold; font-size: 20px; margin-bottom: 10px;">–ü—Ä–æ–¥–∞—Ç—å</div>
                            <div style="color: var(--color-text-secondary);">
                                –í—ã—Å—Ç–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–∞ –ø—Ä–æ–¥–∞–∂—É
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(46, 204, 113, 0.1); border-radius: 10px; border-left: 4px solid var(--color-success);">
                        <div style="color: var(--color-success); font-weight: bold; margin-bottom: 5px;">–°–æ–≤–µ—Ç –ø–æ —Ç–æ—Ä–≥–æ–≤–ª–µ:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –†–µ–¥–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –ø—Ä–æ–¥–∞—é—Ç—Å—è –¥–æ—Ä–æ–∂–µ<br>
                            ‚Ä¢ –ü—Ä–µ–¥–º–µ—Ç—ã —Å —Ö–æ—Ä–æ—à–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ —Ü–µ–Ω—è—Ç—Å—è –≤—ã—à–µ<br>
                            ‚Ä¢ –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å–ø—Ä–æ—Å–æ–º –Ω–∞ —Ä—ã–Ω–∫–µ<br>
                            ‚Ä¢ –ö–æ–º–∏—Å—Å–∏—è —Ä—ã–Ω–∫–∞: 10% –æ—Ç —Å—É–º–º—ã —Å–¥–µ–ª–∫–∏
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function showMarketBuy() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –æ—Ç –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
            // –î–ª—è –¥–µ–º–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
            
            const marketItems = [];
            const categories = ["armor", "weapons", "wings", "amulet"];
            
            for (let i = 0; i < 6; i++) {
                const category = categories[Math.floor(Math.random() * categories.length)];
                const items = ITEM_DATABASE[category];
                if (items && items.length > 0) {
                    const item = items[Math.floor(Math.random() * Math.min(5, items.length))];
                    const price = Math.floor(item.price * (1 + Math.random() * 0.5)); // –¶–µ–Ω–∞ –Ω–∞ 0-50% –≤—ã—à–µ
                    marketItems.push({
                        ...item,
                        category: category,
                        marketPrice: price,
                        seller: `–ò–≥—Ä–æ–∫ ${Math.floor(Math.random() * 1000)}`
                    });
                }
            }
            
            const itemsHTML = marketItems.map(item => `
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 32px;">${item.icon}</div>
                        <div>
                            <div style="font-weight: bold; color: ${getRarityColor(item.rarity)};">${item.name}</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">
                                ${getRarityName(item.rarity)} | –ü—Ä–æ–¥–∞–≤–µ—Ü: ${item.seller}
                            </div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: bold; color: #ffd700; font-size: 18px;">${item.marketPrice} –∑–æ–ª–æ—Ç–∞</div>
                        <button onclick="buyMarketItem('${item.id}', '${item.category}', ${item.marketPrice})" 
                                style="margin-top: 5px; padding: 5px 15px; background: var(--color-success); border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px;">
                            –ö—É–ø–∏—Ç—å
                        </button>
                    </div>
                </div>
            `).join('');
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üõí –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; color: var(--color-text-secondary);">
                        –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–∞ —Ä—ã–Ω–∫–µ. –¶–µ–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏.
                    </div>
                    
                    ${marketItems.length > 0 ? itemsHTML : `
                        <div style="text-align: center; padding: 30px; color: var(--color-text-secondary);">
                            –ù–∞ —Ä—ã–Ω–∫–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏.
                        </div>
                    `}
                    
                    <div style="margin-top: 20px; font-size: 12px; color: #666; text-align: center;">
                        –°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function buyMarketItem(itemId, category, price) {
            if (gameState.gold < price) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏!");
                return;
            }
            
            const item = findItemById(itemId);
            if (!item) return;
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º –∑–æ–ª–æ—Ç–æ
            gameState.gold -= price;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            addItemToInventory(item);
            
            showNotification(`–ü—Ä–µ–¥–º–µ—Ç "${item.name}" –∫—É–ø–ª–µ–Ω –∑–∞ ${price} –∑–æ–ª–æ—Ç–∞!`);
            addLog(`üõí –ö—É–ø–ª–µ–Ω –ø—Ä–µ–¥–º–µ—Ç "${item.name}" –∑–∞ ${price} –∑–æ–ª–æ—Ç–∞`, "loot");
            
            closeModal();
            updateUI();
        }

        function showMarketSell() {
            // –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø—Ä–æ–¥–∞—Ç—å
            const sellableItems = [];
            
            ["armor", "weapons", "wings", "amulet", "materials", "special"].forEach(category => {
                gameState.inventory[category].forEach(itemData => {
                    const item = findItemById(itemData.id);
                    if (item) {
                        const count = itemData.count || 1;
                        for (let i = 0; i < count; i++) {
                            const basePrice = item.price || 50;
                            const marketPrice = Math.floor(basePrice * (0.8 + Math.random() * 0.4)); // –¶–µ–Ω–∞ –Ω–∞ 80-120% –æ—Ç –±–∞–∑–æ–≤–æ–π
                            
                            sellableItems.push({
                                ...item,
                                category: category,
                                marketPrice: marketPrice,
                                instanceId: `${item.id}_${Date.now()}_${Math.random()}`
                            });
                        }
                    }
                });
            });
            
            if (sellableItems.length === 0) {
                showNotification("–ù–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –Ω–∞ —Ä—ã–Ω–∫–µ!");
                closeModal();
                return;
            }
            
            const itemsHTML = sellableItems.slice(0, 6).map(item => `
                <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 32px;">${item.icon}</div>
                        <div>
                            <div style="font-weight: bold; color: ${getRarityColor(item.rarity)};">${item.name}</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">
                                ${getRarityName(item.rarity)} | –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞: ${item.price || 50} –∑–æ–ª–æ—Ç–∞
                            </div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: bold; color: #ffd700; font-size: 18px;">${item.marketPrice} –∑–æ–ª–æ—Ç–∞</div>
                        <button onclick="sellMarketItem('${item.id}', '${item.category}', ${item.marketPrice})" 
                                style="margin-top: 5px; padding: 5px 15px; background: var(--color-danger); border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px;">
                            –í—ã—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∂—É
                        </button>
                    </div>
                </div>
            `).join('');
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üí∞ –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; color: var(--color-text-secondary);">
                        –í—ã—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–∞ –ø—Ä–æ–¥–∞–∂—É. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ü–µ–Ω–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                    </div>
                    
                    ${itemsHTML}
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(231, 76, 60, 0.1); border-radius: 10px; border-left: 4px solid #e74c3c;">
                        <div style="color: #e74c3c; font-weight: bold; margin-bottom: 5px;">–í–Ω–∏–º–∞–Ω–∏–µ:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –ö–æ–º–∏—Å—Å–∏—è —Ä—ã–Ω–∫–∞: 10% –æ—Ç —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂–∏<br>
                            ‚Ä¢ –ü—Ä–µ–¥–º–µ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –∫—É–ø–ª–µ–Ω –Ω–µ —Å—Ä–∞–∑—É<br>
                            ‚Ä¢ –í—ã –º–æ–∂–µ—Ç–µ —Å–Ω—è—Ç—å –ø—Ä–µ–¥–º–µ—Ç —Å –ø—Ä–æ–¥–∞–∂–∏ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç<br>
                            ‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 5 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ –ø—Ä–æ–¥–∞–∂–µ
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function sellMarketItem(itemId, category, price) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            const removed = removeItemFromInventory(itemId, category);
            if (!removed) {
                showNotification("–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∂—É!");
                return;
            }
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –ø—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª—è–ª—Å—è –±—ã –≤ —Å–ø–∏—Å–æ–∫ –Ω–∞ –ø—Ä–æ–¥–∞–∂—É
            // –î–ª—è –¥–µ–º–æ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ–º –¥–µ–Ω—å–≥–∏ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–∏
            const commission = Math.floor(price * 0.1);
            const finalPrice = price - commission;
            
            gameState.gold += finalPrice;
            
            showNotification(`–ü—Ä–µ–¥–º–µ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–¥–∞–∂—É –∑–∞ ${price} –∑–æ–ª–æ—Ç–∞ (–∫–æ–º–∏—Å—Å–∏—è: ${commission} –∑–æ–ª–æ—Ç–∞)`);
            addLog(`üí∞ –ü—Ä–µ–¥–º–µ—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–¥–∞–∂—É. –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: ${finalPrice} –∑–æ–ª–æ—Ç–∞`, "loot");
            
            closeModal();
            updateUI();
        }

        // ==================== PvP –ê–†–ï–ù–ê ====================
        function showPvP() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">‚öîÔ∏è PvP –ê—Ä–µ–Ω–∞</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 60px; margin-bottom: 20px;">‚öîÔ∏è</div>
                        <div style="font-size: 24px; margin-bottom: 10px;">–†–µ–π—Ç–∏–Ω–≥: ${gameState.pvpStats.rating}</div>
                        <div style="color: var(--color-text-secondary);">
                            ${gameState.pvpStats.wins} –ø–æ–±–µ–¥ / ${gameState.pvpStats.losses} –ø–æ—Ä–∞–∂–µ–Ω–∏–π
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 30px 0;">
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; cursor: pointer;" onclick="findPvPOpponent()">
                            <div style="font-size: 32px; margin-bottom: 15px;">üîç</div>
                            <div style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">–ù–∞–π—Ç–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</div>
                            <div style="color: var(--color-text-secondary); font-size: 14px;">
                                –°—Ä–∞–∑–∏—Ç–µ—Å—å —Å —Å–ª—É—á–∞–π–Ω—ã–º –∏–≥—Ä–æ–∫–æ–º
                            </div>
                        </div>
                        
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; cursor: pointer;" onclick="showPvPRanking()">
                            <div style="font-size: 32px; margin-bottom: 15px;">üèÜ</div>
                            <div style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">–†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞</div>
                            <div style="color: var(--color-text-secondary); font-size: 14px;">
                                –¢–æ–ø-10 –ª—É—á—à–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(255, 71, 87, 0.1); border-radius: 10px; border-left: 4px solid var(--color-danger);">
                        <div style="color: var(--color-danger); font-weight: bold; margin-bottom: 5px;">–ü—Ä–∞–≤–∏–ª–∞ PvP:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –ö–∞–∂–¥—ã–π –±–æ–π —Å—Ç–æ–∏—Ç 20 —ç–Ω–µ—Ä–≥–∏–∏<br>
                            ‚Ä¢ –ó–∞ –ø–æ–±–µ–¥—É: +20 —Ä–µ–π—Ç–∏–Ω–≥–∞, 100 –∑–æ–ª–æ—Ç–∞, 50 –æ–ø—ã—Ç–∞<br>
                            ‚Ä¢ –ó–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ: -10 —Ä–µ–π—Ç–∏–Ω–≥–∞, 20 –∑–æ–ª–æ—Ç–∞, 10 –æ–ø—ã—Ç–∞<br>
                            ‚Ä¢ –ë–æ–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function findPvPOpponent() {
            if (gameState.energy < 20) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è PvP –±–æ—è!");
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —ç–Ω–µ—Ä–≥–∏—é
            gameState.energy -= 20;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
            const opponentPower = Math.max(100, gameState.pvpStats.rating * (0.8 + Math.random() * 0.4));
            const opponentLevel = Math.max(1, gameState.level - 5 + Math.floor(Math.random() * 11));
            
            // –®–∞–Ω—Å –ø–æ–±–µ–¥—ã –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–Ω–∏—Ü—ã –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ –∏ —É—Ä–æ–≤–Ω–µ
            const ratingDiff = gameState.pvpStats.rating - opponentPower;
            const levelDiff = gameState.level - opponentLevel;
            const winChance = 50 + ratingDiff * 0.1 + levelDiff * 2;
            const isWin = Math.random() * 100 < Math.max(10, Math.min(90, winChance));
            
            // –†–µ–∑—É–ª—å—Ç–∞—Ç –±–æ—è
            if (isWin) {
                gameState.pvpStats.wins++;
                gameState.pvpStats.rating += 20;
                gameState.gold += 100;
                gameState.xp += 50;
                
                showNotification(`üéâ –ü–æ–±–µ–¥–∞ –≤ PvP! –ü–æ–ª—É—á–µ–Ω–æ: +20 —Ä–µ–π—Ç–∏–Ω–≥–∞, 100 –∑–æ–ª–æ—Ç–∞, 50 –æ–ø—ã—Ç–∞`, 4000);
                addLog(`‚öîÔ∏è PvP –ø–æ–±–µ–¥–∞! –†–µ–π—Ç–∏–Ω–≥: ${gameState.pvpStats.rating} (+20)`, "loot");
                
            } else {
                gameState.pvpStats.losses++;
                gameState.pvpStats.rating = Math.max(0, gameState.pvpStats.rating - 10);
                gameState.gold += 20;
                gameState.xp += 10;
                
                showNotification(`üí• –ü–æ—Ä–∞–∂–µ–Ω–∏–µ –≤ PvP. –ü–æ–ª—É—á–µ–Ω–æ: -10 —Ä–µ–π—Ç–∏–Ω–≥–∞, 20 –∑–æ–ª–æ—Ç–∞, 10 –æ–ø—ã—Ç–∞`, 4000);
                addLog(`‚öîÔ∏è PvP –ø–æ—Ä–∞–∂–µ–Ω–∏–µ. –†–µ–π—Ç–∏–Ω–≥: ${gameState.pvpStats.rating} (-10)`, "damage");
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            checkLevelUp();
            
            closeModal();
            updateUI();
        }

        function showPvPRanking() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã —Ä–µ–π—Ç–∏–Ω–≥ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
            // –î–ª—è –¥–µ–º–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
            
            const rankings = [];
            for (let i = 1; i <= 10; i++) {
                rankings.push({
                    rank: i,
                    name: i === 1 ? gameState.dragonName : `–î—Ä–∞–∫–æ–Ω ${1000 + i}`,
                    rating: 1500 - (i - 1) * 50 + Math.floor(Math.random() * 100),
                    level: Math.floor(Math.random() * 30) + 1,
                    wins: Math.floor(Math.random() * 100),
                    isPlayer: i === 1
                });
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
            rankings.sort((a, b) => b.rating - a.rating);
            
            const rankingHTML = rankings.map(player => `
                <div style="margin-bottom: 10px; padding: 15px; background: ${player.isPlayer ? 'rgba(255, 138, 0, 0.1)' : 'rgba(0,0,0,0.3)'}; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; border-left: 4px solid ${player.isPlayer ? 'var(--color-primary)' : 'transparent'};">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-weight: bold; font-size: 18px; width: 30px; text-align: center; color: ${player.rank <= 3 ? '#ffd700' : 'var(--color-text)'};">#${player.rank}</div>
                        <div>
                            <div style="font-weight: bold;">${player.name}${player.isPlayer ? ' (–í—ã)' : ''}</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">
                                –£—Ä–æ–≤–µ–Ω—å ${player.level} | ${player.wins} –ø–æ–±–µ–¥
                            </div>
                        </div>
                    </div>
                    <div style="font-weight: bold; color: #ffd700; font-size: 18px;">${player.rating}</div>
                </div>
            `).join('');
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üèÜ –†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; color: var(--color-text-secondary);">
                        –¢–æ–ø-10 –ª—É—á—à–∏—Ö –¥—Ä–∞–∫–æ–Ω–æ–≤ –Ω–∞ –∞—Ä–µ–Ω–µ. –°—Ä–∞–∂–∞–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–¥–Ω—è—Ç—å—Å—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ!
                    </div>
                    
                    ${rankingHTML}
                    
                    <div style="margin-top: 20px; font-size: 12px; color: #666; text-align: center;">
                        –†–µ–π—Ç–∏–Ω–≥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ==================== –ö–†–ê–§–¢ ====================
        function showCrafting() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üî® –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –∫—Ä–∞—Ñ—Ç–∞</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üî®</div>
                        <div style="font-size: 24px; margin-bottom: 10px;">–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>
                        <div style="color: var(--color-text-secondary);">
                            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤. –ö–∞–∂–¥—ã–π —Ä–µ—Ü–µ–ø—Ç —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 30px 0;">
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; cursor: pointer;" onclick="showCraftingRecipes('weapons')">
                            <div style="font-size: 32px; margin-bottom: 15px;">‚öîÔ∏è</div>
                            <div style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">–û—Ä—É–∂–∏–µ</div>
                            <div style="color: var(--color-text-secondary); font-size: 14px;">
                                –ú–µ—á–∏, –∫–æ–≥—Ç–∏, –∫–æ–ø—å—è
                            </div>
                        </div>
                        
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; cursor: pointer;" onclick="showCraftingRecipes('armor')">
                            <div style="font-size: 32px; margin-bottom: 15px;">üõ°Ô∏è</div>
                            <div style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">–î–æ—Å–ø–µ—Ö–∏</div>
                            <div style="color: var(--color-text-secondary); font-size: 14px;">
                                –®–ª–µ–º—ã, –Ω–∞–≥—Ä—É–¥–Ω–∏–∫–∏, –ø–æ–Ω–æ–∂–∏
                            </div>
                        </div>
                        
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; cursor: pointer;" onclick="showCraftingRecipes('potions')">
                            <div style="font-size: 32px; margin-bottom: 15px;">üß™</div>
                            <div style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">–ó–µ–ª—å—è</div>
                            <div style="color: var(--color-text-secondary); font-size: 14px;">
                            –õ–µ—á–µ–±–Ω—ã–µ, —É—Å–∏–ª–∏–≤–∞—é—â–∏–µ
                            </div>
                        </div>
                        
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; cursor: pointer;" onclick="showCraftingRecipes('special')">
                            <div style="font-size: 32px; margin-bottom: 15px;">‚ú®</div>
                            <div style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">–û—Å–æ–±—ã–µ</div>
                            <div style="color: var(--color-text-secondary); font-size: 14px;">
                                –ö–ª—é—á–∏, —è–π—Ü–∞, —Å–≤–∏—Ç–∫–∏
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(52, 152, 219, 0.1); border-radius: 10px; border-left: 4px solid #3498db;">
                        <div style="color: #3498db; font-weight: bold; margin-bottom: 5px;">–û –∫—Ä–∞—Ñ—Ç–µ:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –†–µ—Ü–µ–ø—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å –ø–æ–≤—ã—à–µ–Ω–∏–µ–º —É—Ä–æ–≤–Ω—è<br>
                            ‚Ä¢ –®–∞–Ω—Å —É—Å–ø–µ—Ö–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è –Ω–∞–≤—ã–∫–∞ –∫—Ä–∞—Ñ—Ç–∞<br>
                            ‚Ä¢ –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Ç–µ—Ä—è—é—Ç—Å—è<br>
                            ‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function showCraftingRecipes(category) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª–∏ –±—ã —Ä–µ—Ü–µ–ø—Ç—ã –∫—Ä–∞—Ñ—Ç–∞
            // –î–ª—è –¥–µ–º–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
            
            const recipes = {
                weapons: [
                    {
                        id: "craft_sword",
                        name: "–°—Ç–∞–ª—å–Ω–æ–π –º–µ—á",
                        icon: "‚öîÔ∏è",
                        materials: [
                            { id: "mat_dragon_scale", count: 5 },
                            { id: "mat_fire_crystal", count: 2 }
                        ],
                        result: "weapon_beginner",
                        successChance: 80
                    }
                ],
                armor: [
                    {
                        id: "craft_helmet",
                        name: "–ñ–µ–ª–µ–∑–Ω—ã–π —à–ª–µ–º",
                        icon: "‚õëÔ∏è",
                        materials: [
                            { id: "mat_dragon_scale", count: 3 },
                            { id: "mat_ice_heart", count: 1 }
                        ],
                        result: "helmet_beginner",
                        successChance: 85
                    }
                ],
                potions: [
                    {
                        id: "craft_potion",
                        name: "–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è",
                        icon: "‚ù§Ô∏è",
                        materials: [
                            { id: "mat_dragon_scale", count: 2 }
                        ],
                        result: "potion_health_small",
                        successChance: 90
                    }
                ],
                special: [
                    {
                        id: "craft_key",
                        name: "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –∫–ª—é—á",
                        icon: "üîë",
                        materials: [
                            { id: "mat_dragon_scale", count: 10 },
                            { id: "mat_fire_crystal", count: 5 },
                            { id: "mat_ice_heart", count: 3 }
                        ],
                        result: "item_legendary_key",
                        successChance: 60
                    }
                ]
            };
            
            const categoryRecipes = recipes[category] || [];
            
            const recipesHTML = categoryRecipes.map(recipe => {
                const canCraft = recipe.materials.every(mat => {
                    const item = gameState.inventory.materials.find(m => m.id === mat.id);
                    return item && item.count >= mat.count;
                });
                
                return `
                    <div style="margin-bottom: 20px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 32px;">${recipe.icon}</div>
                                <div>
                                    <div style="font-weight: bold; font-size: 18px;">${recipe.name}</div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary);">
                                        –®–∞–Ω—Å —É—Å–ø–µ—Ö–∞: ${recipe.successChance}%
                                    </div>
                                </div>
                            </div>
                            <button onclick="craftItem('${recipe.id}')" 
                                    style="padding: 8px 20px; background: ${canCraft ? 'var(--color-success)' : '#666'}; border: none; border-radius: 5px; color: white; cursor: ${canCraft ? 'pointer' : 'not-allowed'}; font-weight: bold;"
                                    ${canCraft ? '' : 'disabled'}>
                                –°–æ–∑–¥–∞—Ç—å
                            </button>
                        </div>
                        
                        <div style="font-size: 14px; color: var(--color-text-secondary); margin-bottom: 10px;">–¢—Ä–µ–±—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            ${recipe.materials.map(mat => {
                                const material = findItemById(mat.id);
                                const hasCount = gameState.inventory.materials.find(m => m.id === mat.id)?.count || 0;
                                const hasEnough = hasCount >= mat.count;
                                
                                return `
                                    <div style="padding: 8px 12px; background: ${hasEnough ? 'rgba(46, 204, 113, 0.2)' : 'rgba(255, 71, 87, 0.2)'}; border-radius: 5px; display: flex; align-items: center; gap: 8px;">
                                        <div style="font-size: 20px;">${material?.icon || '‚ùì'}</div>
                                        <div>
                                            <div style="font-weight: bold; font-size: 12px;">${material?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                                            <div style="font-size: 11px; color: ${hasEnough ? 'var(--color-success)' : 'var(--color-danger)'};">${hasCount}/${mat.count}</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üî® –†–µ—Ü–µ–ø—Ç—ã –∫—Ä–∞—Ñ—Ç–∞</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    ${categoryRecipes.length > 0 ? recipesHTML : `
                        <div style="text-align: center; padding: 50px; color: var(--color-text-secondary);">
                            <div style="font-size: 48px; margin-bottom: 20px;">üîç</div>
                            <div style="font-size: 18px;">–†–µ—Ü–µ–ø—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                            <div style="font-size: 14px; margin-top: 10px;">–ü–æ–≤—ã—à–∞–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã</div>
                        </div>
                    `}
                </div>
            `;
            
            showModal(modalContent);
        }

        function craftItem(recipeId) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –ª–æ–≥–∏–∫–∞ –∫—Ä–∞—Ñ—Ç–∞ –ø–æ —Ä–µ—Ü–µ–ø—Ç—É
            // –î–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç
            
            const recipe = {
                weapons: [
                    {
                        id: "craft_sword",
                        result: "weapon_beginner",
                        materials: [
                            { id: "mat_dragon_scale", count: 5 },
                            { id: "mat_fire_crystal", count: 2 }
                        ]
                    }
                ],
                armor: [
                    {
                        id: "craft_helmet",
                        result: "helmet_beginner",
                        materials: [
                            { id: "mat_dragon_scale", count: 3 },
                            { id: "mat_ice_heart", count: 1 }
                        ]
                    }
                ],
                potions: [
                    {
                        id: "craft_potion",
                        result: "potion_health_small",
                        materials: [
                            { id: "mat_dragon_scale", count: 2 }
                        ]
                    }
                ],
                special: [
                    {
                        id: "craft_key",
                        result: "item_legendary_key",
                        materials: [
                            { id: "mat_dragon_scale", count: 10 },
                            { id: "mat_fire_crystal", count: 5 },
                            { id: "mat_ice_heart", count: 3 }
                        ]
                    }
                ]
            };
            
            let foundRecipe = null;
            for (const category in recipe) {
                foundRecipe = recipe[category].find(r => r.id === recipeId);
                if (foundRecipe) break;
            }
            
            if (!foundRecipe) {
                showNotification("–†–µ—Ü–µ–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
            const hasMaterials = foundRecipe.materials.every(mat => {
                const item = gameState.inventory.materials.find(m => m.id === mat.id);
                return item && item.count >= mat.count;
            });
            
            if (!hasMaterials) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞!");
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã
            foundRecipe.materials.forEach(mat => {
                removeItemFromInventory(mat.id, 'materials', mat.count);
            });
            
            // –®–∞–Ω—Å —É—Å–ø–µ—Ö–∞
            const successChance = 80; // –±–∞–∑–æ–≤—ã–π —à–∞–Ω—Å
            const isSuccess = Math.random() * 100 < successChance;
            
            if (isSuccess) {
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç
                const item = findItemById(foundRecipe.result);
                if (item) {
                    addItemToInventory(item);
                    showNotification(`–ö—Ä–∞—Ñ—Ç —É—Å–ø–µ—à–µ–Ω! –°–æ–∑–¥–∞–Ω –ø—Ä–µ–¥–º–µ—Ç: ${item.name}`, 4000);
                    addLog(`üî® –ö—Ä–∞—Ñ—Ç —É—Å–ø–µ—à–µ–Ω! –°–æ–∑–¥–∞–Ω –ø—Ä–µ–¥–º–µ—Ç: ${item.name}`, "loot");
                }
            } else {
                showNotification("–ö—Ä–∞—Ñ—Ç –Ω–µ —É–¥–∞–ª—Å—è! –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ—Ç–µ—Ä—è–Ω—ã.", 3000);
                addLog(`üí• –ö—Ä–∞—Ñ—Ç –Ω–µ —É–¥–∞–ª—Å—è! –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ—Ç–µ—Ä—è–Ω—ã.`, "damage");
            }
            
            closeModal();
            updateUI();
            updateInventory('materials');
        }

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function updateUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
            document.getElementById('gold').textContent = gameState.gold.toLocaleString();
            document.getElementById('essence').textContent = gameState.essence.toLocaleString();
            document.getElementById('crystals').textContent = gameState.crystals.toLocaleString();
            document.getElementById('energy').textContent = `${gameState.energy}/${gameState.maxEnergy}`;
            document.getElementById('xp').textContent = `${gameState.xp}/${gameState.xpToNextLevel}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –∏ —É—Ä–æ–≤–µ–Ω—å –¥—Ä–∞–∫–æ–Ω–∞
            document.getElementById('dragonName').textContent = gameState.dragonName;
            document.getElementById('dragonLevel').textContent = gameState.level;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            updateStats();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É
            updateEquipmentDisplay();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –¥—Ä–∞–∫–æ–Ω–∞
            updateDragonIcon();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —ç–≤–æ–ª—é—Ü–∏–∏
            document.getElementById('evolutionBtn').disabled = gameState.xp < gameState.xpToNextLevel;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ö–æ—Ç—ã
            document.getElementById('huntBtn').disabled = gameState.energy < 10;
        }

        function updateEquipmentDisplay() {
            const slots = ['head', 'chest', 'legs', 'weapon', 'wings', 'amulet'];
            slots.forEach(slot => {
                const item = gameState.equipment[slot];
                const element = document.getElementById(`equip${slot.charAt(0).toUpperCase() + slot.slice(1)}`);
                if (element) {
                    element.textContent = item ? item.name : '-';
                }
            });
        }

        function updateDragonIcon() {
            const icon = document.getElementById('dragonIcon');
            let newIcon = 'üêâ';
            
            if (gameState.evolutionStage >= 4) newIcon = 'üê≤‚ú®';
            else if (gameState.evolutionStage >= 3) newIcon = 'üê≤üî•';
            else if (gameState.evolutionStage >= 2) newIcon = 'üê≤';
            
            icon.textContent = newIcon;
        }

        function checkLevelUp() {
            while (gameState.xp >= gameState.xpToNextLevel) {
                gameState.xp -= gameState.xpToNextLevel;
                gameState.level++;
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –æ–ø—ã—Ç
                gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
                
                // –£–ª—É—á—à–∞–µ–º –±–∞–∑–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
                gameState.baseStats.attack += 10;
                gameState.baseStats.defense += 5;
                gameState.baseStats.maxHealth += 50;
                gameState.baseStats.health = gameState.baseStats.maxHealth;
                gameState.baseStats.speed += 5;
                gameState.baseStats.critical += 1;
                gameState.baseStats.dodge += 0.5;
                
                // –î–∞–µ–º –æ—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤
                gameState.skillPoints += 3;
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é
                gameState.maxEnergy += 5;
                gameState.energy = gameState.maxEnergy;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showLevelUpNotification();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                checkAchievements();
            }
            
            updateUI();
        }

        function showLevelUpNotification() {
            showNotification(`üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! –¢–µ–ø–µ—Ä—å –≤—ã —É—Ä–æ–≤–µ–Ω—å ${gameState.level}!`, 3000);
            addLog(`üåü –î–æ—Å—Ç–∏–≥–Ω—É—Ç —É—Ä–æ–≤–µ–Ω—å ${gameState.level}! –ü–æ–ª—É—á–µ–Ω–æ +3 –æ—á–∫–∞ –Ω–∞–≤—ã–∫–æ–≤.`, "loot");
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø –¥–ª—è —É—Ä–æ–≤–Ω–µ–π –∫—Ä–∞—Ç–Ω—ã—Ö 10
            if (gameState.level % 10 === 0) {
                const achievementPopup = document.getElementById('achievementPopup');
                achievementPopup.innerHTML = `
                    <div style="font-size: 60px; margin-bottom: 15px;">üèÜ</div>
                    <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ!</div>
                    <div style="font-size: 18px; margin-bottom: 5px;">–ú–∞—Å—Ç–µ—Ä —É—Ä–æ–≤–Ω—è ${gameState.level}</div>
                    <div style="color: #666; margin-bottom: 20px;">–î–æ—Å—Ç–∏–≥–Ω—É—Ç —É—Ä–æ–≤–µ–Ω—å ${gameState.level}!</div>
                    <div style="color: #ffd700; font-weight: bold;">–ù–∞–≥—Ä–∞–¥–∞: ${gameState.level * 100} –∑–æ–ª–æ—Ç–∞!</div>
                `;
                
                gameState.gold += gameState.level * 100;
                
                achievementPopup.style.display = 'block';
                setTimeout(() => {
                    achievementPopup.style.display = 'none';
                }, 5000);
            }
        }

        function checkAchievements() {
            ACHIEVEMENTS.forEach(achievement => {
                if (!gameState.achievements.includes(achievement.id) && 
                    achievement.condition(gameState)) {
                    
                    gameState.achievements.push(achievement.id);
                    
                    // –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
                    if (achievement.reward.gold) gameState.gold += achievement.reward.gold;
                    if (achievement.reward.essence) gameState.essence += achievement.reward.essence;
                    if (achievement.reward.crystals) gameState.crystals += achievement.reward.crystals;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø
                    const achievementPopup = document.getElementById('achievementPopup');
                    achievementPopup.innerHTML = `
                        <div style="font-size: 60px; margin-bottom: 15px;">${achievement.icon}</div>
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ!</div>
                        <div style="font-size: 18px; margin-bottom: 5px;">${achievement.name}</div>
                        <div style="color: #666; margin-bottom: 20px;">${achievement.description}</div>
                        <div style="color: #ffd700; font-weight: bold;">–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!</div>
                    `;
                    
                    achievementPopup.style.display = 'block';
                    setTimeout(() => {
                        achievementPopup.style.display = 'none';
                    }, 5000);
                    
                    addLog(`üèÜ –ü–æ–ª—É—á–µ–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: "${achievement.name}"!`, "loot");
                }
            });
        }

        function findItemById(itemId) {
            // –ò—â–µ–º –ø—Ä–µ–¥–º–µ—Ç –≤–æ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö
            for (const category in ITEM_DATABASE) {
                const item = ITEM_DATABASE[category].find(i => i.id === itemId);
                if (item) return item;
            }
            return null;
        }

        function addItemToInventory(item) {
            const categoryMap = {
                'helmet': 'armor',
                'chest': 'armor', 
                'legs': 'armor',
                'weapon': 'weapons',
                'wings': 'wings',
                'amulet': 'amulet',
                'potion': 'potions',
                'mat_': 'materials',
                'item_': 'special'
            };
            
            let category = 'special'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            
            for (const prefix in categoryMap) {
                if (item.id.startsWith(prefix)) {
                    category = categoryMap[prefix];
                    break;
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É, –ø—Ä–æ–±—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö
            if (category === 'special') {
                if (ITEM_DATABASE.armor?.some(i => i.id === item.id)) category = 'armor';
                else if (ITEM_DATABASE.weapons?.some(i => i.id === item.id)) category = 'weapons';
                else if (ITEM_DATABASE.wings?.some(i => i.id === item.id)) category = 'wings';
                else if (ITEM_DATABASE.amulet?.some(i => i.id === item.id)) category = 'amulet';
                else if (ITEM_DATABASE.potions?.some(i => i.id === item.id)) category = 'potions';
                else if (ITEM_DATABASE.materials?.some(i => i.id === item.id)) category = 'materials';
                else if (ITEM_DATABASE.special?.some(i => i.id === item.id)) category = 'special';
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            const existingItem = gameState.inventory[category]?.find(i => i.id === item.id);
            if (existingItem) {
                existingItem.count = (existingItem.count || 1) + 1;
            } else {
                gameState.inventory[category].push({
                    id: item.id,
                    count: 1
                });
            }
        }

        function removeItemFromInventory(itemId, category, count = 1) {
            const itemIndex = gameState.inventory[category]?.findIndex(i => i.id === itemId);
            if (itemIndex === -1) return false;
            
            const item = gameState.inventory[category][itemIndex];
            
            if (item.count > count) {
                item.count -= count;
            } else {
                gameState.inventory[category].splice(itemIndex, 1);
            }
            
            return true;
        }

        function addLog(message, type = "info") {
            const log = document.getElementById('battleLog');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = message;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function showNotification(message, duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }

        function showModal(content) {
            const overlay = document.getElementById('modalOverlay');
            overlay.innerHTML = content;
            overlay.style.display = 'flex';
        }

        function closeModal() {
            const overlay = document.getElementById('modalOverlay');
            overlay.style.display = 'none';
            currentDialogue = null;
        }

        function getRarityColor(rarity) {
            const colors = {
                common: '#a9b7c6',
                uncommon: '#2ed573',
                rare: '#3742fa',
                epic: '#9b59b6',
                legendary: '#f1c40f',
                mythical: '#e74c3c',
                divine: '#00cec9'
            };
            return colors[rarity] || '#a9b7c6';
        }

        function getRarityName(rarity) {
            const names = {
                common: '–û–±—ã—á–Ω—ã–π',
                uncommon: '–ù–µ–æ–±—ã—á–Ω—ã–π',
                rare: '–†–µ–¥–∫–∏–π',
                epic: '–≠–ø–∏—á–µ—Å–∫–∏–π',
                legendary: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π',
                mythical: '–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π',
                divine: '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π'
            };
            return names[rarity] || '–û–±—ã—á–Ω—ã–π';
        }

        function getStatDisplayName(stat) {
            const names = {
                attack: '–ê—Ç–∞–∫–∞',
                defense: '–ó–∞—â–∏—Ç–∞',
                health: '–ó–¥–æ—Ä–æ–≤—å–µ',
                speed: '–°–∫–æ—Ä–æ—Å—Ç—å',
                critical: '–ö—Ä–∏—Ç. —à–∞–Ω—Å',
                dodge: '–£–∫–ª–æ–Ω–µ–Ω–∏–µ',
                armor: '–ë—Ä–æ–Ω—è',
                fireDamage: '–û–≥–Ω–µ–Ω–Ω—ã–π —É—Ä–æ–Ω',
                iceDamage: '–õ–µ–¥—è–Ω–æ–π —É—Ä–æ–Ω',
                poisonDamage: '–Ø–¥–æ–≤–∏—Ç—ã–π —É—Ä–æ–Ω',
                lightningDamage: '–£—Ä–æ–Ω –º–æ–ª–Ω–∏–µ–π',
                allResist: '–í—Å–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è',
                armorPen: '–ü—Ä–æ–±–∏–≤–∞–Ω–∏–µ –±—Ä–æ–Ω–∏',
                allDamage: '–í–µ—Å—å —É—Ä–æ–Ω',
                allStats: '–í—Å–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏',
                healthRegen: '–†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–¥–æ—Ä–æ–≤—å—è'
            };
            return names[stat] || stat;
        }

        function getEffectDescription(effect) {
            const descriptions = [];
            
            for (const [key, value] of Object.entries(effect)) {
                if (key === 'health') descriptions.push(`–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ${value} –∑–¥–æ—Ä–æ–≤—å—è`);
                else if (key === 'energy') descriptions.push(`–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ${value} —ç–Ω–µ—Ä–≥–∏–∏`);
                else if (key === 'attack') descriptions.push(`–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∞—Ç–∞–∫—É –Ω–∞ ${value} –Ω–∞ 5 –º–∏–Ω—É—Ç`);
                else if (key === 'defense') descriptions.push(`–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –Ω–∞ ${value} –Ω–∞ 5 –º–∏–Ω—É—Ç`);
                else if (key === 'speed') descriptions.push(`–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ ${value} –Ω–∞ 3 –º–∏–Ω—É—Ç—ã`);
                else if (key === 'critical') descriptions.push(`–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ –Ω–∞ ${value}% –Ω–∞ 4 –º–∏–Ω—É—Ç—ã`);
                else if (key === 'allStats') descriptions.push(`–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Å–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–∞ ${value} –Ω–∞ 10 –º–∏–Ω—É—Ç`);
                else if (key === 'duration') continue;
                else descriptions.push(`${key}: ${value}`);
            }
            
            return descriptions.join(', ');
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –ù–ê–°–¢–†–û–ï–ö ====================
        function showSettings() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <div style="margin-bottom: 20px;">
                            <div style="color: var(--color-primary); margin-bottom: 5px;">–ì—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏</div>
                            <input type="range" min="0" max="100" value="${gameState.settings.musicVolume}" 
                                   onchange="updateSetting('musicVolume', this.value)" style="width: 100%;">
                            <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 5px;">
                                ${gameState.settings.musicVolume}%
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <div style="color: var(--color-primary); margin-bottom: 5px;">–ì—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–æ–≤</div>
                            <input type="range" min="0" max="100" value="${gameState.settings.soundVolume}" 
                                   onchange="updateSetting('soundVolume', this.value)" style="width: 100%;">
                            <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 5px;">
                                ${gameState.settings.soundVolume}%
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" ${gameState.settings.showAnimations ? 'checked' : ''} 
                                       onchange="updateSetting('showAnimations', this.checked)">
                                <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏</span>
                            </label>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" ${gameState.settings.notifications ? 'checked' : ''} 
                                       onchange="updateSetting('notifications', this.checked)">
                                <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö</span>
                            </label>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" ${gameState.settings.autoSave ? 'checked' : ''} 
                                       onchange="updateSetting('autoSave', this.checked)">
                                <span>–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)</span>
                            </label>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button onclick="saveGame()" 
                                style="flex: 1; padding: 12px; background: linear-gradient(45deg, var(--color-success), #1dd1a1); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
                        </button>
                        
                        <button onclick="exportSave()" 
                                style="flex: 1; padding: 12px; background: linear-gradient(45deg, var(--color-info), #5352ed); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                            –≠–∫—Å–ø–æ—Ä—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                        </button>
                        
                        <button onclick="confirmReset()" 
                                style="flex: 1; padding: 12px; background: linear-gradient(45deg, var(--color-danger), #ff6b81); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                            –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É
                        </button>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function updateSetting(key, value) {
            gameState.settings[key] = value;
        }

        function saveGame() {
            try {
                gameState.lastSave = Date.now();
                localStorage.setItem('dragonEvolutionSave', JSON.stringify(gameState));
                showNotification("–ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!", 2000);
            } catch (error) {
                showNotification("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: " + error.message, 3000);
            }
        }

        function exportSave() {
            try {
                const saveData = JSON.stringify(gameState);
                const blob = new Blob([saveData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `dragon_evolution_save_${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ —Ñ–∞–π–ª!", 2000);
            } catch (error) {
                showNotification("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: " + error.message, 3000);
            }
        }

        function confirmReset() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω!")) {
                localStorage.removeItem('dragonEvolutionSave');
                location.reload();
            }
        }

        function showAchievements() {
            const achievementsHTML = ACHIEVEMENTS.map(achievement => {
                const isEarned = gameState.achievements.includes(achievement.id);
                
                return `
                    <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; border-left: 4px solid ${isEarned ? 'var(--color-success)' : '#666'};">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 32px;">${achievement.icon}</div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold; color: ${isEarned ? 'var(--color-primary)' : '#666'};">
                                    ${achievement.name}
                                </div>
                                <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 5px;">
                                    ${achievement.description}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: ${isEarned ? '#ffd700' : '#666'}; font-weight: bold;">
                                    ${isEarned ? 
                                        `+${achievement.reward.gold || 0}üí∞ ${achievement.reward.essence ? `+${achievement.reward.essence}‚ú®` : ''}` : 
                                        '–ù–µ –ø–æ–ª—É—á–µ–Ω–æ'
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; text-align: center;">
                        <div style="font-size: 18px; color: var(--color-text-secondary);">
                            –ü–æ–ª—É—á–µ–Ω–æ: ${gameState.achievements.length}/${ACHIEVEMENTS.length}
                        </div>
                    </div>
                    
                    ${achievementsHTML}
                </div>
            `;
            
            showModal(modalContent);
        }

        function showHowToPlay() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">‚ùì –û–±—É—á–µ–Ω–∏–µ</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; line-height: 1.6;">
                        <h3 style="color: var(--color-primary); margin-bottom: 15px;">–û—Å–Ω–æ–≤—ã –∏–≥—Ä—ã:</h3>
                        <p><strong>1. –û—Ö–æ—Ç–∞</strong> - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –æ–ø—ã—Ç–∞. –¢—Ä–∞—Ç–∏—Ç 10 —ç–Ω–µ—Ä–≥–∏–∏.</p>
                        <p><strong>2. –°—É–Ω–¥—É–∫–∏</strong> - —Å–æ–¥–µ—Ä–∂–∞—Ç —Ü–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏ —Ä–µ—Å—É—Ä—Å—ã. –ö—É–ø–∏—Ç–µ –∏—Ö –≤ –º–∞–≥–∞–∑–∏–Ω–µ —Å—É–Ω–¥—É–∫–æ–≤.</p>
                        <p><strong>3. –ë–∏—Ç–≤—ã</strong> - —Å—Ä–∞–∂–µ–Ω–∏—è —Å –≤—Ä–∞–≥–∞–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏ PvP.</p>
                        <p><strong>4. –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</strong> - —É–ª—É—á—à–∞–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤–∞—à–µ–≥–æ –¥—Ä–∞–∫–æ–Ω–∞. –ù–∞–¥–µ–≤–∞–π—Ç–µ –ª—É—á—à–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã.</p>
                        <p><strong>5. –ó–∞–¥–∞–Ω–∏—è</strong> - –¥–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.</p>
                        
                        <h3 style="color: var(--color-primary); margin: 25px 0 15px 0;">–û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã:</h3>
                        <p>‚Ä¢ <strong>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</strong> - —É–ª—É—á—à–∞–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∑–∞ —ç–Ω–µ—Ä–≥–∏—é –∏ –≤—Ä–µ–º—è</p>
                        <p>‚Ä¢ <strong>–ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ</strong> - —É–ª—É—á—à–∞–µ—Ç –ø—Ä–µ–¥–º–µ—Ç—ã —Å –ø–æ–º–æ—â—å—é —ç—Å—Å–µ–Ω—Ü–∏–∏</p>
                        <p>‚Ä¢ <strong>–≠–≤–æ–ª—é—Ü–∏—è</strong> - –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç –¥—Ä–∞–∫–æ–Ω–∞ –∑–∞ —Ä–µ—Å—É—Ä—Å—ã</p>
                        <p>‚Ä¢ <strong>–ü–æ–¥–∑–µ–º–µ–ª—å—è</strong> - –º–Ω–æ–≥–æ—ç—Ç–∞–∂–Ω—ã–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è —Å –±–æ—Å—Å–∞–º–∏</p>
                        <p>‚Ä¢ <strong>–ö–ª–∞–Ω</strong> - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤</p>
                        <p>‚Ä¢ <strong>–†—ã–Ω–æ–∫</strong> - –ø–æ–∫—É–ø–∫–∞ –∏ –ø—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</p>
                        <p>‚Ä¢ <strong>PvP –ê—Ä–µ–Ω–∞</strong> - —Å—Ä–∞–∂–µ–Ω–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏</p>
                        <p>‚Ä¢ <strong>–ö—Ä–∞—Ñ—Ç</strong> - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</p>
                        
                        <h3 style="color: var(--color-primary); margin: 25px 0 15px 0;">–°–æ–≤–µ—Ç—ã –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤:</h3>
                        <p>‚Ä¢ –ù–∞—á–Ω–∏—Ç–µ —Å –æ—Ö–æ—Ç—ã, —á—Ç–æ–±—ã –Ω–∞–±—Ä–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã</p>
                        <p>‚Ä¢ –û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —Å—É–Ω–¥—É–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏</p>
                        <p>‚Ä¢ –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
                        <p>‚Ä¢ –≠–∫–∏–ø–∏—Ä—É–π—Ç–µ –ª—É—á—à–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è</p>
                        <p>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–µ–ª—å—è –≤ —Å–ª–æ–∂–Ω—ã—Ö –±–∏—Ç–≤–∞—Ö</p>
                        <p>‚Ä¢ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –∫–ª–∞–Ω—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤</p>
                        <p>‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∏–≥—Ä—É</p>
                        
                        <div style="margin-top: 30px; padding: 20px; background: rgba(255, 138, 0, 0.1); border-radius: 10px; border-left: 4px solid var(--color-primary);">
                            <div style="color: var(--color-primary); font-weight: bold; margin-bottom: 10px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:</div>
                            <div>
                                <strong>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:</strong> Agafonov<br>
                                <strong>–í–µ—Ä—Å–∏—è –∏–≥—Ä—ã:</strong> ${GAME_VERSION}<br>
                                <strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</strong> –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è RPG —Å —Å—é–∂–µ—Ç–æ–º, –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Å–∏—Å—Ç–µ–º –∏ –º–µ—Ö–∞–Ω–∏–∫<br>
                                <strong>–ò–≥—Ä–æ–≤–æ–π –¥–≤–∏–∂–æ–∫:</strong> Dragon Engine Pro
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function showCredits() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üêâ</div>
                        <div style="font-size: 28px; color: var(--color-primary); font-weight: bold; margin-bottom: 10px;">
                            Dragon Evolution: Legacy of Agafonov
                        </div>
                        <div style="font-size: 18px; color: var(--color-text-secondary);">
                            –í–µ—Ä—Å–∏—è ${GAME_VERSION}
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <div style="color: var(--color-primary); font-size: 22px; margin-bottom: 15px; text-align: center;">
                            –ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üëë</div>
                                <div style="font-weight: bold; margin-bottom: 5px;">–û—Å–Ω–æ–≤–∞—Ç–µ–ª—å</div>
                                <div style="color: var(--color-primary); font-weight: bold;">AGAFONOV</div>
                            </div>
                            
                            <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üé®</div>
                                <div style="font-weight: bold; margin-bottom: 5px;">–î–∏–∑–∞–π–Ω</div>
                                <div>Dragon Art Team</div>
                            </div>
                            
                            <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">‚öôÔ∏è</div>
                                <div style="font-weight: bold; margin-bottom: 5px;">–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                                <div>Code Dragons</div>
                            </div>
                            
                            <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üéµ</div>
                                <div style="font-weight: bold; margin-bottom: 5px;">–ó–≤—É–∫ –∏ –º—É–∑—ã–∫–∞</div>
                                <div>Sound Wizards</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center;">
                        <div style="font-size: 14px; color: var(--color-text-secondary); line-height: 1.6;">
                            –ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π.<br>
                            –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã ¬© ${new Date().getFullYear()} Agafonov Studio.<br>
                            –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É!
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function openEquipmentMenu(slot) {
            const equippedItem = gameState.equipment[slot];
            const category = getCategoryBySlot(slot);
            
            if (!category) {
                showNotification("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–ª–æ—Ç —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏!");
                return;
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª–æ—Ç–∞
            let availableItems = [];
            
            if (category === 'armor') {
                // –î–ª—è –±—Ä–æ–Ω–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ —Ç–∏–ø—É
                availableItems = gameState.inventory.armor.map(itemData => {
                    const item = findItemById(itemData.id);
                    if (!item) return null;
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –±—Ä–æ–Ω–∏ –ø–æ ID
                    let itemType = '';
                    if (item.id.includes('helmet')) itemType = 'head';
                    else if (item.id.includes('chest')) itemType = 'chest';
                    else if (item.id.includes('legs')) itemType = 'legs';
                    else itemType = 'chest';
                    
                    return itemType === slot ? { ...item, count: itemData.count } : null;
                }).filter(item => item !== null);
                
            } else if (category === 'weapons') {
                availableItems = gameState.inventory.weapons.map(itemData => {
                    const item = findItemById(itemData.id);
                    return item ? { ...item, count: itemData.count } : null;
                }).filter(item => item !== null);
                
            } else if (category === 'wings') {
                availableItems = gameState.inventory.wings.map(itemData => {
                    const item = findItemById(itemData.id);
                    return item ? { ...item, count: itemData.count } : null;
                }).filter(item => item !== null);
                
            } else if (category === 'amulet') {
                availableItems = gameState.inventory.amulet.map(itemData => {
                    const item = findItemById(itemData.id);
                    return item ? { ...item, count: itemData.count } : null;
                }).filter(item => item !== null);
            }
            
            // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ ID
            const groupedItems = {};
            availableItems.forEach(item => {
                if (!groupedItems[item.id]) {
                    groupedItems[item.id] = { ...item, count: 0 };
                }
                groupedItems[item.id].count += item.count || 1;
            });
            
            const itemsList = Object.values(groupedItems);
            
            let itemsHTML = "";
            if (itemsList.length > 0) {
                itemsHTML = itemsList.map(item => `
                    <div style="margin-bottom: 10px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: space-between; cursor: pointer;" 
                         onclick="equipItem('${item.id}', '${category}')">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 24px;">${item.icon}</div>
                            <div>
                                <div style="font-weight: bold; color: ${getRarityColor(item.rarity)};">${item.name}</div>
                                <div style="font-size: 12px; color: var(--color-text-secondary);">
                                    –£—Ä–æ–≤–µ–Ω—å ${item.level || 1} | ${getRarityName(item.rarity)}
                                </div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            ${item.count > 1 ? `<div style="font-size: 12px; color: var(--color-text-secondary);">${item.count} —à—Ç.</div>` : ''}
                        </div>
                    </div>
                `).join('');
            } else {
                itemsHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--color-text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 20px;">üì¶</div>
                        <div style="font-size: 18px;">–ù–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª–æ—Ç–∞</div>
                        <div style="font-size: 14px; margin-top: 10px;">–°–æ–±–∏—Ä–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –æ—Ö–æ—Ç–µ –∏ —Å—É–Ω–¥—É–∫–∞—Ö</div>
                    </div>
                `;
            }
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">${getSlotName(slot)}</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    ${equippedItem ? `
                        <div style="margin-bottom: 20px; padding: 15px; background: rgba(255, 138, 0, 0.1); border-radius: 10px; border-left: 4px solid var(--color-primary);">
                            <div style="color: var(--color-primary); font-weight: bold; margin-bottom: 10px;">–ù–∞–¥–µ—Ç–æ:</div>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 32px;">${equippedItem.icon}</div>
                                <div>
                                    <div style="font-weight: bold; color: ${getRarityColor(equippedItem.rarity)};">${equippedItem.name}</div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary);">
                                        ${getRarityName(equippedItem.rarity)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div style="margin: 20px 0;">
                        <div style="color: var(--color-primary); margin-bottom: 15px;">–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã:</div>
                        ${itemsHTML}
                    </div>
                    
                    ${equippedItem ? `
                        <button onclick="unequipItem('${slot}')" 
                                style="width: 100%; padding: 12px; background: linear-gradient(45deg, var(--color-danger), #ff6b81); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">
                            –°–Ω—è—Ç—å –ø—Ä–µ–¥–º–µ—Ç
                        </button>
                    ` : ''}
                </div>
            `;
            
            showModal(modalContent);
        }

        function getCategoryBySlot(slot) {
            switch(slot) {
                case 'head':
                case 'chest':
                case 'legs':
                    return 'armor';
                case 'weapon':
                    return 'weapons';
                case 'wings':
                    return 'wings';
                case 'amulet':
                    return 'amulet';
                default:
                    return null;
            }
        }

        function getSlotName(slot) {
            const names = {
                head: '–®–ª–µ–º',
                chest: '–ù–∞–≥—Ä—É–¥–Ω–∏–∫',
                legs: '–ü–æ–Ω–æ–∂–∏',
                weapon: '–û—Ä—É–∂–∏–µ',
                wings: '–ö—Ä—ã–ª—å—è',
                amulet: '–ê–º—É–ª–µ—Ç'
            };
            return names[slot] || slot;
        }

        function unequipItem(slot) {
            const item = gameState.equipment[slot];
            if (!item) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            addItemToInventory(item);
            
            // –°–Ω–∏–º–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç
            gameState.equipment[slot] = null;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–æ–Ω—É—Å—ã
            updateEquipmentBonuses();
            
            showNotification(`–ü—Ä–µ–¥–º–µ—Ç "${item.name}" —Å–Ω—è—Ç.`);
            closeModal();
            updateUI();
        }

        // ==================== –ó–ê–ü–£–°–ö –ò–ì–†–´ ====================
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = simulateLoading;
        
        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ HTML
        window.startGame = startGame;
        window.loadGame = loadGame;
        window.showSettings = showSettings;
        window.showAchievements = showAchievements;
        window.showHowToPlay = showHowToPlay;
        window.showCredits = showCredits;
        window.startHunt = startHunt;
        window.showChests = showChests;
        window.showDungeon = showDungeon;
        window.showTraining = showTraining;
        window.showEnchant = showEnchant;
        window.showEvolution = showEvolution;
        window.showQuests = showQuests;
        window.showBosses = showBosses;
        window.showClan = showClan;
        window.showMarket = showMarket;
        window.showPvP = showPvP;
        window.showCrafting = showCrafting;
        window.switchInventoryTab = switchInventoryTab;
        window.showItemDetails = showItemDetails;
        window.equipItem = equipItem;
        window.sellItem = sellItem;
        window.usePotion = usePotion;
        window.openChest = openChest;
        window.closeModal = closeModal;
        window.openEquipmentMenu = openEquipmentMenu;
        window.unequipItem = unequipItem;
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Evolution: –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä Edition</title>
    <style>
        /* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-primary: #ff8a00;
            --color-secondary: #e52e71;
            --color-success: #00b894;
            --color-danger: #ff4757;
            --color-warning: #ffa502;
            --color-info: #3742fa;
            --color-dark: #1a1a2e;
            --color-darker: #16213e;
            --color-darkest: #0f3460;
            --color-text: #ffffff;
            --color-text-secondary: #a9b7c6;
            --color-christmas-red: #e74c3c;
            --color-christmas-green: #2ecc71;
            --color-christmas-gold: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: var(--color-text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* –°–ù–ï–ì–û–ü–ê–î */
        .snowflakes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }

        /* –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--color-darkest), var(--color-darker), var(--color-dark));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s;
        }

        .loading-dragon {
            font-size: 120px;
            margin-bottom: 30px;
            animation: dragonFloat 3s infinite ease-in-out;
            filter: drop-shadow(0 0 20px rgba(255, 100, 0, 0.7));
        }

        .loading-bar {
            width: 400px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--color-christmas-red), var(--color-christmas-green));
            width: 0%;
            transition: width 0.3s;
            box-shadow: 0 0 10px rgba(255, 138, 0, 0.7);
        }

        .loading-text {
            font-size: 20px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            color: var(--color-text-secondary);
        }

        /* –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ */
        .main-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, var(--color-dark) 0%, var(--color-darker) 50%, var(--color-darkest) 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .game-title {
            font-size: 72px;
            background: linear-gradient(45deg, var(--color-christmas-red), var(--color-christmas-green), var(--color-christmas-gold));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(231, 76, 60, 0.5);
            font-family: 'Cinzel', serif;
            letter-spacing: 3px;
        }

        .game-subtitle {
            font-size: 20px;
            color: var(--color-text-secondary);
            margin-bottom: 50px;
            font-style: italic;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 300px;
        }

        .menu-btn {
            padding: 18px 30px;
            font-size: 22px;
            background: linear-gradient(45deg, rgba(231, 76, 60, 0.8), rgba(46, 204, 113, 0.8));
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: bold;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .menu-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
            background: linear-gradient(45deg, rgba(231, 76, 60, 1), rgba(46, 204, 113, 1));
        }

        .credits {
            position: absolute;
            bottom: 30px;
            color: #666;
            font-size: 16px;
            text-align: center;
        }

        .creator {
            color: var(--color-christmas-red);
            font-weight: bold;
            font-size: 18px;
            margin-top: 5px;
        }

        /* –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ */
        .admin-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 9998;
        }

        .admin-btn {
            padding: 10px 20px;
            background: linear-gradient(45deg, var(--color-danger), #c0392b);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
        }

        .admin-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 20px;
            border: 3px solid var(--color-danger);
            z-index: 10001;
            display: none;
            min-width: 500px;
            max-width: 800px;
        }

        .admin-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .admin-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--color-danger);
            border-radius: 5px;
            color: white;
        }

        .admin-resource {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        /* –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        .game-container {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(25, 25, 35, 0.95);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 20px;
            border: 2px solid var(--color-christmas-red);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .player-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .resource-icon {
            font-size: 20px;
        }

        .resource-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--color-christmas-gold);
            min-width: 60px;
            text-align: right;
        }

        .dragon-name {
            font-size: 24px;
            color: var(--color-christmas-red);
            font-weight: bold;
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 20px;
            min-height: 700px;
        }

        /* –ü–ê–ù–ï–õ–¨ –ü–†–û–§–ò–õ–Ø */
        .profile-panel {
            background: rgba(25, 25, 35, 0.95);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid var(--color-christmas-green);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--color-christmas-red), var(--color-christmas-green));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 3px solid var(--color-christmas-gold);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 24px;
            font-weight: bold;
            color: var(--color-christmas-red);
        }

        .profile-rank {
            display: inline-block;
            padding: 5px 15px;
            background: linear-gradient(45deg, var(--color-christmas-gold), #d35400);
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-top: 5px;
        }

        /* –¢–û–ü –ò–ì–†–û–ö–û–í */
        .leaderboard-panel {
            background: rgba(25, 25, 35, 0.95);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid var(--color-christmas-gold);
            margin-top: 20px;
        }

        .leaderboard-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 4px solid;
        }

        .leaderboard-rank {
            width: 30px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            margin-right: 15px;
        }

        .rank-1 { color: #ffd700; border-left-color: #ffd700; }
        .rank-2 { color: #c0c0c0; border-left-color: #c0c0c0; }
        .rank-3 { color: #cd7f32; border-left-color: #cd7f32; }

        /* –ù–û–í–û–ì–û–î–ù–ò–ô –ò–í–ï–ù–¢ */
        .event-panel {
            background: linear-gradient(45deg, rgba(231, 76, 60, 0.1), rgba(46, 204, 113, 0.1));
            border: 3px dashed var(--color-christmas-green);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .event-title {
            color: var(--color-christmas-red);
            font-size: 24px;
            margin-bottom: 15px;
            text-align: center;
        }

        .event-timer {
            font-size: 18px;
            color: var(--color-christmas-gold);
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .event-tasks {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .event-task {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--color-christmas-green);
        }

        .event-reward {
            display: inline-block;
            padding: 5px 10px;
            background: linear-gradient(45deg, var(--color-christmas-gold), #d35400);
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }

        /* –ú–£–õ–¨–¢–ò–ü–õ–ï–ï–† */
        .multiplayer-panel {
            background: rgba(25, 25, 35, 0.95);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid var(--color-info);
            margin-top: 20px;
        }

        .online-players {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .online-player {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .online-player:hover {
            border-color: var(--color-info);
            transform: translateY(-3px);
        }

        .player-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-online { background: var(--color-success); }
        .status-offline { background: var(--color-danger); }
        .status-away { background: var(--color-warning); }

        /* PvP –†–ê–ù–ì–ò */
        .pvp-ranks {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .pvp-rank {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid;
        }

        .rank-bronze { border-color: #cd7f32; }
        .rank-silver { border-color: #c0c0c0; }
        .rank-gold { border-color: #ffd700; }
        .rank-platinum { border-color: #3498db; }
        .rank-diamond { border-color: #1abc9c; }
        .rank-master { border-color: #9b59b6; }
        .rank-grandmaster { border-color: #e74c3c; }

        /* –û–°–¢–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò (–æ—Å—Ç–∞—é—Ç—Å—è –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏) */
        .panel {
            background: rgba(25, 25, 35, 0.95);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(255, 138, 0, 0.3);
        }

        .dragon-panel {
            grid-column: 1;
        }

        .action-panel {
            grid-column: 2;
        }

        .inventory-panel {
            grid-column: 3;
        }

        .section-title {
            font-size: 22px;
            color: var(--color-primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 138, 0, 0.3);
        }

        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
            
            .dragon-panel {
                grid-column: 1;
                grid-row: 1;
            }
            
            .action-panel {
                grid-column: 1;
                grid-row: 2;
            }
            
            .inventory-panel {
                grid-column: 1;
                grid-row: 3;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .pvp-ranks {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .online-players {
                grid-template-columns: 1fr;
            }
        }

        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes dragonFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes christmasLights {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .christmas-light {
            animation: christmasLights 1s infinite;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –°–ù–ï–ì–û–ü–ê–î -->
    <div class="snowflakes" id="snowflakes"></div>

    <!-- –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-dragon">üéÑüêâ</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
        <div class="loading-text" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–≥–æ —á—É–¥–∞...</div>
    </div>

    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <div class="main-menu" id="mainMenu">
        <div class="game-title">DRAGON EVOLUTION</div>
        <div class="game-subtitle">–ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ –∏–∑–¥–∞–Ω–∏–µ —Å –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–æ–º</div>
        <div class="menu-buttons">
            <button class="menu-btn" onclick="startGame()">
                <i class="fas fa-play"></i> –ù–æ–≤–∞—è –∏–≥—Ä–∞
            </button>
            <button class="menu-btn" onclick="loadGame()">
                <i class="fas fa-folder-open"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
            </button>
            <button class="menu-btn" onclick="connectMultiplayer()">
                <i class="fas fa-users"></i> –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä
            </button>
            <button class="menu-btn" onclick="showSettings()">
                <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
            <button class="menu-btn" onclick="showLeaderboard()">
                <i class="fas fa-trophy"></i> –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤
            </button>
        </div>
        <div class="credits">
            –ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 2024<br>
            <div class="creator">–û—Å–Ω–æ–≤–∞—Ç–µ–ª—å –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: AGAFONOV</div>
            –í–µ—Ä—Å–∏—è 4.0 | Dragon Evolution Multiplayer
        </div>
    </div>

    <!-- –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ -->
    <div class="admin-panel">
        <button class="admin-btn" onclick="showAdminPanel()">
            <i class="fas fa-crown"></i> –ü–∞–Ω–µ–ª—å –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—è
        </button>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° -->
    <div class="game-container" id="gameContainer">
        <div class="header">
            <div class="dragon-name" id="dragonName">–î—Ä–∞–∫–æ–Ω –ê–≥–∞—Ñ–æ–Ω–æ–≤–∞</div>
            <div class="player-info">
                <div class="resource">
                    <div class="resource-icon">üí∞</div>
                    <div class="resource-value" id="gold">1000</div>
                </div>
                <div class="resource">
                    <div class="resource-icon">‚ú®</div>
                    <div class="resource-value" id="essence">500</div>
                </div>
                <div class="resource">
                    <div class="resource-icon">üîÆ</div>
                    <div class="resource-value" id="crystals">50</div>
                </div>
                <div class="resource">
                    <div class="resource-icon">‚ö°</div>
                    <div class="resource-value" id="energy">100/100</div>
                </div>
                <div class="resource">
                    <div class="resource-icon">‚≠ê</div>
                    <div class="resource-value" id="xp">0/100</div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨: –ü–†–û–§–ò–õ–¨ –ò –°–û–¶–ò–ê–õ–¨–ù–û–ï -->
            <div class="profile-panel">
                <div class="profile-header">
                    <div class="profile-avatar" id="playerAvatar">üêâ</div>
                    <div class="profile-info">
                        <div class="profile-name" id="playerName">–î—Ä–∞–∫–æ–Ω –ê–≥–∞—Ñ–æ–Ω–æ–≤–∞</div>
                        <div class="profile-rank" id="playerRank">–ù–æ–≤–∏—á–æ–∫</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary); margin-top: 5px;">
                            –£—Ä–æ–≤–µ–Ω—å: <span id="playerLevel">1</span>
                        </div>
                    </div>
                </div>

                <!-- –ù–û–í–û–ì–û–î–ù–ò–ô –ò–í–ï–ù–¢ -->
                <div class="event-panel">
                    <div class="event-title">üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ</div>
                    <div class="event-timer" id="eventTimer">–î–æ –∫–æ–Ω—Ü–∞: 10:00:00</div>
                    <div class="event-tasks" id="eventTasks">
                        <!-- –ó–∞–¥–∞–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <!-- –û–ù–õ–ê–ô–ù –ò–ì–†–û–ö–ò -->
                <div class="multiplayer-panel">
                    <div class="section-title">
                        <i class="fas fa-users"></i> –û–Ω–ª–∞–π–Ω –∏–≥—Ä–æ–∫–∏
                        <span style="float: right; font-size: 14px; color: var(--color-success);" id="onlineCount">0</span>
                    </div>
                    <div class="online-players" id="onlinePlayers">
                        <!-- –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    <button onclick="refreshOnlinePlayers()" style="width: 100%; margin-top: 15px; padding: 10px; background: var(--color-info); border: none; border-radius: 10px; color: white; cursor: pointer;">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
                    </button>
                </div>
            </div>

            <!-- –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –ü–ê–ù–ï–õ–¨ -->
            <div class="panel action-panel">
                <div class="section-title">–î–µ–π—Å—Ç–≤–∏—è</div>
                <div class="action-buttons">
                    <button class="action-btn" onclick="startHunt()" id="huntBtn">
                        <div class="btn-icon">üéØ</div>
                        <div>–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –æ—Ö–æ—Ç–∞</div>
                        <small>(10 —ç–Ω–µ—Ä–≥–∏–∏)</small>
                    </button>
                    <button class="action-btn" onclick="showChests()">
                        <div class="btn-icon">üéÅ</div>
                        <div>–ü–æ–¥–∞—Ä–∫–∏ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞</div>
                    </button>
                    <button class="action-btn" onclick="showMultiplayerBattle()">
                        <div class="btn-icon">‚öîÔ∏è</div>
                        <div>PvP –ë–∏—Ç–≤–∞</div>
                    </button>
                    <button class="action-btn" onclick="showArena()">
                        <div class="btn-icon">üèÜ</div>
                        <div>–ê—Ä–µ–Ω–∞</div>
                    </button>
                    <button class="action-btn" onclick="showGuild()">
                        <div class="btn-icon">üè∞</div>
                        <div>–ì–∏–ª—å–¥–∏—è</div>
                    </button>
                    <button class="action-btn" onclick="showTrading()">
                        <div class="btn-icon">üîÑ</div>
                        <div>–¢–æ—Ä–≥–æ–≤–ª—è</div>
                    </button>
                    <button class="action-btn" onclick="showDungeon()">
                        <div class="btn-icon">‚ùÑÔ∏è</div>
                        <div>–õ–µ–¥—è–Ω–æ–µ –ø–æ–¥–∑–µ–º–µ–ª—å–µ</div>
                    </button>
                    <button class="action-btn" onclick="showDailyQuest()">
                        <div class="btn-icon">üìÖ</div>
                        <div>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</div>
                    </button>
                    <button class="action-btn" onclick="showAchievements()">
                        <div class="btn-icon">üèÖ</div>
                        <div>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                    </button>
                    <button class="action-btn" onclick="showCollection()">
                        <div class="btn-icon">üìö</div>
                        <div>–ö–æ–ª–ª–µ–∫—Ü–∏—è</div>
                    </button>
                    <button class="action-btn" onclick="showPetSystem()">
                        <div class="btn-icon">üêæ</div>
                        <div>–ü–∏—Ç–æ–º—Ü—ã</div>
                    </button>
                    <button class="action-btn" onclick="showMounts()">
                        <div class="btn-icon">üèá</div>
                        <div>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</div>
                    </button>
                </div>

                <!-- PvP –†–ê–ù–ì–ò -->
                <div style="margin-top: 30px;">
                    <div class="section-title">PvP –†–∞–Ω–≥–∏</div>
                    <div class="pvp-ranks">
                        <div class="pvp-rank rank-bronze">
                            <div style="font-size: 24px;">ü•â</div>
                            <div style="font-weight: bold;">–ë—Ä–æ–Ω–∑–∞</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">0-999 —Ä–µ–π—Ç–∏–Ω–≥–∞</div>
                        </div>
                        <div class="pvp-rank rank-silver">
                            <div style="font-size: 24px;">ü•à</div>
                            <div style="font-weight: bold;">–°–µ—Ä–µ–±—Ä–æ</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">1000-1999</div>
                        </div>
                        <div class="pvp-rank rank-gold">
                            <div style="font-size: 24px;">ü•á</div>
                            <div style="font-weight: bold;">–ó–æ–ª–æ—Ç–æ</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">2000-2999</div>
                        </div>
                        <div class="pvp-rank rank-platinum">
                            <div style="font-size: 24px;">üíé</div>
                            <div style="font-weight: bold;">–ü–ª–∞—Ç–∏–Ω–∞</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">3000-3999</div>
                        </div>
                        <div class="pvp-rank rank-diamond">
                            <div style="font-size: 24px;">üí†</div>
                            <div style="font-weight: bold;">–ê–ª–º–∞–∑</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">4000-4999</div>
                        </div>
                        <div class="pvp-rank rank-master">
                            <div style="font-size: 24px;">üëë</div>
                            <div style="font-weight: bold;">–ú–∞—Å—Ç–µ—Ä</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">5000+</div>
                        </div>
                    </div>
                </div>

                <div class="battle-log" id="battleLog">
                    <div class="log-entry log-info">–° –ù–æ–≤—ã–º –≥–æ–¥–æ–º! üéÑ</div>
                    <div class="log-entry log-info">–ò—Å–ø—ã—Ç–∞–π—Ç–µ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞!</div>
                </div>
            </div>

            <!-- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨: –ò–ù–í–ï–ù–¢–ê–†–¨ –ò –¢–û–ü -->
            <div class="panel inventory-panel">
                <div class="section-title">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
                <div class="inventory-tabs">
                    <button class="inventory-tab active" onclick="switchInventoryTab('armor')">–î–æ—Å–ø–µ—Ö–∏</button>
                    <button class="inventory-tab" onclick="switchInventoryTab('weapons')">–û—Ä—É–∂–∏–µ</button>
                    <button class="inventory-tab" onclick="switchInventoryTab('special')">–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ</button>
                </div>
                <div class="inventory-content" id="inventoryContent">
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <!-- –¢–û–ü –ò–ì–†–û–ö–û–í -->
                <div class="leaderboard-panel">
                    <div class="section-title">üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</div>
                    <div class="leaderboard-list" id="leaderboard">
                        <!-- –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ê–î–ú–ò–ù –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û -->
    <div class="admin-modal" id="adminModal">
        <div style="color: var(--color-danger); font-size: 24px; margin-bottom: 20px; text-align: center;">
            <i class="fas fa-crown"></i> –ü–∞–Ω–µ–ª—å –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—è
        </div>
        
        <div class="admin-section">
            <div style="margin-bottom: 10px;">–ü–∞—Ä–æ–ª—å:</div>
            <input type="password" id="adminPassword" class="admin-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" onkeypress="checkAdminPassword(event)">
            <div id="adminError" style="color: var(--color-danger); margin-top: 10px; display: none;">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!</div>
        </div>

        <div id="adminContent" style="display: none;">
            <div class="admin-section">
                <div style="color: var(--color-christmas-gold); margin-bottom: 15px;">–†–µ—Å—É—Ä—Å—ã</div>
                <div class="admin-resource">
                    <span>–ó–æ–ª–æ—Ç–æ:</span>
                    <input type="number" id="adminGold" class="admin-input" value="1000" style="width: 100px;">
                </div>
                <div class="admin-resource">
                    <span>–≠—Å—Å–µ–Ω—Ü–∏—è:</span>
                    <input type="number" id="adminEssence" class="admin-input" value="500" style="width: 100px;">
                </div>
                <div class="admin-resource">
                    <span>–ö—Ä–∏—Å—Ç–∞–ª–ª—ã:</span>
                    <input type="number" id="adminCrystals" class="admin-input" value="50" style="width: 100px;">
                </div>
            </div>

            <div class="admin-section">
                <div style="color: var(--color-christmas-gold); margin-bottom: 15px;">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</div>
                <div class="admin-resource">
                    <span>–£—Ä–æ–≤–µ–Ω—å:</span>
                    <input type="number" id="adminLevel" class="admin-input" value="1" style="width: 100px;">
                </div>
                <div class="admin-resource">
                    <span>–ê—Ç–∞–∫–∞:</span>
                    <input type="number" id="adminAttack" class="admin-input" value="150" style="width: 100px;">
                </div>
                <div class="admin-resource">
                    <span>–ó–∞—â–∏—Ç–∞:</span>
                    <input type="number" id="adminDefense" class="admin-input" value="75" style="width: 100px;">
                </div>
            </div>

            <div class="admin-section">
                <div style="color: var(--color-christmas-gold); margin-bottom: 15px;">–ü—Ä–µ–¥–º–µ—Ç—ã</div>
                <select id="adminItems" class="admin-input" style="margin-bottom: 10px;">
                    <!-- –ü—Ä–µ–¥–º–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </select>
                <button onclick="adminAddItem()" style="width: 100%; padding: 10px; background: var(--color-success); border: none; border-radius: 5px; color: white; cursor: pointer;">
                    –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç
                </button>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="adminApply()" style="flex: 1; padding: 15px; background: var(--color-success); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold;">
                    –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                </button>
                <button onclick="adminReset()" style="flex: 1; padding: 15px; background: var(--color-warning); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold;">
                    –°–±—Ä–æ—Å–∏—Ç—å
                </button>
                <button onclick="adminClose()" style="flex: 1; padding: 15px; background: var(--color-danger); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: bold;">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê (–æ—Å—Ç–∞—é—Ç—Å—è) -->
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="notification" id="notification"></div>
    <div class="achievement-popup" id="achievementPopup"></div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        const ADMIN_PASSWORD = "28122010";
        const GAME_VERSION = "4.0";
        
        // –°–∏–º—É–ª—è—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞
        let mockServer = {
            onlinePlayers: [],
            leaderboard: [],
            pvpMatches: [],
            trades: [],
            guilds: [],
            chatMessages: []
        };

        // –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã
        const CHRISTMAS_ITEMS = [
            { id: "santa_hat", name: "–®–∞–ø–∫–∞ –°–∞–Ω—Ç—ã", rarity: "epic", icon: "üéÖ", stats: { defense: 50, health: 200 }, price: 1000 },
            { id: "christmas_star", name: "–†–æ–∂–¥–µ—Å—Ç–≤–µ–Ω—Å–∫–∞—è –∑–≤–µ–∑–¥–∞", rarity: "legendary", icon: "‚≠ê", stats: { allStats: 15 }, price: 5000 },
            { id: "snowflake", name: "–°–Ω–µ–∂–∏–Ω–∫–∞ —É–¥–∞—á–∏", rarity: "rare", icon: "‚ùÑÔ∏è", stats: { dodge: 20, speed: 30 }, price: 1500 },
            { id: "gift_box", name: "–ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞", rarity: "uncommon", icon: "üéÅ", stats: { gold: 500 }, price: 500 },
            { id: "candy_cane", name: "–ö–∞—Ä–∞–º–µ–ª—å–Ω–∞—è —Ç—Ä–æ—Å—Ç—å", rarity: "rare", icon: "üç¨", stats: { health: 300 }, price: 800 },
            { id: "reindeer", name: "–û–ª–µ–Ω—å-–µ–¥–∏–Ω–æ—Ä–æ–≥", rarity: "mythical", icon: "ü¶å", stats: { speed: 100, allDamage: 25 }, price: 10000 },
            { id: "christmas_tree", name: "–ñ–∏–≤–∞—è —ë–ª–∫–∞", rarity: "legendary", icon: "üéÑ", stats: { health: 1000, healthRegen: 50 }, price: 8000 },
            { id: "firework", name: "–§–µ–π–µ—Ä–≤–µ—Ä–∫", rarity: "epic", icon: "üéÜ", stats: { attack: 80, fireDamage: 40 }, price: 3000 }
        ];

        // PvP —Ä–∞–Ω–≥–∏
        const PVP_RANKS = [
            { name: "–ù–æ–≤–∏—á–æ–∫", minRating: 0, maxRating: 999, icon: "ü•ö", color: "#a9b7c6" },
            { name: "–ë—Ä–æ–Ω–∑–∞", minRating: 1000, maxRating: 1999, icon: "ü•â", color: "#cd7f32" },
            { name: "–°–µ—Ä–µ–±—Ä–æ", minRating: 2000, maxRating: 2999, icon: "ü•à", color: "#c0c0c0" },
            { name: "–ó–æ–ª–æ—Ç–æ", minRating: 3000, maxRating: 3999, icon: "ü•á", color: "#ffd700" },
            { name: "–ü–ª–∞—Ç–∏–Ω–∞", minRating: 4000, maxRating: 4999, icon: "üíé", color: "#3498db" },
            { name: "–ê–ª–º–∞–∑", minRating: 5000, maxRating: 5999, icon: "üí†", color: "#1abc9c" },
            { name: "–ú–∞—Å—Ç–µ—Ä", minRating: 6000, maxRating: 6999, icon: "üëë", color: "#9b59b6" },
            { name: "–ì—Ä–∞–Ω–¥–º–∞—Å—Ç–µ—Ä", minRating: 7000, maxRating: 9999, icon: "üåü", color: "#e74c3c" }
        ];

        // –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
        const CHRISTMAS_QUESTS = [
            { id: "quest_snow", name: "–°–Ω–µ–∂–Ω—ã–π —Å–±–æ—Ä", description: "–°–æ–±–µ—Ä–∏—Ç–µ 50 —Å–Ω–µ–∂–∏–Ω–æ–∫ –≤ –æ—Ö–æ—Ç–µ", progress: 0, required: 50, reward: { gold: 1000, item: "snowflake" } },
            { id: "quest_gifts", name: "–ü–æ–¥–∞—Ä–∫–∏ –¥–ª—è –≤—Å–µ—Ö", description: "–û—Ç–∫—Ä–æ–π—Ç–µ 10 –Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö —Å—É–Ω–¥—É–∫–æ–≤", progress: 0, required: 10, reward: { gold: 2000, crystals: 10 } },
            { id: "quest_battle", name: "–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –±–∏—Ç–≤–∞", description: "–í—ã–∏–≥—Ä–∞–π—Ç–µ 5 PvP –±–æ–µ–≤", progress: 0, required: 5, reward: { gold: 3000, item: "santa_hat" } },
            { id: "quest_tree", name: "–£–∫—Ä–∞—Å—å—Ç–µ —ë–ª–∫—É", description: "–°–æ–±–µ—Ä–∏—Ç–µ –≤—Å–µ –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã", progress: 0, required: 8, reward: { gold: 5000, item: "christmas_tree" } }
        ];

        // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ—Å–Ω–æ–≤–Ω–æ–µ)
        let gameState = {
            version: GAME_VERSION,
            playerId: generatePlayerId(),
            dragonName: "–î—Ä–∞–∫–æ–Ω –ê–≥–∞—Ñ–æ–Ω–æ–≤–∞",
            level: 1,
            xp: 0,
            xpToNextLevel: 100,
            gold: 1000,
            essence: 500,
            crystals: 50,
            energy: 100,
            maxEnergy: 100,
            
            // –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –¥–∞–Ω–Ω—ã–µ
            multiplayer: {
                connected: false,
                rating: 1000,
                rank: "–ù–æ–≤–∏—á–æ–∫",
                wins: 0,
                losses: 0,
                onlineStatus: "offline",
                lastOnline: Date.now(),
                friends: [],
                guild: null
            },
            
            // –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –∏–≤–µ–Ω—Ç
            christmasEvent: {
                active: true,
                endTime: Date.now() + 10 * 24 * 60 * 60 * 1000, // 10 –¥–Ω–µ–π
                collectedSnowflakes: 0,
                openedChristmasChests: 0,
                completedQuests: [],
                collectedItems: []
            },
            
            // –°–∏—Å—Ç–µ–º—ã
            achievements: [],
            dailyQuests: {},
            collection: [],
            pets: [],
            mounts: [],
            guildContributions: 0
        };

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        function generatePlayerId() {
            return 'player_' + Math.random().toString(36).substr(2, 9);
        }

        function createSnowflakes() {
            const snowflakesContainer = document.getElementById('snowflakes');
            for (let i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.style.width = Math.random() * 10 + 5 + 'px';
                snowflake.style.height = snowflake.style.width;
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.opacity = Math.random() * 0.5 + 0.3;
                snowflake.style.animationDuration = Math.random() * 10 + 10 + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflakesContainer.appendChild(snowflake);
            }
        }

        function simulateLoading() {
            let currentProgress = 0;
            const progressBar = document.getElementById('loadingProgress');
            const loadingText = document.getElementById('loadingText');
            
            const interval = setInterval(() => {
                currentProgress += Math.random() * 10 + 5;
                if (currentProgress >= 100) {
                    currentProgress = 100;
                    clearInterval(interval);
                    
                    // –°–æ–∑–¥–∞–µ–º —Å–Ω–µ–≥
                    createSnowflakes();
                    
                    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('loadingScreen').style.display = 'none';
                            document.getElementById('mainMenu').style.display = 'flex';
                        }, 500);
                    }, 500);
                }
                
                progressBar.style.width = currentProgress + '%';
                
                // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç
                const texts = [
                    "–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–≥–æ —á—É–¥–∞...",
                    "–£–∫—Ä–∞—à–∞–µ–º —ë–ª–∫—É...",
                    "–ì–æ—Ç–æ–≤–∏–º –ø–æ–¥–∞—Ä–∫–∏...",
                    "–ó–∞–ø—É—Å–∫–∞–µ–º —Å–Ω–µ–≥–æ–ø–∞–¥...",
                    "–ü–æ–¥–∫–ª—é—á–∞–µ–º –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä..."
                ];
                const textIndex = Math.floor(currentProgress / 20);
                loadingText.textContent = texts[textIndex] || texts[texts.length - 1];
            }, 200);
        }

        // ==================== –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ====================
        function showAdminPanel() {
            document.getElementById('adminModal').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
            document.getElementById('adminError').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }

        function checkAdminPassword(e) {
            if (e.key === 'Enter') {
                const password = document.getElementById('adminPassword').value;
                if (password === ADMIN_PASSWORD) {
                    document.getElementById('adminContent').style.display = 'block';
                    document.getElementById('adminError').style.display = 'none';
                    loadAdminData();
                } else {
                    document.getElementById('adminError').style.display = 'block';
                }
            }
        }

        function loadAdminData() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            document.getElementById('adminGold').value = gameState.gold;
            document.getElementById('adminEssence').value = gameState.essence;
            document.getElementById('adminCrystals').value = gameState.crystals;
            document.getElementById('adminLevel').value = gameState.level;
            document.getElementById('adminAttack').value = gameState.baseStats?.attack || 150;
            document.getElementById('adminDefense').value = gameState.baseStats?.defense || 75;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
            const itemsSelect = document.getElementById('adminItems');
            itemsSelect.innerHTML = '';
            
            const allItems = [...CHRISTMAS_ITEMS];
            allItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.icon} ${item.name}`;
                itemsSelect.appendChild(option);
            });
        }

        function adminAddItem() {
            const itemId = document.getElementById('adminItems').value;
            const item = CHRISTMAS_ITEMS.find(i => i.id === itemId);
            if (item) {
                addItemToInventory(item);
                showNotification(`–î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ–¥–º–µ—Ç: ${item.name}`);
            }
        }

        function adminApply() {
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            gameState.gold = parseInt(document.getElementById('adminGold').value) || 0;
            gameState.essence = parseInt(document.getElementById('adminEssence').value) || 0;
            gameState.crystals = parseInt(document.getElementById('adminCrystals').value) || 0;
            gameState.level = parseInt(document.getElementById('adminLevel').value) || 1;
            
            if (gameState.baseStats) {
                gameState.baseStats.attack = parseInt(document.getElementById('adminAttack').value) || 150;
                gameState.baseStats.defense = parseInt(document.getElementById('adminDefense').value) || 75;
            }
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º XP
            gameState.xpToNextLevel = gameState.level * 100;
            
            showNotification("–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!");
            updateUI();
        }

        function adminReset() {
            // –°–±—Ä–æ—Å –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            document.getElementById('adminGold').value = 1000;
            document.getElementById('adminEssence').value = 500;
            document.getElementById('adminCrystals').value = 50;
            document.getElementById('adminLevel').value = 1;
            document.getElementById('adminAttack').value = 150;
            document.getElementById('adminDefense').value = 75;
        }

        function adminClose() {
            document.getElementById('adminModal').style.display = 'none';
        }

        // ==================== –ú–£–õ–¨–¢–ò–ü–õ–ï–ï–† ====================
        function connectMultiplayer() {
            if (!gameState.multiplayer.connected) {
                // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
                gameState.multiplayer.connected = true;
                gameState.multiplayer.onlineStatus = "online";
                gameState.playerId = generatePlayerId();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ –≤ —Å–ø–∏—Å–æ–∫ –æ–Ω–ª–∞–π–Ω
                const playerData = {
                    id: gameState.playerId,
                    name: gameState.dragonName,
                    level: gameState.level,
                    rating: gameState.multiplayer.rating,
                    status: "online",
                    avatar: "üêâ"
                };
                
                mockServer.onlinePlayers.push(playerData);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
                updateLeaderboard();
                
                showNotification("–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä—É! üéÆ", 3000);
                addLog("üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–µ—Ä—É", "info");
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateOnlinePlayers();
                updatePlayerProfile();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
                startGame();
            } else {
                showNotification("–£–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä—É");
                startGame();
            }
        }

        function updateOnlinePlayers() {
            const onlinePlayersContainer = document.getElementById('onlinePlayers');
            const onlineCount = mockServer.onlinePlayers.filter(p => p.status === "online").length;
            
            document.getElementById('onlineCount').textContent = onlineCount;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ 6 –∏–≥—Ä–æ–∫–æ–≤
            const playersToShow = mockServer.onlinePlayers.slice(0, 6);
            
            onlinePlayersContainer.innerHTML = playersToShow.map(player => `
                <div class="online-player" onclick="challengePlayer('${player.id}')">
                    <div style="font-size: 24px; margin-bottom: 5px;">${player.avatar}</div>
                    <div style="font-weight: bold; font-size: 14px;">${player.name}</div>
                    <div style="font-size: 12px; color: var(--color-text-secondary);">
                        <span class="player-status status-${player.status}"></span>
                        –£—Ä. ${player.level} | ${player.rating} —Ä–µ–π—Ç–∏–Ω–≥
                    </div>
                </div>
            `).join('');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–æ—Ç–æ–≤, –µ—Å–ª–∏ –º–∞–ª–æ –∏–≥—Ä–æ–∫–æ–≤
            if (playersToShow.length < 6) {
                const bots = generateBots(6 - playersToShow.length);
                bots.forEach(bot => {
                    onlinePlayersContainer.innerHTML += `
                        <div class="online-player" onclick="challengePlayer('${bot.id}')">
                            <div style="font-size: 24px; margin-bottom: 5px;">${bot.avatar}</div>
                            <div style="font-weight: bold; font-size: 14px;">${bot.name}</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">
                                <span class="player-status status-online"></span>
                                –£—Ä. ${bot.level} | ${bot.rating} —Ä–µ–π—Ç–∏–Ω–≥
                            </div>
                        </div>
                    `;
                });
            }
        }

        function generateBots(count) {
            const botNames = ["–õ–µ–¥—è–Ω–æ–π –î—Ä–∞–∫–æ–Ω", "–û–≥–Ω–µ–Ω–Ω—ã–π –†—ã—Ü–∞—Ä—å", "–°–Ω–µ–∂–Ω–∞—è –ö–æ—Ä–æ–ª–µ–≤–∞", "–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –≠–ª—å—Ñ", "–ú–æ—Ä–æ–∑–Ω—ã–π –í–æ–∏–Ω", "–ó–∏–º–Ω–∏–π –í–æ–ª—à–µ–±–Ω–∏–∫"];
            const botAvatars = ["‚ùÑÔ∏è", "üî•", "üëë", "üßù", "‚öîÔ∏è", "üîÆ"];
            
            return Array.from({ length: count }, (_, i) => ({
                id: 'bot_' + i,
                name: botNames[i] || `–ë–æ—Ç ${i + 1}`,
                level: Math.floor(Math.random() * 30) + 1,
                rating: Math.floor(Math.random() * 2000) + 1000,
                status: "online",
                avatar: botAvatars[i] || "ü§ñ",
                isBot: true
            }));
        }

        function refreshOnlinePlayers() {
            // –°–∏–º—É–ª—è—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
            mockServer.onlinePlayers = mockServer.onlinePlayers.filter(p => 
                p.status === "online" || Date.now() - p.lastOnline < 300000
            );
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã—Ö –±–æ—Ç–æ–≤
            if (mockServer.onlinePlayers.length < 10) {
                const newBots = generateBots(3);
                mockServer.onlinePlayers.push(...newBots);
            }
            
            updateOnlinePlayers();
            showNotification("–°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω!");
        }

        function challengePlayer(playerId) {
            const player = mockServer.onlinePlayers.find(p => p.id === playerId) ||
                          mockServer.leaderboard.find(p => p.id === playerId);
            
            if (!player) {
                showNotification("–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω!");
                return;
            }
            
            if (player.id === gameState.playerId) {
                showNotification("–ù–µ–ª—å–∑—è –≤—ã–∑–≤–∞—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è!");
                return;
            }
            
            if (gameState.energy < 30) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è PvP –±–æ—è!");
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            if (confirm(`–í—ã–∑–≤–∞—Ç—å ${player.name} –Ω–∞ –¥—É—ç–ª—å?\n–ï–≥–æ —É—Ä–æ–≤–µ–Ω—å: ${player.level}\n–†–µ–π—Ç–∏–Ω–≥: ${player.rating}`)) {
                startPvPBattle(player);
            }
        }

        function startPvPBattle(opponent) {
            gameState.energy -= 30;
            
            // –°–∏–º—É–ª—è—Ü–∏—è PvP –±–æ—è
            const playerPower = gameState.level * 100 + (gameState.baseStats?.attack || 0) + (gameState.baseStats?.defense || 0);
            const opponentPower = opponent.level * 100 + opponent.rating;
            
            // –®–∞–Ω—Å –ø–æ–±–µ–¥—ã –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–Ω–∏—Ü—ã –≤ —Å–∏–ª–µ
            const powerDiff = playerPower - opponentPower;
            const winChance = 50 + (powerDiff / 100);
            const isWin = Math.random() * 100 < Math.max(10, Math.min(90, winChance));
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞
            const ratingChange = calculateRatingChange(gameState.multiplayer.rating, opponent.rating, isWin);
            
            if (isWin) {
                gameState.multiplayer.wins++;
                gameState.multiplayer.rating += ratingChange;
                gameState.gold += 500;
                gameState.xp += 100;
                
                // –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –∫–≤–µ—Å—Ç
                gameState.christmasEvent.progress = (gameState.christmasEvent.progress || 0) + 1;
                
                showNotification(`üéâ –ü–æ–±–µ–¥–∞ –Ω–∞–¥ ${opponent.name}! +${ratingChange} —Ä–µ–π—Ç–∏–Ω–≥–∞`, 4000);
                addLog(`‚öîÔ∏è –ü–æ–±–µ–¥–∞ –≤ PvP! –†–µ–π—Ç–∏–Ω–≥: ${gameState.multiplayer.rating} (+${ratingChange})`, "loot");
            } else {
                gameState.multiplayer.losses++;
                gameState.multiplayer.rating = Math.max(0, gameState.multiplayer.rating - ratingChange);
                gameState.gold += 100;
                gameState.xp += 20;
                
                showNotification(`üí• –ü–æ—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç ${opponent.name}. -${ratingChange} —Ä–µ–π—Ç–∏–Ω–≥–∞`, 4000);
                addLog(`‚öîÔ∏è –ü–æ—Ä–∞–∂–µ–Ω–∏–µ –≤ PvP. –†–µ–π—Ç–∏–Ω–≥: ${gameState.multiplayer.rating} (-${ratingChange})`, "damage");
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–Ω–≥
            updatePlayerRank();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
            updateLeaderboard();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            checkLevelUp();
            
            updateUI();
        }

        function calculateRatingChange(playerRating, opponentRating, isWin) {
            const expectedScore = 1 / (1 + Math.pow(10, (opponentRating - playerRating) / 400));
            const kFactor = 32; // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞
            return Math.round(kFactor * ((isWin ? 1 : 0) - expectedScore));
        }

        function updatePlayerRank() {
            const rating = gameState.multiplayer.rating;
            const rank = PVP_RANKS.find(r => rating >= r.minRating && rating <= r.maxRating) || PVP_RANKS[0];
            gameState.multiplayer.rank = rank.name;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            document.getElementById('playerRank').textContent = rank.name;
            document.getElementById('playerRank').style.background = `linear-gradient(45deg, ${rank.color}, ${darkenColor(rank.color, 20)})`;
        }

        function darkenColor(color, percent) {
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞
            return color; // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –ª–æ–≥–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞
        }

        // ==================== –ù–û–í–û–ì–û–î–ù–ò–ô –ò–í–ï–ù–¢ ====================
        function updateChristmasEvent() {
            if (!gameState.christmasEvent.active) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
            const timeLeft = gameState.christmasEvent.endTime - Date.now();
            if (timeLeft <= 0) {
                gameState.christmasEvent.active = false;
                showNotification("–ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å! üéâ");
                return;
            }
            
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            document.getElementById('eventTimer').textContent = 
                `–î–æ –∫–æ–Ω—Ü–∞: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–¥–∞–Ω–∏—è
            updateChristmasQuests();
        }

        function updateChristmasQuests() {
            const questsContainer = document.getElementById('eventTasks');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –¥–µ–º–æ
            CHRISTMAS_QUESTS.forEach(quest => {
                if (!gameState.christmasEvent.completedQuests.includes(quest.id)) {
                    quest.progress = Math.min(quest.required, quest.progress + Math.floor(Math.random() * 3));
                }
            });
            
            questsContainer.innerHTML = CHRISTMAS_QUESTS.map(quest => {
                const isCompleted = gameState.christmasEvent.completedQuests.includes(quest.id);
                const progressPercent = (quest.progress / quest.required) * 100;
                
                return `
                    <div class="event-task">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div style="font-weight: bold;">${quest.name}</div>
                            <div style="color: ${isCompleted ? 'var(--color-success)' : 'var(--color-text-secondary)'}">
                                ${quest.progress}/${quest.required}
                            </div>
                        </div>
                        <div style="font-size: 14px; color: var(--color-text-secondary); margin-bottom: 10px;">
                            ${quest.description}
                        </div>
                        <div style="height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                            <div style="height: 100%; width: ${progressPercent}%; background: linear-gradient(90deg, var(--color-christmas-red), var(--color-christmas-green)); border-radius: 3px;"></div>
                        </div>
                        ${quest.progress >= quest.required && !isCompleted ? `
                            <button onclick="completeChristmasQuest('${quest.id}')" 
                                    style="margin-top: 10px; padding: 5px 15px; background: var(--color-christmas-gold); border: none; border-radius: 5px; color: #000; cursor: pointer; font-weight: bold; width: 100%;">
                                –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
                            </button>
                        ` : ''}
                        ${isCompleted ? `
                            <div class="event-reward">–ó–∞–≤–µ—Ä—à–µ–Ω–æ! üéâ</div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function completeChristmasQuest(questId) {
            const quest = CHRISTMAS_QUESTS.find(q => q.id === questId);
            if (!quest) return;
            
            // –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
            gameState.gold += quest.reward.gold;
            if (quest.reward.crystals) gameState.crystals += quest.reward.crystals;
            if (quest.reward.item) {
                const item = CHRISTMAS_ITEMS.find(i => i.id === quest.reward.item);
                if (item) {
                    addItemToInventory(item);
                    gameState.christmasEvent.collectedItems.push(item.id);
                }
            }
            
            // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ
            gameState.christmasEvent.completedQuests.push(questId);
            
            showNotification(`–ó–∞–¥–∞–Ω–∏–µ "${quest.name}" –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞.`, 3000);
            addLog(`üéÑ –ó–∞–¥–∞–Ω–∏–µ "${quest.name}" –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ü–æ–ª—É—á–µ–Ω–æ ${quest.reward.gold} –∑–æ–ª–æ—Ç–∞`, "quest");
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateChristmasQuests();
            updateUI();
        }

        // ==================== –¢–û–ü –ò–ì–†–û–ö–û–í ====================
        function updateLeaderboard() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–µ
            const playerIndex = mockServer.leaderboard.findIndex(p => p.id === gameState.playerId);
            const playerData = {
                id: gameState.playerId,
                name: gameState.dragonName,
                level: gameState.level,
                rating: gameState.multiplayer.rating,
                guild: gameState.multiplayer.guild,
                wins: gameState.multiplayer.wins,
                avatar: "üêâ"
            };
            
            if (playerIndex !== -1) {
                mockServer.leaderboard[playerIndex] = playerData;
            } else {
                mockServer.leaderboard.push(playerData);
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
            mockServer.leaderboard.sort((a, b) => b.rating - a.rating);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ç–æ–ø-10
            mockServer.leaderboard = mockServer.leaderboard.slice(0, 10);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–æ—Ç–æ–≤, –µ—Å–ª–∏ –º–∞–ª–æ –∏–≥—Ä–æ–∫–æ–≤
            if (mockServer.leaderboard.length < 10) {
                const bots = generateBots(10 - mockServer.leaderboard.length);
                mockServer.leaderboard.push(...bots);
                mockServer.leaderboard.sort((a, b) => b.rating - a.rating);
                mockServer.leaderboard = mockServer.leaderboard.slice(0, 10);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const leaderboardContainer = document.getElementById('leaderboard');
            leaderboardContainer.innerHTML = mockServer.leaderboard.map((player, index) => {
                const rankClass = `rank-${index + 1}`;
                const isCurrentPlayer = player.id === gameState.playerId;
                
                return `
                    <div class="leaderboard-item ${rankClass}" style="${isCurrentPlayer ? 'background: rgba(255, 138, 0, 0.1);' : ''}">
                        <div class="leaderboard-rank">#${index + 1}</div>
                        <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                            <div style="font-size: 24px;">${player.avatar}</div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold; ${isCurrentPlayer ? 'color: var(--color-primary);' : ''}">
                                    ${player.name} ${isCurrentPlayer ? '(–í—ã)' : ''}
                                </div>
                                <div style="font-size: 12px; color: var(--color-text-secondary);">
                                    –£—Ä–æ–≤–µ–Ω—å ${player.level} | ${player.rating} —Ä–µ–π—Ç–∏–Ω–≥
                                </div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 12px; color: var(--color-text-secondary);">${player.wins || 0} –ø–æ–±–µ–¥</div>
                            ${player.guild ? `<div style="font-size: 11px; color: #666;">${player.guild}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showLeaderboard() {
            updateLeaderboard();
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üèÜ –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–æ–ø –∏–≥—Ä–æ–∫–æ–≤</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; text-align: center;">
                        <div style="font-size: 18px; color: var(--color-text-secondary); margin-bottom: 10px;">
                            –í–∞—à–µ –º–µ—Å—Ç–æ: <span style="color: var(--color-primary); font-weight: bold;">#${getPlayerRank()}</span>
                        </div>
                        <div style="font-size: 14px; color: var(--color-christmas-gold);">
                            –†–µ–π—Ç–∏–Ω–≥: ${gameState.multiplayer.rating} | –†–∞–Ω–≥: ${gameState.multiplayer.rank}
                        </div>
                    </div>
                    
                    <div class="leaderboard-list">
                        ${mockServer.leaderboard.map((player, index) => {
                            const isCurrentPlayer = player.id === gameState.playerId;
                            return `
                                <div class="leaderboard-item rank-${index + 1}" style="${isCurrentPlayer ? 'background: rgba(255, 138, 0, 0.1);' : ''}">
                                    <div class="leaderboard-rank">#${index + 1}</div>
                                    <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                                        <div style="font-size: 24px;">${player.avatar}</div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: bold; ${isCurrentPlayer ? 'color: var(--color-primary);' : ''}">
                                                ${player.name} ${isCurrentPlayer ? '(–í—ã)' : ''}
                                            </div>
                                            <div style="font-size: 12px; color: var(--color-text-secondary);">
                                                –£—Ä–æ–≤–µ–Ω—å ${player.level} | ${player.rating} —Ä–µ–π—Ç–∏–Ω–≥
                                            </div>
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-weight: bold; color: ${getRankColor(index + 1)};">${getRankIcon(index + 1)}</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary);">${player.wins || 0} –ø–æ–±–µ–¥</div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 4px solid var(--color-christmas-gold);">
                        <div style="color: var(--color-christmas-gold); font-weight: bold; margin-bottom: 5px;">–ö–∞–∫ –ø–æ–¥–Ω—è—Ç—å—Å—è –≤ —Ç–æ–ø?</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ PvP –±–æ—è—Ö<br>
                            ‚Ä¢ –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è<br>
                            ‚Ä¢ –ü–æ–±–µ–∂–¥–∞–π—Ç–µ –≤ –∏–≤–µ–Ω—Ç–∞—Ö<br>
                            ‚Ä¢ –ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function getPlayerRank() {
            const sorted = [...mockServer.leaderboard].sort((a, b) => b.rating - a.rating);
            const index = sorted.findIndex(p => p.id === gameState.playerId);
            return index !== -1 ? index + 1 : "–ù–µ –≤ —Ç–æ–ø–µ";
        }

        function getRankColor(rank) {
            if (rank === 1) return '#ffd700';
            if (rank === 2) return '#c0c0c0';
            if (rank === 3) return '#cd7f32';
            return 'var(--color-text-secondary)';
        }

        function getRankIcon(rank) {
            if (rank === 1) return 'üëë';
            if (rank === 2) return 'ü•à';
            if (rank === 3) return 'ü•â';
            return rank;
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –û–•–û–¢–´ ====================
        function startHunt() {
            if (gameState.energy < 10) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –æ—Ö–æ—Ç—ã!");
                return;
            }
            
            gameState.energy -= 10;
            
            // –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –æ—Ö–æ—Ç–∞ —Å –æ—Å–æ–±–µ–Ω–Ω—ã–º–∏ –Ω–∞–≥—Ä–∞–¥–∞–º–∏
            const eventRoll = Math.random();
            let result = null;
            
            if (eventRoll < 0.4) { // 40% - —Å–Ω–µ–∂–∏–Ω–∫–∏
                result = generateSnowflakeHunt();
            } else if (eventRoll < 0.7) { // 30% - –æ–±—ã—á–Ω–∞—è –æ—Ö–æ—Ç–∞
                result = generateRegularHunt();
            } else if (eventRoll < 0.9) { // 20% - –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π –ø–æ–¥–∞—Ä–æ–∫
                result = generateChristmasGift();
            } else { // 10% - –≤—Å—Ç—Ä–µ—á–∞ —Å –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–º –±–æ—Å—Å–æ–º
                result = generateChristmasBoss();
            }
            
            applyHuntResult(result);
            updateUI();
        }

        function generateSnowflakeHunt() {
            const snowflakes = Math.floor(Math.random() * 5) + 1;
            gameState.christmasEvent.collectedSnowflakes = (gameState.christmasEvent.collectedSnowflakes || 0) + snowflakes;
            
            return {
                type: "snowflake",
                snowflakes: snowflakes,
                message: `‚ùÑÔ∏è –í—ã —Å–æ–±—Ä–∞–ª–∏ ${snowflakes} —Å–Ω–µ–∂–∏–Ω–æ–∫!`
            };
        }

        function generateChristmasGift() {
            const gift = CHRISTMAS_ITEMS[Math.floor(Math.random() * CHRISTMAS_ITEMS.length)];
            
            return {
                type: "gift",
                item: gift,
                message: `üéÅ –ù–∞–π–¥–µ–Ω –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π –ø–æ–¥–∞—Ä–æ–∫: ${gift.name}!`
            };
        }

        function generateChristmasBoss() {
            const bosses = [
                { name: "–°–Ω–µ–∂–Ω—ã–π –ì–æ–ª–µ–º", health: 2000, attack: 150, reward: { gold: 1000, item: "snowflake" } },
                { name: "–õ–µ–¥—è–Ω–æ–π –î—Ä–∞–∫–æ–Ω", health: 3000, attack: 200, reward: { gold: 1500, item: "candy_cane" } },
                { name: "–î–µ–¥ –ú–æ—Ä–æ–∑", health: 5000, attack: 300, reward: { gold: 3000, item: "santa_hat" } }
            ];
            
            const boss = bosses[Math.floor(Math.random() * bosses.length)];
            
            return {
                type: "boss",
                boss: boss,
                message: `üëπ –í—Å—Ç—Ä–µ—á–µ–Ω ${boss.name}!`
            };
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –°–£–ù–î–£–ö–ò ====================
        function showChests() {
            const christmasChests = [
                {
                    id: "chest_christmas",
                    name: "–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Å—É–Ω–¥—É–∫",
                    icon: "üéÑ",
                    rarity: "epic",
                    cost: 500,
                    rewards: {
                        gold: { min: 200, max: 500 },
                        crystals: { min: 1, max: 3 },
                        items: CHRISTMAS_ITEMS
                    }
                },
                {
                    id: "chest_santa",
                    name: "–°—É–Ω–¥—É–∫ –°–∞–Ω—Ç—ã",
                    icon: "üéÖ",
                    rarity: "legendary",
                    cost: 1000,
                    rewards: {
                        gold: { min: 500, max: 1000 },
                        crystals: { min: 3, max: 6 },
                        items: CHRISTMAS_ITEMS.filter(item => item.rarity === "legendary" || item.rarity === "mythical")
                    }
                },
                {
                    id: "chest_snow",
                    name: "–°–Ω–µ–∂–Ω—ã–π —Å—É–Ω–¥—É–∫",
                    icon: "‚ùÑÔ∏è",
                    rarity: "rare",
                    cost: 300,
                    rewards: {
                        gold: { min: 100, max: 300 },
                        crystals: { min: 1, max: 2 },
                        items: CHRISTMAS_ITEMS.filter(item => item.rarity === "rare" || item.rarity === "uncommon")
                    }
                }
            ];
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üéÅ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ —Å—É–Ω–¥—É–∫–∏</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; color: var(--color-text-secondary); text-align: center;">
                        –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ —Å—É–Ω–¥—É–∫–∏ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –Ω–∞–≥—Ä–∞–¥–∞–º–∏!
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 30px 0;">
                        ${christmasChests.map(chest => `
                            <div class="chest chest-${chest.rarity}" onclick="openChristmasChest('${chest.id}')">
                                <div class="chest-icon">${chest.icon}</div>
                                <div class="chest-name">${chest.name}</div>
                                <div class="chest-cost">${chest.cost} –∑–æ–ª–æ—Ç–∞</div>
                                <div style="font-size: 12px; margin-top: 10px; color: var(--color-text-secondary);">
                                    –®–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç: 60%
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(46, 204, 113, 0.1); border-radius: 10px; border-left: 4px solid var(--color-christmas-green);">
                        <div style="color: var(--color-christmas-green); font-weight: bold; margin-bottom: 5px;">–°–æ–≤–µ—Ç:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –º–æ–∂–Ω–æ –æ–±–º–µ–Ω–∏–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ —Ç–æ—Ä–≥–æ–≤–ª–∏!
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function openChristmasChest(chestId) {
            const chests = {
                "chest_christmas": { cost: 500, rarity: "epic" },
                "chest_santa": { cost: 1000, rarity: "legendary" },
                "chest_snow": { cost: 300, rarity: "rare" }
            };
            
            const chest = chests[chestId];
            if (!chest) return;
            
            if (gameState.gold < chest.cost) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!");
                closeModal();
                return;
            }
            
            gameState.gold -= chest.cost;
            gameState.christmasEvent.openedChristmasChests = (gameState.christmasEvent.openedChristmasChests || 0) + 1;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–∞–≥—Ä–∞–¥—ã
            const rewards = generateChristmasChestRewards(chest.rarity);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–≥—Ä–∞–¥—ã —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π –∑–∞–∫—Ä—ã—Ç–∏—è
            showChristmasChestRewards(chestId, rewards);
            
            updateUI();
        }

        function generateChristmasChestRewards(rarity) {
            const rewards = {
                gold: 0,
                crystals: 0,
                items: []
            };
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–æ–ª–æ—Ç–æ
            if (rarity === "rare") rewards.gold = Math.floor(Math.random() * 200) + 100;
            else if (rarity === "epic") rewards.gold = Math.floor(Math.random() * 300) + 200;
            else if (rarity === "legendary") rewards.gold = Math.floor(Math.random() * 500) + 500;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫—Ä–∏—Å—Ç–∞–ª–ª—ã
            if (rarity === "rare") rewards.crystals = Math.floor(Math.random() * 2) + 1;
            else if (rarity === "epic") rewards.crystals = Math.floor(Math.random() * 3) + 1;
            else if (rarity === "legendary") rewards.crystals = Math.floor(Math.random() * 6) + 3;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã
            const itemChance = rarity === "legendary" ? 0.8 : rarity === "epic" ? 0.6 : 0.4;
            if (Math.random() < itemChance) {
                const filteredItems = CHRISTMAS_ITEMS.filter(item => {
                    if (rarity === "legendary") return item.rarity === "legendary" || item.rarity === "mythical";
                    if (rarity === "epic") return item.rarity === "epic" || item.rarity === "legendary";
                    return item.rarity === "rare" || item.rarity === "uncommon";
                });
                
                if (filteredItems.length > 0) {
                    const item = filteredItems[Math.floor(Math.random() * filteredItems.length)];
                    rewards.items.push(item);
                }
            }
            
            return rewards;
        }

        function showChristmasChestRewards(chestId, rewards) {
            let itemsHTML = "";
            
            rewards.items.forEach(item => {
                itemsHTML += `
                    <div style="display: flex; align-items: center; gap: 10px; margin: 5px 0; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                        <div style="font-size: 24px;">${item.icon}</div>
                        <div>
                            <div style="color: ${getRarityColor(item.rarity)}; font-weight: bold;">${item.name}</div>
                            <div style="font-size: 12px; color: var(--color-text-secondary);">${getRarityName(item.rarity)}</div>
                        </div>
                    </div>
                `;
            });
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üéÅ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Å—É–Ω–¥—É–∫ –æ—Ç–∫—Ä—ã—Ç!</div>
                        <button class="close-modal" onclick="applyChestRewardsAndClose('${chestId}', ${JSON.stringify(rewards).replace(/'/g, "\\'")})">√ó</button>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 60px;">üéÑ</div>
                        <div style="color: var(--color-christmas-green); font-size: 24px; margin: 10px 0;">–° –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º!</div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <div style="color: var(--color-primary); margin-bottom: 15px; font-size: 18px;">–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:</div>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                            ${rewards.gold > 0 ? `
                                <div style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border: 1px solid rgba(255, 215, 0, 0.3);">
                                    <div style="font-size: 24px;">üí∞</div>
                                    <div style="font-weight: bold; color: #ffd700;">${rewards.gold}</div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary);">–∑–æ–ª–æ—Ç–∞</div>
                                </div>
                            ` : ''}
                            
                            ${rewards.crystals > 0 ? `
                                <div style="text-align: center; padding: 15px; background: rgba(52, 152, 219, 0.1); border-radius: 10px; border: 1px solid rgba(52, 152, 219, 0.3);">
                                    <div style="font-size: 24px;">üîÆ</div>
                                    <div style="font-weight: bold; color: #3498db;">${rewards.crystals}</div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary);">–∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤</div>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${rewards.items.length > 0 ? `
                            <div style="color: var(--color-primary); margin: 20px 0 10px 0;">–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã:</div>
                            ${itemsHTML}
                        ` : ''}
                    </div>
                    
                    <button onclick="applyChestRewardsAndClose('${chestId}', ${JSON.stringify(rewards).replace(/'/g, "\\'")})" 
                            style="width: 100%; padding: 15px; background: linear-gradient(45deg, var(--color-christmas-red), var(--color-christmas-green)); border: none; border-radius: 10px; color: white; font-size: 18px; font-weight: bold; cursor: pointer;">
                        –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—ã
                    </button>
                </div>
            `;
            
            showModal(modalContent);
        }

        function applyChestRewardsAndClose(chestId, rewards) {
            applyChestRewards(chestId, rewards);
            closeModal();
        }

        function applyChestRewards(chestId, rewards) {
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
            gameState.gold += rewards.gold;
            if (rewards.crystals) gameState.crystals += rewards.crystals;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            rewards.items.forEach(item => {
                addItemToInventory(item);
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é –Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
                if (!gameState.christmasEvent.collectedItems.includes(item.id)) {
                    gameState.christmasEvent.collectedItems.push(item.id);
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            let rewardText = `–ü–æ–ª—É—á–µ–Ω—ã –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã:`;
            if (rewards.gold > 0) rewardText += ` ${rewards.gold} –∑–æ–ª–æ—Ç–∞`;
            if (rewards.crystals > 0) rewardText += `, ${rewards.crystals} –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤`;
            if (rewards.items.length > 0) rewardText += `, ${rewards.items.length} –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç(–æ–≤)`;
            
            showNotification(rewardText, 4000);
            addLog(`üéÅ –û—Ç–∫—Ä—ã—Ç –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π —Å—É–Ω–¥—É–∫! ${rewardText}`, "loot");
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
        }

        // ==================== –ù–û–í–´–ï –°–ò–°–¢–ï–ú–´ ====================
        function showMultiplayerBattle() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">‚öîÔ∏è PvP –ê—Ä–µ–Ω–∞</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 60px; margin-bottom: 20px;">‚öîÔ∏è</div>
                        <div style="font-size: 24px; color: var(--color-primary); margin-bottom: 10px;">
                            –í–∞—à —Ä–µ–π—Ç–∏–Ω–≥: ${gameState.multiplayer.rating}
                        </div>
                        <div style="color: var(--color-text-secondary);">
                            –†–∞–Ω–≥: <span style="color: var(--color-christmas-gold); font-weight: bold;">${gameState.multiplayer.rank}</span>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 30px 0;">
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; cursor: pointer;" onclick="findQuickMatch()">
                            <div style="font-size: 32px; margin-bottom: 15px;">‚ö°</div>
                            <div style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">–ë—ã—Å—Ç—Ä—ã–π –±–æ–π</div>
                            <div style="color: var(--color-text-secondary); font-size: 14px;">
                                –°–ª—É—á–∞–π–Ω—ã–π —Å–æ–ø–µ—Ä–Ω–∏–∫
                            </div>
                        </div>
                        
                        <div style="padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; cursor: pointer;" onclick="showTournament()">
                            <div style="font-size: 32px; margin-bottom: 15px;">üèÜ</div>
                            <div style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">–¢—É—Ä–Ω–∏—Ä</div>
                            <div style="color: var(--color-text-secondary); font-size: 14px;">
                                –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —á–µ–º–ø–∏–æ–Ω–∞—Ç
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 15px; background: rgba(255, 71, 87, 0.1); border-radius: 10px; border-left: 4px solid var(--color-danger);">
                        <div style="color: var(--color-danger); font-weight: bold; margin-bottom: 5px;">–ù–∞–≥—Ä–∞–¥—ã –∑–∞ PvP:</div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ‚Ä¢ –†–µ–π—Ç–∏–Ω–≥ –∏ —Ä–∞–Ω–≥–∏<br>
                            ‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ PvP –ø—Ä–µ–¥–º–µ—Ç—ã<br>
                            ‚Ä¢ –ö—Ä–∏—Å—Ç–∞–ª–ª—ã –∏ –∑–æ–ª–æ—Ç–æ<br>
                            ‚Ä¢ –ú–µ—Å—Ç–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Ç–æ–ø–µ
                        </div>
                    </div>
                </div>
            `;
            
            showModal(modalContent);
        }

        function findQuickMatch() {
            if (gameState.energy < 30) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è PvP –±–æ—è!");
                return;
            }
            
            // –ò—â–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
            const opponents = mockServer.onlinePlayers.filter(p => 
                p.id !== gameState.playerId && 
                Math.abs(p.rating - gameState.multiplayer.rating) < 500
            );
            
            if (opponents.length === 0) {
                // –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
                const botRating = gameState.multiplayer.rating + (Math.random() * 1000 - 500);
                const bot = {
                    id: 'bot_match',
                    name: "–°–æ–ø–µ—Ä–Ω–∏–∫",
                    level: gameState.level + Math.floor(Math.random() * 5) - 2,
                    rating: Math.max(100, Math.floor(botRating)),
                    avatar: "ü§ñ"
                };
                
                startPvPBattle(bot);
            } else {
                const opponent = opponents[Math.floor(Math.random() * opponents.length)];
                startPvPBattle(opponent);
            }
            
            closeModal();
        }

        function showTournament() {
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üèÜ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Ç—É—Ä–Ω–∏—Ä</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üéÑ</div>
                        <div style="font-size: 24px; color: var(--color-christmas-gold); margin-bottom: 10px;">
                            –ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥: 50,000 –∑–æ–ª–æ—Ç–∞
                        </div>
                        <div style="color: var(--color-text-secondary);">
                            –î–æ –∫–æ–Ω—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: 2 –¥–Ω—è 5 —á–∞—Å–æ–≤
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <div style="color: var(--color-primary); margin-bottom: 15px; font-size: 18px;">–£—á–∞—Å—Ç–Ω–∏–∫–∏:</div>
                        ${mockServer.leaderboard.slice(0, 8).map((player, index) => `
                            <div style="display: flex; align-items: center; padding: 10px; margin-bottom: 10px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                                <div style="width: 30px; text-align: center; font-weight: bold; color: ${getRankColor(index + 1)};">${index + 1}</div>
                                <div style="font-size: 24px; margin: 0 15px;">${player.avatar}</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: bold;">${player.name}</div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary);">–†–µ–π—Ç–∏–Ω–≥: ${player.rating}</div>
                                </div>
                                ${player.id === gameState.playerId ? `
                                    <div style="padding: 5px 10px; background: var(--color-success); border-radius: 5px; font-size: 12px; font-weight: bold;">
                                        –í—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    ${!mockServer.leaderboard.some(p => p.id === gameState.playerId) ? `
                        <button onclick="joinTournament()" 
                                style="width: 100%; padding: 15px; background: linear-gradient(45deg, var(--color-christmas-red), var(--color-christmas-green)); border: none; border-radius: 10px; color: white; font-size: 18px; font-weight: bold; cursor: pointer;">
                            –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å (1000 –∑–æ–ª–æ—Ç–∞)
                        </button>
                    ` : `
                        <button onclick="startTournamentBattle()" 
                                style="width: 100%; padding: 15px; background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); border: none; border-radius: 10px; color: white; font-size: 18px; font-weight: bold; cursor: pointer;">
                            –ù–∞—á–∞—Ç—å –±–æ–π —Ç—É—Ä–Ω–∏—Ä–∞
                        </button>
                    `}
                </div>
            `;
            
            showModal(modalContent);
        }

        function joinTournament() {
            if (gameState.gold < 1000) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞ –¥–ª—è —É—á–∞—Å—Ç–∏—è!");
                return;
            }
            
            gameState.gold -= 1000;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ –≤ —Ç—É—Ä–Ω–∏—Ä
            const playerData = {
                id: gameState.playerId,
                name: gameState.dragonName,
                level: gameState.level,
                rating: gameState.multiplayer.rating,
                avatar: "üêâ"
            };
            
            mockServer.leaderboard.push(playerData);
            mockServer.leaderboard.sort((a, b) => b.rating - a.rating);
            mockServer.leaderboard = mockServer.leaderboard.slice(0, 8);
            
            showNotification("–í—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ç—É—Ä–Ω–∏—Ä–µ! –£–¥–∞—á–∏!", 3000);
            addLog("üèÜ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–º —Ç—É—Ä–Ω–∏—Ä–µ", "quest");
            
            closeModal();
            updateUI();
        }

        // ==================== –ì–ò–õ–¨–î–ò–ò ====================
        function showGuild() {
            const guilds = [
                { name: "–î—Ä–∞–∫–æ–Ω—ã –û–≥–Ω—è", level: 5, members: 25, rating: 15000 },
                { name: "–õ–µ–¥—è–Ω—ã–µ –ö—Ä—ã–ª—å—è", level: 4, members: 20, rating: 12000 },
                { name: "–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –≠–ª—å—Ñ—ã", level: 3, members: 15, rating: 9000 }
            ];
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üè∞ –ì–∏–ª—å–¥–∏–∏</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    ${gameState.multiplayer.guild ? `
                        <div style="margin: 20px 0; text-align: center;">
                            <div style="font-size: 24px; color: var(--color-primary); margin-bottom: 10px;">
                                ${gameState.multiplayer.guild}
                            </div>
                            <div style="color: var(--color-text-secondary);">
                                –í–∞—à –≤–∫–ª–∞–¥: ${gameState.guildContributions} –æ—á–∫–æ–≤
                            </div>
                        </div>
                        
                        <div style="margin: 30px 0;">
                            <button onclick="guildDonate()" style="width: 100%; padding: 12px; margin-bottom: 10px; background: var(--color-success); border: none; border-radius: 10px; color: white; cursor: pointer;">
                                –í–Ω–µ—Å—Ç–∏ 1000 –∑–æ–ª–æ—Ç–∞ –≤ –∫–∞–∑–Ω—É
                            </button>
                            <button onclick="guildLeave()" style="width: 100%; padding: 12px; background: var(--color-danger); border: none; border-radius: 10px; color: white; cursor: pointer;">
                                –ü–æ–∫–∏–Ω—É—Ç—å –≥–∏–ª—å–¥–∏—é
                            </button>
                        </div>
                    ` : `
                        <div style="margin: 20px 0; text-align: center;">
                            <div style="font-size: 24px; color: var(--color-primary); margin-bottom: 10px;">
                                –í—Å—Ç—É–ø–∏—Ç–µ –≤ –≥–∏–ª—å–¥–∏—é
                            </div>
                            <div style="color: var(--color-text-secondary); margin-bottom: 30px;">
                                –û–±—ä–µ–¥–∏–Ω—è–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω—ã—Ö –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π!
                            </div>
                        </div>
                        
                        <div style="margin: 30px 0;">
                            ${guilds.map(guild => `
                                <div style="padding: 15px; margin-bottom: 10px; background: rgba(0,0,0,0.3); border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: bold; font-size: 18px;">${guild.name}</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary);">
                                            –£—Ä–æ–≤–µ–Ω—å ${guild.level} | ${guild.members}/30 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                                        </div>
                                    </div>
                                    <div>
                                        <div style="font-weight: bold; color: var(--color-christmas-gold);">${guild.rating} –æ—á–∫–æ–≤</div>
                                        <button onclick="joinGuild('${guild.name}')" style="margin-top: 5px; padding: 5px 15px; background: var(--color-success); border: none; border-radius: 5px; color: white; cursor: pointer;">
                                            –í—Å—Ç—É–ø–∏—Ç—å
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <button onclick="createGuild()" style="width: 100%; padding: 15px; background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); border: none; border-radius: 10px; color: white; font-size: 16px; font-weight: bold; cursor: pointer;">
                            –°–æ–∑–¥–∞—Ç—å —Å–≤–æ—é –≥–∏–ª—å–¥–∏—é (5000 –∑–æ–ª–æ—Ç–∞)
                        </button>
                    `}
                </div>
            `;
            
            showModal(modalContent);
        }

        function joinGuild(guildName) {
            if (gameState.multiplayer.guild) {
                showNotification("–í—ã —É–∂–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –≤ –≥–∏–ª—å–¥–∏–∏!");
                return;
            }
            
            gameState.multiplayer.guild = guildName;
            gameState.guildContributions = 0;
            
            showNotification(`–í—ã –≤—Å—Ç—É–ø–∏–ª–∏ –≤ –≥–∏–ª—å–¥–∏—é "${guildName}"!`, 3000);
            addLog(`üè∞ –í—Å—Ç—É–ø–∏–ª–∏ –≤ –≥–∏–ª—å–¥–∏—é "${guildName}"`, "info");
            
            closeModal();
            updateUI();
        }

        function createGuild() {
            if (gameState.gold < 5000) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–∏–ª—å–¥–∏–∏!");
                return;
            }
            
            const guildName = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏ (3-20 —Å–∏–º–≤–æ–ª–æ–≤):");
            if (!guildName || guildName.length < 3 || guildName.length > 20) {
                showNotification("–ù–∞–∑–≤–∞–Ω–∏–µ –≥–∏–ª—å–¥–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 3 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤!");
                return;
            }
            
            gameState.gold -= 5000;
            gameState.multiplayer.guild = guildName;
            gameState.guildContributions = 1000;
            
            showNotification(`–ì–∏–ª—å–¥–∏—è "${guildName}" —Å–æ–∑–¥–∞–Ω–∞!`, 3000);
            addLog(`üè∞ –°–æ–∑–¥–∞–Ω–∞ –≥–∏–ª—å–¥–∏—è "${guildName}"`, "info");
            
            closeModal();
            updateUI();
        }

        function guildDonate() {
            if (gameState.gold < 1000) {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!");
                return;
            }
            
            gameState.gold -= 1000;
            gameState.guildContributions += 1000;
            
            showNotification("–í–∫–ª–∞–¥ –≤ –≥–∏–ª—å–¥–∏—é –≤–Ω–µ—Å–µ–Ω!", 2000);
            updateUI();
        }

        // ==================== –¢–û–†–ì–û–í–õ–Ø ====================
        function showTrading() {
            const trades = [
                { player: "–õ–µ–¥—è–Ω–æ–π –î—Ä–∞–∫–æ–Ω", item: "‚ùÑÔ∏è –°–Ω–µ–∂–∏–Ω–∫–∞ —É–¥–∞—á–∏", price: 1000, want: "üî• –û–≥–Ω–µ–Ω–Ω—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª" },
                { player: "–°–Ω–µ–∂–Ω–∞—è –ö–æ—Ä–æ–ª–µ–≤–∞", item: "üéÖ –®–∞–ø–∫–∞ –°–∞–Ω—Ç—ã", price: 2000, want: "üíé 5 –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤" },
                { player: "–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –≠–ª—å—Ñ", item: "üç¨ –ö–∞—Ä–∞–º–µ–ª—å–Ω–∞—è —Ç—Ä–æ—Å—Ç—å", price: 800, want: "üí∞ 500 –∑–æ–ª–æ—Ç–∞" }
            ];
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üîÑ –¢–æ—Ä–≥–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; text-align: center;">
                        <div style="font-size: 24px; color: var(--color-primary); margin-bottom: 10px;">
                            –û–±–º–µ–Ω –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏
                        </div>
                        <div style="color: var(--color-text-secondary); margin-bottom: 30px;">
                            –¢–æ—Ä–≥—É–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –Ω—É–∂–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã!
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <div style="color: var(--color-primary); margin-bottom: 15px; font-size: 18px;">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:</div>
                        ${trades.map(trade => `
                            <div style="padding: 15px; margin-bottom: 10px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div style="font-weight: bold;">${trade.player}</div>
                                    <div style="color: var(--color-christmas-gold); font-weight: bold;">${trade.price} –∑–æ–ª–æ—Ç–∞</div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div style="font-size: 24px;">‚û°Ô∏è</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold;">${trade.item}</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary);">–•–æ—á–µ—Ç –ø–æ–ª—É—á–∏—Ç—å: ${trade.want}</div>
                                    </div>
                                </div>
                                <button onclick="acceptTrade('${trade.player}')" style="width: 100%; padding: 8px; background: var(--color-success); border: none; border-radius: 5px; color: white; cursor: pointer;">
                                    –ü—Ä–∏–Ω—è—Ç—å –æ–±–º–µ–Ω
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button onclick="createTrade()" style="width: 100%; padding: 15px; background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); border: none; border-radius: 10px; color: white; font-size: 16px; font-weight: bold; cursor: pointer;">
                        –°–æ–∑–¥–∞—Ç—å —Å–≤–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
                    </button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ==================== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –°–ò–°–¢–ï–ú–´ ====================
        function showDailyQuest() {
            const dailyQuests = [
                { name: "–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—Ö–æ—Ç–∞", description: "–í—ã–ø–æ–ª–Ω–∏—Ç–µ 3 –æ—Ö–æ—Ç—ã", reward: "500 –∑–æ–ª–æ—Ç–∞" },
                { name: "PvP –≤–æ–∏–Ω", description: "–í—ã–∏–≥—Ä–∞–π—Ç–µ 2 PvP –±–æ—è", reward: "3 –∫—Ä–∏—Å—Ç–∞–ª–ª–∞" },
                { name: "–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä", description: "–°–æ–±–µ—Ä–∏—Ç–µ 5 –ø—Ä–µ–¥–º–µ—Ç–æ–≤", reward: "–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Å—É–Ω–¥—É–∫" }
            ];
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; text-align: center;">
                        <div style="font-size: 24px; color: var(--color-christmas-gold); margin-bottom: 10px;">
                            –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!
                        </div>
                        <div style="color: var(--color-text-secondary); margin-bottom: 30px;">
                            –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        ${dailyQuests.map(quest => `
                            <div style="padding: 15px; margin-bottom: 10px; background: rgba(0,0,0,0.3); border-radius: 10px; border-left: 4px solid var(--color-christmas-green);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div style="font-weight: bold; font-size: 18px;">${quest.name}</div>
                                    <div style="padding: 5px 10px; background: var(--color-christmas-gold); border-radius: 5px; font-size: 12px; font-weight: bold; color: #000;">
                                        ${quest.reward}
                                    </div>
                                </div>
                                <div style="color: var(--color-text-secondary); margin-bottom: 10px;">${quest.description}</div>
                                <div style="height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px;">
                                    <div style="height: 100%; width: ${Math.floor(Math.random() * 100)}%; background: linear-gradient(90deg, var(--color-christmas-red), var(--color-christmas-green)); border-radius: 3px;"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button onclick="claimDailyReward()" style="width: 100%; padding: 15px; background: linear-gradient(45deg, var(--color-christmas-red), var(--color-christmas-green)); border: none; border-radius: 10px; color: white; font-size: 16px; font-weight: bold; cursor: pointer;">
                        –ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É
                    </button>
                </div>
            `;
            
            showModal(modalContent);
        }

        function showCollection() {
            const collectedItems = gameState.christmasEvent.collectedItems || [];
            const totalItems = CHRISTMAS_ITEMS.length;
            const progress = Math.floor((collectedItems.length / totalItems) * 100);
            
            const modalContent = `
                <div class="modal">
                    <div class="modal-header">
                        <div class="modal-title">üìö –ö–æ–ª–ª–µ–∫—Ü–∏—è –Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>
                        <button class="close-modal" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <div style="margin: 20px 0; text-align: center;">
                        <div style="font-size: 24px; color: var(--color-christmas-gold); margin-bottom: 10px;">
                            –°–æ–±—Ä–∞–Ω–æ: ${collectedItems.length}/${totalItems}
                        </div>
                        <div style="height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; margin: 20px 0;">
                            <div style="height: 100%; width: ${progress}%; background: linear-gradient(90deg, var(--color-christmas-red), var(--color-christmas-green)); border-radius: 5px;"></div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 30px 0;">
                        ${CHRISTMAS_ITEMS.map(item => {
                            const isCollected = collectedItems.includes(item.id);
                            return `
                                <div style="padding: 20px; background: ${isCollected ? 'rgba(46, 204, 113, 0.1)' : 'rgba(0,0,0,0.3)'}; border-radius: 10px; text-align: center; border: 2px solid ${isCollected ? 'var(--color-christmas-green)' : 'transparent'};">
                                    <div style="font-size: 32px; margin-bottom: 10px;">${item.icon}</div>
                                    <div style="font-weight: bold; color: ${isCollected ? getRarityColor(item.rarity) : '#666'};">
                                        ${item.name}
                                    </div>
                                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-top: 5px;">
                                        ${isCollected ? '‚úÖ –°–æ–±—Ä–∞–Ω' : '‚ùå –ù–µ –ø–æ–ª—É—á–µ–Ω'}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    ${collectedItems.length === totalItems ? `
                        <div style="padding: 20px; background: linear-gradient(45deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 2, 0.1)); border-radius: 10px; text-align: center; border: 2px solid var(--color-christmas-gold);">
                            <div style="font-size: 24px; color: var(--color-christmas-gold